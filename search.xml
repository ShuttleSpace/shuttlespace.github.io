<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[GraphQL-Scalars]]></title>
    <url>%2F2019%2F05%2F05%2FGraphQL-Scalars%2F</url>
    <content type="text"><![CDATA[graphql ä¸­çš„å¸¸é‡scalarsgraphql ç±»åž‹ç³»ç»Ÿçš„å¶å­èŠ‚ç‚¹è¢«ç§°ä¸º scalars.ä¸€æ—¦åˆ°è¾¾äº† scalar ç±»åž‹åˆ™æ— æ³•åœ¨æ²¿ç€ç±»åž‹ç»“æž„ç»§ç»­å‘ä¸‹äº†.scalar ç±»åž‹æ˜¯æŒ‡ä¸å¯å†åˆ†å‰²çš„å€¼.graphql è§„èŒƒæ˜Žç¡®è¦æ±‚æ‰€æœ‰çš„è¯­è¨€å®žçŽ°å¿…é¡»å…·æœ‰ä»¥ä¸‹ scalar ç±»åž‹. String å³ GraphQLString- ä¸€ä¸ª UTF-8 å­—ç¬¦ä¸²åºåˆ—. Boolean å³ GraphQLBoolean- true or false. Int å³ GraphQLInt- æœ‰ç¬¦å·çš„ 32 æ•´åž‹æ•°. Float å³ GraphQLFloat- æœ‰ç¬¦å·çš„åŒç²¾åº¦æµ®ç‚¹æ•°. ID å³ GraphQLID- ç±»ä¼¼äºŽ String çš„å”¯ä¸€æ ‡è¯†ç¬¦.å®šä¹‰ä¸€ä¸ª ID æ ‡è¯†ç¬¦å³è¡¨ç¤ºè¯¥å±žæ€§ä¸æ˜¯äººç±»å¯è¯†åˆ«çš„ç”¨é€”.graphql-java ä¸º java ç³»ç»Ÿæ·»åŠ äº†ä»¥ä¸‹æœ‰ç”¨çš„ scalar ç±»åž‹. Long å³ GraphQLLong- åŸºäºŽ java.lang.Long çš„ scalar. Short å³ GraphQLShort- åŸºäºŽ java.lang.Short çš„ scalar. Byte å³ GraphQLByte- åŸºäºŽ java.lang.Byte çš„ scalar. BigDecimal å³ GraphQLBigDicimal åŸºäºŽ java.math.BigDecimal çš„ scalar. BigInteger å³ GrapQLBigInteger åŸºäºŽ java.math.BigInteger çš„ scalar. graphql.Scalarsç±»åŒ…å«äº†æä¾› scalar ç±»åž‹çš„å•ä¾‹å®žä¾‹. è‡ªå®šä¹‰ scalarsä½ å¯ä»¥å®žçŽ°è‡ªå®šä¹‰ scalar.åœ¨è¿è¡Œæ—¶ä½ éœ€è¦å®Œæˆç±»åž‹å¼ºåˆ¶è½¬æ¢,åŽé¢ä¼šè§£é‡Š.å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ª email çš„ scalar ç±»åž‹.å®ƒæŠŠ email åœ°å€ä½œä¸ºè¾“å…¥è¾“å‡º.æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¦‚ä¸‹çš„ graphql.schema.GraphQLScalarType å•ä¾‹å®žä¾‹. 12345678910111213141516public static final GraphQLScalarType EMAIL = new GraphQLScalarType("email","A cusom scalar that handles emails",new Coercing() &#123; @Override public Object serialize(Object dataFetcehrResult) &#123; return serilizeEmail(dataFetcherResult); &#125; @Override public Object parseValue(Object input) &#123; return parseEmailFromVariable(input); &#125; @Override public Object parseLiteral(Object input) &#123; return parseEmailFromAstLiteral(input); &#125;&#125;); å¼ºåˆ¶ç±»åž‹è½¬æ¢è‡ªå®šä¹‰ scalar å®žçŽ°çš„çœŸæ­£ä½œç”¨ç‚¹åœ¨ graphql.schema.Coercingå®žçŽ°.æœ‰ 3 ä¸ªå‡½æ•°éœ€è¦å®žçŽ° parseValue- æŽ¥æ”¶ä¸€ä¸ªè¾“å…¥å˜é‡,è½¬æ¢ä¸º java è¿è¡Œæ—¶å®žçŽ°. parseLiteral-æŽ¥æ”¶ä¸€ä¸ª AST å­—ç¬¦ graphql.language.Value ä½œä¸ºè¾“å…¥,è½¬æ¢ä¸º java è¿è¡Œæ—¶å®žçŽ°. serialize-æŽ¥æ”¶ä¸€ä¸ª Java å¯¹è±¡,æœ€ç»ˆè½¬ä¸º scalar è¾“å‡ºç±»åž‹.æ‰€ä»¥ä½ è‡ªå®šä¹‰çš„ scalar å®žçŽ°éœ€è¦å¤„ç† 2 ä¸­ç±»åž‹çš„è¾“å…¥(parseValue/parseLiteral)å’Œ 1 ä¸­è¾“å‡º(serialize).å¦‚ä¸‹æŸ¥è¯¢,ä½¿ç”¨äº†å˜é‡,AST å­—ç¬¦ç„¶åŽè¾“å‡ºæˆ‘ä»¬éœ€è¦çš„ scalar ç±»åž‹ email. 123456789mutation Contact($mainContact: Email!) &#123; makeContact( mainContactEmail: $mainContact backupContactEmial: &quot;backup@company.com&quot; ) &#123; id mainContactEmail &#125;&#125; æˆ‘ä»¬çš„è‡ªå®šä¹‰ email scalar ç±»åž‹å°† è°ƒç”¨ parseValue å°† $mainContactå˜é‡è½¬ä¸ºè¿è¡Œæ—¶å¯¹è±¡. è°ƒç”¨ parseLiteral å°† AST graphql.language.StringValue â€œbackup@company.comâ€œ è½¬æ¢ä¸ºè¿è¡Œæ—¶å¯¹è±¡. è°ƒç”¨ serialize å°† mainContactEmial è¿è¡Œæ—¶å®žçŽ°è½¬ä¸ºè¾“å‡ºå¯¹è±¡å½¢å¼. è¾“å…¥è¾“å‡ºæ ¡éªŒä¾‹å¦‚æˆ‘ä»¬çš„ email scalar å°†ä¼šæ ¡éªŒè¾“å…¥è¾“å‡ºæ˜¯å¦æ˜¯çœŸæ˜¯çš„ email åœ°å€.graphql.schema.Coercing åè®®å¦‚ä¸‹: serialize åªå…è®¸æŠ›å‡º graphql.schema.CoercingSerializeException.è¿™è¡¨æ˜Žå€¼æ— æ³•è¢«åºåˆ—åŒ–ä¸ºåˆé€‚çš„å½¢å¼.å†³ä¸å…è®¸æŒ‡å®šå…¶ä»–è¿è¡Œæ—¶å¼‚å¸¸ä»¥å–å¾—æ™®é€šçš„ graphql æ ¡éªŒè¡Œä¸º.å¿…é¡»è¿”å›žä¸€ä¸ªéž null å€¼. parseValue åªå…è®¸æŠ›å‡º graphql.schema.CoercingParseValueException.è¿™è¡¨æ˜Žå€¼æ— æ³•è¢«ä½œä¸ºè¾“å…¥è§£æžä¸ºåˆé€‚çš„å½¢å¼..å†³ä¸å…è®¸æŒ‡å®šå…¶ä»–è¿è¡Œæ—¶å¼‚å¸¸ä»¥å–å¾—æ™®é€šçš„ graphql æ ¡éªŒè¡Œä¸º.å¿…é¡»è¿”å›žä¸€ä¸ªéž null å€¼. parseLiteral åªå…è®¸æŠ›å‡º graphql.schema.CoercingParseLiterialException.è¿™è¡¨æ˜Ž AST å€¼æ— æ³•è¢«ä½œä¸ºè¾“å…¥è§£æžä¸ºåˆé€‚çš„å½¢å¼..å†³ä¸å…è®¸æŒ‡å®šå…¶ä»–è¿è¡Œæ—¶å¼‚å¸¸ä»¥å–å¾—æ™®é€šçš„ graphql æ ¡éªŒè¡Œä¸º.æœ‰çš„äººå°è¯•ä¾èµ–è¿è¡Œæ—¶å¼‚å¸¸æ ¡éªŒä»¥æœŸèŽ·å–æ™®é€šçš„ graphql é”™è¯¯.è¿™æ˜¯è¡Œä¸é€šçš„.å¿…é¡»éµç…§ Coercing æ–¹æ³•åè®®ä½¿ graphql-java å¼•æ“ŽæŒ‰ç…§ grapqhl çš„ scalar ç±»åž‹è§„èŒƒè¿è¡Œ. ç¤ºä¾‹å®žçŽ°ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ email scalar ç±»åž‹å®žçŽ°,å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ç»§æ‰¿ Coercing å®žçŽ°ä¸€ä¸ª scalar. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public static class EmailScalar &#123; public static final GraphQLScalarType EMAIL = new GraphQLScalarType("email","A custom scalar that handles emails",new Coercing() &#123; @Override public Object serialize(Object dataFetcherResult) &#123; return serializeEmail(dataFetcherResult); &#125; @Override public Object parseValue(Object input) &#123; return parseEmailFromVariable(input); &#125; @Override public Object parseLiterial(Object input) &#123; return parseEmialFromAstLiterial(input); &#125; &#125;); private static boolean looksLikeAnEmailAddress(String possibleEmailValue) &#123; return Pattern.matches("[A-Za-z0-9]@[.*]",possibleEmailValue); &#125; private static Object serialzeEmail(Object dataFetcherResult) &#123; String possibleEmailValue = String.valueOf(dataFetcherResult); if (looksLikeAnEmailAddress(possibleEmailValue)) &#123; return possibleEmailValue; &#125; else &#123; throw new CoercingSerializeException("Unable to serialize" + possibleEmailValue + " as an email address"); &#125; &#125; private static Object parseEmailFromVariable(Object input) &#123; if (input instanceof String) &#123; String possibleEmailValue = input.toString(); if (looksLikeAnEmailAddress(possibleEmailValue)) &#123; return possibleEmailValue; &#125; &#125; throw new CoercingParseValueException("Unable to parse variable value " + input + " as an email address"); &#125; private static Object parseEmailFromAstLiterial(Object input) &#123; if (input instanceof StringValue) &#123; String possibleEmailValue = ((StringValue)input).getValue(); if (looksLikeAnEmailAddress(possibleEmailValue)) &#123; return possibleEmailValue; &#125; &#125; throw new CoercingParseLiterialException("Unable to parse variable value " + input + " as an email address"); &#125; &#125;&#125;]]></content>
  </entry>
  <entry>
    <title><![CDATA[GraphQL-Data mapping]]></title>
    <url>%2F2019%2F05%2F05%2FGraphQL-Data-mapping%2F</url>
    <content type="text"><![CDATA[Mapping datagraphql æ˜¯å¦‚ä½•æŠŠå¯¹è±¡æ•°æ®åŒ¹é…åˆ°ç±»åž‹çš„graphql å†…éƒ¨å…¨éƒ¨æ˜¯å…³äºŽå£°æ˜Žç±»åž‹ schema,ç„¶åŽåœ¨è¿è¡ŒåŒ¹é…åˆ°æ•°æ®.ä½œä¸ºç±»åž‹ schema çš„è®¾è®¡è€…,ä½ åº”è¯¥åœ¨å¤„ç†è¿™äº›å…ƒç´ . 12345678910type Query &#123; products(match: String): [Product] # a list of products&#125;type Product &#123; id: ID name: String description: String cost: Float tax: Float&#125; ç„¶åŽå¯ä»¥æ‰§è¡ŒæŸ¥è¯¢ 12345678query ProductQuery &#123; products(match: &quot;Paper*&quot;) &#123; id name cost tax &#125;&#125; å¯¹äºŽ Query.productså±žæ€§æœ‰ä¸€ä¸ªç»‘å®šçš„ DataFetcherè´Ÿè´£æŸ¥æ‰¾åŒ¹é…è¾“å…¥å‚æ•°çš„ product s åˆ—è¡¨.å‡è®¾æˆ‘ä»¬æœ‰ 3 ä¸ªä¸‹æ¸¸æœåŠ¡.ä¸€ä¸ªèŽ·å–äº§å“ä¿¡æ¯,ä¸€ä¸ªèŽ·å–äº§å“ä»·æ ¼ä¿¡æ¯,ä¸€ä¸ªè®¡ç®—æŸ¥æ–°ç¨Žæ”¶ä¿¡æ¯.graphql-java ä½¿ç”¨è¿™äº›å¯¹è±¡è¿è¡Œ data fetcher,èŽ·å–ä¿¡æ¯ç„¶åŽå°†å…¶åŒ¹é…åˆ° schema æŒ‡å®šçš„ç±»åž‹ä¸­.æˆ‘ä»¬çš„ç›®æ ‡æ˜¯èŽ·å–åˆ°è¿™ 3 ä¸ªæºçš„ä¿¡æ¯,ç„¶åŽæŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ª unified ç±»åž‹å±•ç¤º.æˆ‘ä»¬å¯ä»¥å¯¹ cost å’Œ tax éœ€è¦è®¡ç®—çš„å±žæ€§æŒ‡å®š data fetcher,ä½†è¿™éœ€è¦æ›´å¤šçš„ç»´æŠ¤ç²¾åŠ›,å¯èƒ½å¯¼è‡´ N+1 æ€§èƒ½é—®é¢˜.æˆ‘ä»¬æœ€å¥½åœ¨ Query.products data fetcher ä¸­èŽ·å–æ‰€æœ‰çš„ä¿¡æ¯,åŒæ—¶åˆ›å»ºä¸€ä¸ª unified æ•°æ®è§†å›¾. 12345678910DataFetcher produtctsDataFetcher = new DataFetcher() &#123; @Override public Object get(DataFetchingEnvironment env) &#123; String matchArg = env.getArgument("match"); List&lt;ProductInfo&gt; productInfos = getMatchingProducts(matchArg); List&lt;ProductCostInfo&gt; productConstInfo = getProdutConsts(productInfo); List&lt;ProductTaxInfo&gt; productTaxInfo = getProductTax(productInfo); return mapDataTogether(productInfo,productCostInfo,productTaxInfo); &#125;&#125; ä¸Šé¢æœ‰ 3 ä¸ªç±»åž‹çš„ä¿¡æ¯éœ€è¦è¢«æ•´åˆä¸ºä¸€ä¸ªä»¥ä¾¿ graphql æŸ¥è¯¢å¯ä»¥è®¿é—® id,name,cost,tax å±žæ€§.æœ‰ 2 ä¸­æ–¹æ³•å¯ä»¥åˆ›å»ºè¿™ä¸ªæ˜ å°„.ä¸€ä¸ªæ˜¯ä½¿ç”¨ç±»åž‹ä¸å®‰å…¨çš„ List&lt;Map&gt; ç»“æž„,å¦ä¸€ä¸ªæ˜¯ä½¿ç”¨ç±»åž‹å®‰å…¨çš„ List&lt;ProductDTO&gt;å°è£…è¿™äº›æ•°æ®. 123456789101112131415161718private List&lt;Map&gt; mapDataTogetherViaMap(List&lt;ProductInfo&gt; productInfo,List&lt;ProductCostInfo&gt; productCostInfo,List&lt;ProductTaxInfo&gt; productTaxInfo) &#123; List&lt;Map&gt; unifiedView = new ArrayList&lt;&gt;(); for (int i = 0;i &lt; productInfo.size();i++) &#123; ProductInfo info = productInfo.get(i); ProductCostInfo cost = productCostInfo.get(i); ProductTaxInfo tax = productTaxInfo.get(i); Map&lt;String,Object&gt; objectMap = new HashMap&lt;&gt;(); objectMap.put("id",info.getId()); objectMap.put("name",info.getName()); objectMap.put("descriptioin",info.getDescription()); objectMap.put("cost",cost.getCost()); objectMap.put("tax",tax.getTax()); unifiedView.add(objectMap); &#125; return unifiedView;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354class ProductDTO &#123; private final String id; private final String name; private final String description; private final Float cost; private final Float tax; public ProductDTO(String id, String name, String description, Float cost, Float tax) &#123; this.id = id; this.name = name; this.description = description; this.cost = cost; this.tax = tax; &#125; public String getId() &#123; return id; &#125; public String getName() &#123; return name; &#125; public String getDescription() &#123; return description; &#125; public Float getCost() &#123; return cost; &#125; public Float getTax() &#123; return tax; &#125;&#125;private List&lt;ProductDTO&gt; mapDataTogetherViaDTO(List&lt;ProductInfo&gt; productInfo, List&lt;ProductCostInfo&gt; productCostInfo, List&lt;ProductTaxInfo&gt; productTaxInfo) &#123; List&lt;ProductDTO&gt; unifiedView = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; productInfo.size(); i++) &#123; ProductInfo info = productInfo.get(i); ProductCostInfo cost = productCostInfo.get(i); ProductTaxInfo tax = productTaxInfo.get(i); ProductDTO productDTO = new ProductDTO( info.getId(), info.getName(), info.getDescription(), cost.getCost(), tax.getTax() ); unifiedView.add(productDTO); &#125; return unifiedView;&#125; graphql å¼•æ“ŽçŽ°åœ¨å¯ä»¥ä½¿ç”¨ object åˆ—è¡¨ç„¶åŽè¿è¡ŒæŸ¥è¯¢èŽ·å– id,name,cost,tax å±žæ€§.graphql-java é»˜è®¤çš„ data fetcher graphql.schema.PropertyDataFetcher åŒæ—¶æ”¯æŒ map å’Œ POJO.å¯¹äºŽåˆ—è¡¨çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä¼šé€šè¿‡ id å±žæ€§,æˆ–ä½¿ç”¨ name åœ¨ map é‡ŒæŸ¥æ‰¾,æˆ–é€šè¿‡ getId() æ–¹æ³•èŽ·å–,ç„¶åŽè¿”å›žç»™ graphql response.å¯¹äºŽæŸ¥è¯¢ä¸­çš„æ¯ä¸ªç±»åž‹éƒ½ä¼šæ‰§è¡Œè¿™æ ·çš„æ“ä½œ.é€šè¿‡åœ¨é«˜çº§ data fetcher ä¸­åˆ›å»ºä¸€ä¸ª unified view,ä½ å°±å¯ä»¥åœ¨è¿è¡Œæ—¶æ•°æ®å’Œ graphql schema ä¹‹é—´å»ºç«‹ä¸€ä¸ªæ˜ å°„.]]></content>
  </entry>
  <entry>
    <title><![CDATA[GraphQL-Execution]]></title>
    <url>%2F2019%2F05%2F04%2FGraphQL-Execution%2F</url>
    <content type="text"><![CDATA[ExecutionQuerieså¯¹ schema æ‰§è¡Œ query,ä½¿ç”¨åˆé€‚çš„å‚æ•°æž„å»ºä¸€ä¸ªæ–°çš„ GraphQL å¯¹è±¡,ç„¶åŽè°ƒç”¨execute().query çš„ç»“æžœæ˜¯åŒ…å«æŸ¥è¯¢æ•°æ®æˆ–è€…ï¼ˆå¹¶ä¸”ï¼‰ä¸€ç³»åˆ—é”™è¯¯çš„ExecutionResult å¯¹è±¡. 123456GraphQLSchema schema = GraphQLSchema.newSchema().query(queryType).build();GraphQL graphQl = GraphQL.newGraphQL(schema).build();ExecutionInput executionInput = ExecutionInput.newExecutionInput().query("query &#123; hero &#123; name &#125;&#125;");ExectionResult executionResult = graphQl.execute(executionInput);Object data = executionResult.getData();List&lt;GraphQLError&gt; errors = executionResult.getErrors(); æ›´å¤šå¤æ‚çš„æŸ¥è¯¢ç¤ºä¾‹è¯·å‚è€ƒStarWars query tests; Data Fetchersæ¯ä¸ª graphql å±žæ€§ç±»åž‹éƒ½æœ‰ä¸€ä¸ª graphql.schema.DataFetcher ä¸Žä¹‹å…³è”.å…¶ä»– graphql å®žçŽ°é€šå¸¸æŠŠè¿™ä¸ªç±»åž‹æˆä¸º resolvers.é€šå¸¸å¯ä»¥ä½¿ç”¨graphql.schema.PropertyDataFetcheræ¥æ£€æŸ¥ æä¾›å±žæ€§å€¼çš„ Java POJO å¯¹è±¡.å¦‚æžœæŸä¸ªå±žæ€§æœªæŒ‡å®š data fetcher,é»˜è®¤ä¼šä½¿ç”¨è¿™ä¸ª.ç„¶è€Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„ data fetcehr èŽ·å–ä½ çš„é¡¶çº§åŸŸå¯¹è±¡.å¯èƒ½æ¶‰åŠåˆ°æ•°æ®åº“è°ƒç”¨æˆ–é€šè¿‡ HTTP è¯·æ±‚å…¶ä»–ç³»ç»Ÿ.graphql-javaä¸å…³å¿ƒä½ æ˜¯å¦‚ä½•èŽ·å–ä½ çš„åŸŸå¯¹è±¡,è¿™æ˜¯ä½ éœ€è¦å…³å¿ƒçš„åœ°æ–¹.åŒæ—¶ä¹Ÿä¸å…³å¿ƒç”¨æˆ·è®¿é—®æ•°æ®æŽˆæƒ.è¿™äº›éƒ½åº”è¯¥æ”¾åˆ°ä½ è‡ªå·±çš„é€»è¾‘å¤„ç†å±‚.data fetcher ç¤ºä¾‹å¦‚ä¸‹: 123456DataFetcher userDataFetcher = new DataFetcher() &#123; @Override public Object get(DataFetchingEnvironment environment) &#123; return fetchUserFromDatabase(environment.getArgument("userId")); &#125;&#125;; æ¯ä¸ª DataFetcheréƒ½ä¼šä¼ é€’ä¸€ä¸ª graphql.schema.DataFetchingEnvironment å¯¹è±¡(åŒ…å«äº†å°†è¦èŽ·å–çš„å±žæ€§,èŽ·å–è¯¥å±žæ€§æ‰€éœ€æä¾›çš„å‚æ•°å’Œå…¶ä»–ä¿¡æ¯å¦‚å±žæ€§çš„çˆ¶å¯¹è±¡,query æ ¹å¯¹è±¡æˆ– query ä¸Šä¸‹æ–‡å¯¹è±¡).ä¸Šä¾‹ä¸­,executionå°†ä¼šåœ¨ data fetcher è¿”å›žç»“æžœåŽæ‰ç»§ç»­æ‰§è¡Œ.å¯ä»¥é€šè¿‡è¿”å›žCompletionStage å¯¹è±¡ä½¿ DataFetcher å¼‚æ­¥æ‰§è¡Œ,è¯¦æƒ…è¯·ç»§ç»­é˜…è¯». å½“èŽ·å–æ•°æ®æ—¶å‘ç”Ÿå¼‚å¸¸å¦‚æžœåœ¨ data fetcher è°ƒç”¨ä¸­å‘ç”Ÿå¼‚å¸¸,é‚£ä¹ˆé»˜è®¤æ‰§è¡Œç­–ç•¥å°†ç”Ÿæˆgraphql.ExceptionWhileDataFetching é”™è¯¯,ç„¶åŽæ·»åŠ åˆ°ç»“æžœä¸­çš„é”™è¯¯é›†ä¸­.åˆ‡è®° graphql å…è®¸å¸¦é”™è¯¯çš„éƒ¨åˆ†ç»“æžœ.ä¸‹é¢æ˜¯æ ‡å‡†çš„è¡Œä¸º. 1234567891011121314public class SimpleDataFetcherExceptionHandler implements DataFetcherExceptionhandler &#123; private static final Logger log = LoggerFactory.getLogger(SimpleDataFetcherExceptionHandler.class); @Override public void accept(DataFetcherExceptionHandlerParameters handlerParameters) &#123; Throwable exception = handlerParameters.getException(); SourceLocation sourceLocation = handlerParameters.getField().getSourceLocation(); ExecutionPath path = handlerParameters.getPath(); ExceptionWhileDataFetching error = new ExceptionWhileDataFetching(path,exception,sourceLocation); handlerParameters.getExecutionContext().addError(error); log.warn(error.getMessage(),exception); &#125;&#125; å¦‚æžœä½ æŠ›å‡ºçš„æ˜¯GraphqlError,é‚£ä¹ˆå®ƒä¼šä»Ž exception ä¸­è½¬æ¢ message å’Œè‡ªå®šä¹‰æ‰©å±•å±žæ€§åˆ° ExceptionWhileDataFetchingå¯¹è±¡.æ­¤å¤„å…è®¸ä½ å‘è°ƒç”¨è€…è¿”å›žè‡ªå®šä¹‰çš„å±žæ€§åˆ° graphql error.ä¾‹å¦‚æƒ³è±¡ä½ çš„ data fetcher å°†æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸.foo å’Œ fizz å±žæ€§å°†è¢«æ·»åŠ åˆ°è¿”å›žçš„ graphql error ä¸­. 12345678910111213141516171819class CustomRuntimeException extends RuntimeException implements GrapQLError &#123; @Override public Map&lt;String,Object&gt; getExtension() &#123; Map&lt;String,Object&gt; customAttributes = new LinkedHashMap&lt;&gt;(); customAttributes.put("foo","bar"); cutomAttributes.put("fizz","whizz"); return customAttributes; &#125; @Override public List&lt;SourceLocation&gt; getLocation() &#123; return null; &#125; @Override public ErrorType getErrorType() &#123; return ErrorType.DataFetchingException; &#125;&#125; ä½ å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå·±çš„ graphql.execution.DataFetcherExceptionHandlerå¼‚å¸¸å¤„ç†ä»£ç æ”¹å˜æ­¤é»˜è®¤è¡Œä¸º,ç»™å‡ºä½ è‡ªå·±çš„æ‰§è¡Œç­–ç•¥.ä¾‹å¦‚ä¸Šé¢çš„ä»£ç è®°å½•äº†åŸºç¡€å¼‚å¸¸å’Œå †æ ˆè·Ÿè¸ª.æœ‰çš„äººå¯èƒ½ä¸å–œæ¬¢åœ¨è¾“å‡ºé”™è¯¯åˆ—è¡¨ä¸­çœ‹åˆ°è¿™äº›.æ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæœºåˆ¶æ”¹å˜è¿™ä¸ªè¡Œä¸º. 1234567DataFetcherExceptionHandler handler = new DataFetcherExceptionHandler() &#123; @Override public void accept(DataFetcherExceptionHandlerParameters handlerParameters) &#123; &#125;&#125;;ExecutionStrategy executionStrategy = new AsyncExecutionStrategy(handler); è¿”å›žå€¼å’Œé”™è¯¯åœ¨DataFetcherå®žçŽ°ä¸­é€šè¿‡ç›´æŽ¥æˆ–è€…ä½¿ç”¨ CompletableFuture å®žä¾‹åŒ…è£…å¼‚æ­¥æ‰§è¡Œè¿”å›ž graphql.execution.DataFetcherResult æ¥å®žçŽ°åŒæ—¶è¿”å›žæ•°æ®å’Œå¤šä¸ªé”™è¯¯.å½“ä½ çš„DataFetcher éœ€è¦ä»Žå¤šä¸ªæ•°æ®æºæˆ–å…¶ä»– GraphQL èµ„æºèŽ·å–æ•°æ®æ—¶ç‰¹åˆ«æœ‰ç”¨.åœ¨è¿™ä¸ª ðŸŒ° ä¸­,DataFetcher ä»Žå¦ä¸€ä¸ª GraphQL èµ„æºä¸­èŽ·å– user åŒæ—¶è¿”å›žæ•°æ®å’Œé”™è¯¯. 1234567891011DataFetcher userDataFetcher = new DataFetcher() &#123; @Override public Object get(DataFetchingEnvironment environment) &#123; Map response = fetchUserFromRemoteGraphQLResource(environment.getArgument("userID")); List&lt;GralhQLError&gt; errors = response.get("errors) .stream() .map(MyMapGraphQLError::new) .collect(Collections.toList()); return new DataFetcherResult(response.get("data"),errors); &#125;&#125; å°†ç»“æžœåºåˆ—åŒ–ä¸º JSONè°ƒç”¨ graphql æœ€å¸¸è§çš„æ–¹æ³•æ˜¯é€šè¿‡ HTTP,è¿”å›ž JSON å“åº”.æ‰€ä»¥ä½ éœ€è¦å°† graphql.ExecutionResult è½¬ä¸º JSON.æœ€å¸¸ç”¨çš„å®žçŽ°æ˜¯ä½¿ç”¨ Jackson æˆ– GSON è¿™æ ·çš„ JSON åºåˆ—åŒ–åº“.ç„¶è€Œå®ƒä»¬è§£æžæ•°æ®çš„æ–¹å¼æœ‰å®ƒä»¬è‡ªå·±çš„ä¸€å¥—æ–¹å¼.ä¾‹å¦‚ nullså¯¹ graphql ç»“æžœæ˜¯å¾ˆé‡è¦çš„,æ‰€ä»¥ä½ å¿…é¡»åœ¨è®¾ç½® json mapper æ—¶åŒ…å«å®ƒ.ä¸ºäº†ä¿è¯ä½ èŽ·å–çš„ JSON ç»“æžœ 100% ç¬¦åˆ graphql çš„éœ€æ±‚,ä½ åº”è¯¥å¯¹ç»“æžœè°ƒç”¨toSpecification,ç„¶åŽå°†å…¶ä½œä¸º JSON è¿”å›ž.è¿™å°†ä¼šç¡®ä¿è¿”å›žçš„ç»“æžœç¬¦åˆè§„èŒƒ. 123ExecutionResult executionResult = graphQL.execute(executinInput);Map&lt;String,Object&gt; toSpecificationResult = executionResult.toSpecification();sendAsJson(toSpecificationResult); Mutationsåœ¨è¿™å„¿å­¦ä¹  mutations.æœ¬è´¨ä¸Šä½ éœ€è¦å®šä¹‰ä¸€ä¸ªæŽ¥æ”¶å‚æ•°ä½œä¸ºè¾“å…¥çš„ GraphQLObjectType .è¿™äº›å‚æ•°ä½ å¯ä»¥é€šè¿‡ data fetcher è°ƒç”¨ä¿®æ”¹ä½ çš„æ•°æ®å­˜å‚¨. 123456mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) &#123; createReview(episode: $ep, review: $review) &#123; stars commentary &#125;&#125; åœ¨æ‰§è¡Œ mutation æ“ä½œä¸­éœ€è¦ä¼ é€’å‚æ•°,æœ¬ä¾‹ä¸­æ˜¯ $ep å’Œ $review å‚æ•°.ä½ å¯ä»¥åƒè¿™æ ·åˆ›å»ºç±»åž‹å¤„ç† mutation æ“ä½œ. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455GraphQLInputObjectType episodeType = newInputObject() .name("Episode") .field(newInputObjectField() .name("episodeNumber") .type(Scalars.GraphQLInt)) .build();GraphQLInputObjectType reviewInputType = newInputObject() .name("ReviewInput") .field(newInputObjectField() .name("stars") .type(Scalars.GraphQLString) .name("commentary") .type(Scalars.GraphQLString)) .build();GraphQLObjectType reviewType = newObject() .name("Review") .field(newFieldDefinition() .name("stars") .type(GraphQLString)) .field(newFieldDefinition() .name("commentary") .type(GraphQLString)) .build();GraphQLObjectType createReviewForEpisodeMutation = newObject() .name("CreateReviewForEpisodeMutation") .field(newFieldDefinition() .name("createReview") .type(reviewType) .argument(newArgument() .name("episode") .type(episodeType) ) .argument(newArgument() .name("review") .type(reviewInputType) ) ) .build();GraphQLCodeRegistry codeRegistry = newCodeRegistry() .dataFetcher( coordinates("CreateReviewForEpisodeMutation", "createReview"), mutationDataFetcher() ) .build();GraphQLSchema schema = GraphQLSchema.newSchema() .query(queryType) .mutation(createReviewForEpisodeMutation) .codeRegistry(codeRegistry) .build(); è¯·æ³¨æ„è¾“å…¥å‚æ•°ç±»åž‹æ˜¯ GraphQLInputObjectType.è¿™æ˜¯å¾ˆé‡è¦çš„.è¾“å…¥ç±»åž‹åªèƒ½æ˜¯è¿™ç§ç±»åž‹,ç»ä¸èƒ½ä½¿ç”¨è¾“å‡ºç±»åž‹å¦‚ GraphQLObjectType.æ ‡é‡ç±»åž‹æ—¢å¯ä»¥æ˜¯è¾“å…¥ç±»åž‹ä¹Ÿå¯ä»¥æ˜¯è¾“å‡ºç±»åž‹.è¿™ä¸ª data fetcher æ‰§è¡Œ mutation,è¿”å›žä¸€äº›æœ‰æ„ä¹‰çš„è¾“å‡ºå€¼. 1234567891011121314private DataFetcher mutationDataFetcher() &#123; return new DataFetcher() &#123; @Override public Review get(DataFetchingEnvironment environment) &#123; Map&lt;String,Object&gt; episodeInputMap = environemnt.getArugment("episode"); Map&lt;String,Object&gt; reviewInputMap = environment.getArugment("review"); EpisodeInput episodeInput = EpisodeInput.fromMap(episodeInputMap); ReviewInput reviewInput = ReviewInput.fromMap(reviewInputMap); Review updatedReview = reviewStore().update(episodeInput, reviewInput); return updatedReview; &#125; &#125;&#125; å¼‚æ­¥æ‰§è¡Œgraphql-java æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯ä»¥å®Œå…¨æ”¯æŒå¼‚æ­¥æ‰§è¡Œ.ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ executeAsync() èŽ·å– CompletableFutureçš„ç»“æžœ. 1234567GraphQL graphql = buildSchema();ExecutionInput executionInput = ExecutionInput.newExecutionInput().query("query &#123; hero &#123; name &#125;&#125;").build();CompletableFuture&lt;ExecutionResult&gt; promise = graphql.executeAsync(executionInput);promise.thenAccept(executinoResult -&gt; &#123; encodeResultToJsonAndSendResponse(executionResult);&#125;);promise.join(); ä½¿ç”¨ CompletableFuture å¯ä»¥åœ¨æ‰§è¡Œå®Œæˆæ—¶ç»„åˆ action å’Œ function.æœ€ç»ˆè°ƒç”¨ join() ç­‰å¾…æ‰§è¡Œå®Œæˆ.graphql-java ä½¿ç”¨å¼‚æ­¥æ‰§è¡Œçš„åŽŸç†æ˜¯é€šè¿‡ join è°ƒç”¨é€šè¿‡æ–¹æ³•execute().æ‰€ä»¥ä¸‹é¢çš„ä»£ç æ•ˆæžœæ˜¯ä¸€æ ·çš„. 123ExecutionResult executionResult = graphql.execute(executionInput);CompletableFuture&lt;ExecutionResult&gt; promise = graphql.executeAsync(executionInput);ExecutionResult executionResult = promise.join(); å¦‚æžœ graphql.schema.DataFetcher è¿”å›žçš„æ˜¯ CompletableFuture&lt;T&gt; å¯¹è±¡,é‚£ä¹ˆè¿™ä¸ªç»“æžœå°†è¢«ç»„åˆè¿›æ•´ä¸ªå¼‚æ­¥æŸ¥è¯¢æ‰§è¡Œä¸­.è¿™æ„å‘³ç€ä½ å¯ä»¥å¹¶è¡Œå‘èµ·å¤šä¸ªå±žæ€§æŸ¥è¯¢è¯·æ±‚.ä½ ä½¿ç”¨çš„çº¿ç¨‹æ± ç­–ç•¥å–å†³äºŽä½ çš„ data fetcher ä»£ç .ä¸‹é¢çš„ä»£ç é‡‡ç”¨äº†æ ‡å‡†çš„ java.util.concurrent.ForkJoinPool.commonPool() çº¿ç¨‹æ‰§è¡Œå™¨åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹æä¾›æ•°æ®. 123456789DataFetcher userDataFetcher = new DataFetcher() &#123; @Override public Object get(DataFetchingEnvironment environment) &#123; CompletableFuture&lt;User&gt; userPromise = CompletableFuture.supplyAsync(() -&gt; &#123; return fetchUserViaHttp(environment.getArgument("userId")); &#125;); return userPromise; &#125;&#125; ä¸Šé¢çš„ä»£ç ç”¨ Java8 Lambdas å¯ä»¥ç®€ç•¥ä¸º: 1DataFetcher userDataFetcher = environment -&gt; CompletableFuture.supplyAsync(() -&gt; fetchUserViaHttp(environment.getArgument("userId")); graphql-java å¼•æ“Žç¡®ä¿æ‰€æœ‰çš„ CompletableFuture å¯¹è±¡éµç…§ graphql è§„èŒƒç»„åˆåœ¨ä¸€èµ·æä¾›æ‰§è¡Œç»“æžœ.è¿™æ˜¯ graphql-java åˆ›å»ºå¼‚æ­¥ data fetcher çš„å¿«æ·æ–¹å¼.ä½¿ç”¨ graphql.schema.AsyncDataFetcher.async(DataFetcher&lt;T&gt;) åŒ…è£…ä¸€ä¸ª DataFetcher.å¯ä»¥ä½¿ç”¨é™æ€å¯¼å…¥åˆ›å»ºæ›´æ˜“è¯»çš„ä»£ç . 1DataFetcher userDataFetcher = async(environment -&gt; fetchUserViaHttp(environment.getArgument("userId"))); æ‰§è¡Œç­–ç•¥ç»§æ‰¿ graphql.execution.ExecutionStrategy çš„ç±»å¯ä»¥ç”¨äºŽè¿è¡Œä¸€ä¸ªæŸ¥è¯¢æˆ–ä¿®æ”¹. graphql-java æä¾›äº†å¤§é‡ä¸åŒçš„ç­–ç•¥,å¦‚æžœä½ éžå¸¸è¿«åˆ‡,ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„.å½“ä½ åˆ›å»º Graphql å¯¹è±¡æ—¶å¯ä»¥ç¡®å®šæ‰§è¡Œç­–ç•¥. 1234GraphQL.newGraphQL(schema) .queryExecutionStrategy(new AsyncExecutionStrategy()) .mutationExecutionStrategy(new AsyncSerialExecutionStrategy()) .build(); å®žé™…ä¸Šä¸Šé¢çš„ä»£ç å’Œé»˜è®¤è®¾ç½®ä¸€è‡´,å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªæ˜Žæ™ºçš„ç­–ç•¥é€‰æ‹©. å¼‚æ­¥æ‰§è¡Œç­–ç•¥é»˜è®¤çš„æŸ¥è¯¢æ‰§è¡Œç­–ç•¥æ˜¯ graphql.execution.AsyncExecutionStrategy,ä¼šæŠŠæ¯ä¸€ä¸ªå±žæ€§ä½œä¸º CompletableFuture å¯¹è±¡åˆ†å‘,å¹¶ä¸”ä¸å…³å¿ƒå“ªä¸ªæœ€å…ˆå®Œæˆ.æ­¤ç­–ç•¥æ˜¯æ€§èƒ½æœ€ä½³çš„æ‰§è¡Œç­–ç•¥.data fetchers æœ¬èº«ä¼šè¿”å›ž CompletionStage å€¼,è¿™å°†å¯¼è‡´å®Œå…¨å¼‚æ­¥çš„è¡Œä¸º. 12345678910query &#123; hero &#123; enemies &#123; name &#125; friends &#123; name &#125; &#125;&#125; AsyncExecutionStrategy è‡ªç”±åˆ†å‘ enemies å±žæ€§å’Œ friendså±žæ€§.enemies å±žæ€§ä¸å¿…ç­‰å¾… friendså±žæ€§è¿”å›ž.è¿™æ˜¯éžå¸¸ä½Žæ•ˆçš„.æ— è®ºå¦‚ä½•,æœ€ç»ˆä¼šå°†ç»“æžœæŒ‰é¡ºåºæŽ’åˆ—.æŸ¥è¯¢ç»“æžœå°†éµç…§ graphql è§„èŒƒ,è¿”å›žç»“æžœå¯¹åº” query å±žæ€§é¡ºåº.åªæœ‰ data fetcher çš„æ‰§è¡Œæ˜¯éšæœºé¡ºåº. å¼‚æ­¥åºåˆ—åŒ–æ‰§è¡Œç­–graphql è§„èŒƒè¦æ±‚ mutation å¿…é¡»æŒ‰ç…§ query å±žæ€§çš„é¡ºåºåºåˆ—åŒ–æ‰§è¡Œ.æ‰€ä»¥ mutation é»˜è®¤ä½¿ç”¨ graphql.execution.AsyncSerialExecutionStrategy ç­–ç•¥.å®ƒä¼šä¿è¯åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªå’ŒåŽé¢å‰å½“å‰çš„æ¯ä¸ªå±žæ€§æ‰§è¡Œå®Œæ¯•.ä¹Ÿå¯ä»¥åœ¨ mutation data fetcher ä¸­è¿”å›ž CompletionStage å¯¹è±¡,å¹¶ä¸”ä¼šæŒ‰é¡ºåºåœ¨ä¸‹ä¸€ä¸ª mutation å±žæ€§ data fetcher è¢«åˆ†å‘ä¹‹å‰æ‰§è¡Œå®Œæ¯•. è®¢é˜…æ‰§è¡Œç­–ç•¥graphql å…è®¸å¯¹ graphql data åˆ›å»ºæœ‰çŠ¶æ€çš„è®¢é˜….å¯ä»¥ä½¿ç”¨ SubscriptionExecutionStrategyå®žçŽ°,åŒæ—¶æ”¯æŒ reactive-stream API.æŸ¥çœ‹äº†è§£æ›´å¤šåŸºäºŽ graphql æœåŠ¡çš„è®¢é˜…æ”¯æŒ. æŸ¥è¯¢ç¼“å­˜åœ¨ graphql-java å¼•æ“Žæ‰§è¡ŒæŸ¥è¯¢ä¹‹å‰å¿…é¡»è¢«è§£æžå’Œæ£€éªŒ,å¹¶ä¸”è¿™ä¸ªå¤„ç†è¿‡ç¨‹å¯èƒ½æœ‰äº›è€—æ—¶.ä¸ºäº†é¿å…é‡å¤è§£æž/æ ¡éªŒGraphQL.Builderå…è®¸PreparsedDocumentProviderå®žä¾‹å¤ç”¨Documentå®žä¾‹.æ³¨æ„ âš ï¸,è¿™åªç¼“å­˜è§£æžçš„ Document,ä¸ç¼“å­˜æŸ¥è¯¢ç»“æžœ 1234Cache&lt;String,PreparsedDocumentEntry&gt; cache = Caffeine.newBuilder().maximumSize(10_000).build();GraphQL graphql = GraphQL.newGraphQL(StarWarsSchema.starWarsSchema) .preparsedDocumentProvider(cache::get) .build(); è¿™ä¸ªç¼“å­˜å®žä¾‹åº”è¯¥æ˜¯çº¿ç¨‹å®‰å…¨å…±äº«çš„. PreparsedDocumentProvider æ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ª get æ–¹æ³•çš„å‡½æ•°æŽ¥å£,æˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€ä¸ªæ–¹æ³•å¼•ç”¨åˆ°é‡Œé¢ä»¥åŒ¹é… builder çš„ç­¾å. ä¸ºäº†å®žçŽ°é«˜ç¼“å­˜è¦†ç›–çŽ‡,æŽ¨èå±žæ€§å‚æ•°é€šè¿‡å˜é‡ä¼ é€’è€Œä¸æ˜¯ç›´æŽ¥åœ¨ query ä¸­å®šä¹‰.ä¸‹é¢çš„æŸ¥è¯¢: 12345query HelloTo &#123; sayHello(to: &quot;ME&quot;) &#123; greeting &#125;&#125; åº”è¯¥è¿™æ ·å†™: 12345query HelloTo($to: String!) &#123; sayHello(to: $to) &#123; greeting &#125;&#125; å’Œå˜é‡ 123&#123; &quot;to&quot;: &quot;Me&quot;&#125; çŽ°åœ¨å°±å¯ä»¥ä¸ç®¡æä¾›çš„å˜é‡æ˜¯ä»€ä¹ˆè€Œé‡ç”¨æŸ¥è¯¢.]]></content>
  </entry>
  <entry>
    <title><![CDATA[GraphQL-DataFetcher]]></title>
    <url>%2F2019%2F04%2F27%2FGraphQL-DataFetcher%2F</url>
    <content type="text"><![CDATA[èŽ·å–æ•°æ®graphql å¦‚ä½•èŽ·å–æ•°æ®graphql ä¸­çš„æ¯ä¸ªå±žæ€§éƒ½å…³è”äº†ä¸€ä¸ª graphql.schema.DataFetcher.ä¸€äº›å±žæ€§ä¼šä½¿ç”¨ä¸“ç”¨çš„ data fetcher ä»Žæ•°æ®åº“èŽ·å–è¯¥å±žæ€§çš„ç›¸å…³ä¿¡æ¯.è€Œå¤§å¤šæ•°ç®€å•çš„ä½¿ç”¨å±žæ€§åå’Œ Plain Old Java Object(POJO)æ¨¡å¼ ä»Žå†…å­˜ä¸­èŽ·å–æ•°æ®.åœ¨å…¶ä»– graphql å®žçŽ°ä¸­ï¼ŒData fetcher è¢«ç§°ä¸º resolverçŽ°åœ¨å£°æ˜Žä¸€ä¸ªç±»åž‹å®šä¹‰: 123456789101112type Query &#123; products(match: String): [Product] # a list of products&#125;type Product &#123; id: ID name: String description: String cost: Float tax: Float launchDate(dateFormat: String = &quot;dd,MM,yyyy&quot;): String&#125;]]></content>
      <tags>
        <tag>DataFetcher</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç§»åŠ¨ä¼˜å…ˆçš„å“åº”å¼ç½‘é¡µè®¾è®¡]]></title>
    <url>%2F2019%2F04%2F12%2F%E7%A7%BB%E5%8A%A8%E4%BC%98%E5%85%88%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BD%91%E9%A1%B5%E8%AE%BE%E8%AE%A1%2F</url>
    <content type="text"><![CDATA[åŽŸæ–‡ ç®€ä»‹æœ¬æ–‡å°†æŽ¢ç´¢å¦‚ä½•åˆ›å»ºç§»åŠ¨ä¼˜å…ˆçš„ç½‘é¡µè®¾è®¡ä½“éªŒã€‚ ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºç§»åŠ¨ä¼˜å…ˆï¼Œå“åº”å¼ï¼Œé€‚åº”å¼ç½‘é¡µè®¾è®¡ä½“éªŒ? å¦‚ä½•é’ˆå¯¹é€‚åº”å¼ç«™ç‚¹ç»„ç»‡ HTML ç»“æž„ä»¥ä¾¿ä¼˜åŒ–æ€§èƒ½ï¼Œä¼˜å…ˆè€ƒè™‘çµæ´»æ€§? å¦‚ä½•ä¹¦å†™ä¼˜å…ˆå®šä¹‰å…±äº«æ ·å¼ã€é’ˆå¯¹å¤§å±å’Œåª’ä½“æŸ¥è¯¢æž„å»ºã€ä½¿ç”¨ç›¸å¯¹å•ä½çš„ CSS? å¦‚ä½•ç¼–å†™ä¸å¼•äººæ³¨ç›®çš„ Javascript æ¥æœ‰æ¡ä»¶åœ°åŠ è½½å†…å®¹ç‰‡æ®µï¼Œåˆ©ç”¨è§¦æ‘¸äº‹ä»¶å’Œåœ°ç†å®šä½ æˆ‘ä»¬å¯ä»¥åšäº›ä»€ä¹ˆæ¥è¿›ä¸€æ­¥å¢žå¼ºæˆ‘ä»¬çš„é€‚åº”æ€§ä½“éªŒ é€‚åº”æ€§çš„å¿…è¦æ€§éšç€ç½‘ç»œçŽ¯å¢ƒè¶Šæ¥è¶Šå¤æ‚ï¼Œä¸ºè¶Šæ¥è¶Šå¤šçš„çŽ¯å¢ƒæä¾›å¯é çš„ç½‘ç»œä½“éªŒå˜å¾—æžä¸ºé‡è¦.å¹¸è¿çš„æ˜¯ï¼Œå“åº”å¼ web è®¾è®¡ç»™ web å¼€å‘è€…æä¾›äº†ä¸€äº›å¯ä»¥åŒ¹é…ä»»æ„å¤§å°å±å¹•çš„å·¥å…·æ¥ç»„ç»‡å¸ƒå±€.]]></content>
      <tags>
        <tag>ç¿»è¯‘</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¸¸ç”¨å‘½ä»¤è®°å½•]]></title>
    <url>%2F2019%2F03%2F28%2F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[Homebrewgradle-completion1234567891011121314brew install gradle-completionecho $fpath | grep "/usr/local/share/zsh/site-functions"# æ‰§è¡Œç»“æžœAdd the following line to your ~/.bash_profile: [[ -r "/usr/local/etc/profile.d/bash_completion.sh" ]] &amp;&amp; . "/usr/local/etc/profile.d/bash_completion.sh"Bash completion has been installed to: /usr/local/etc/bash_completion.d==&gt; gradle-completionBash completion has been installed to: /usr/local/etc/bash_completion.dzsh completions have been installed to: /usr/local/share/zsh/site-functions]]></content>
  </entry>
  <entry>
    <title><![CDATA[gradle]]></title>
    <url>%2F2019%2F03%2F28%2Fgradle%2F</url>
    <content type="text"><![CDATA[Gradle å‡çº§æ—¥å¿—5.0 åŒ…å«äº† Kotlin DSL ç”Ÿäº§çº§æ”¯æŒ,ä¾èµ–ç‰ˆæœ¬å¯¹é½(ç±»ä¼¼ Maven BOM),ä»»åŠ¡è¶…æ—¶,Java 11 æ”¯æŒ Kotlin DSL 1.0 ä¾èµ–ç‰ˆæœ¬å¯¹é½: åŒä¸€é€»è¾‘ç»„(platform)ä¸‹çš„ä¸åŒæ¨¡å—åœ¨ä¾èµ–æ ‘ä¸­å¯ä»¥æœ‰ç›¸åŒçš„ç‰ˆæœ¬.ä¹Ÿå¯ä»¥å¯¼å…¥ Maven BOMs å®šä¹‰ platform. 123456789dependencies &#123; // å¯¼å…¥ BOM.æ­¤æ–‡ä»¶ä¸­ç‰ˆæœ¬å°†è¦†ç›–ä¾èµ–æ ‘ä¸­çš„å…¶ä»–ç‰ˆæœ¬ implementation(enforcedPlatform("org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE")) // ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ç‰ˆæœ¬ implementation("com.google.code.gson:gson") implementation("dom4j:dom4j") // è¦†ç›–ä¸Šé¢çš„ç‰ˆæœ¬ implementation("org.codehaus.groovy:groovy:1.8.6")&#125; Gradle build åˆå§‹åŒ–ç‰¹æ€§ å¯æœç´¢æ–‡æ¡£ ä»»åŠ¡è¶…æ—¶ è§£æžä¾èµ–æ—¶ HTTP é‡è¯• æ€§èƒ½ç‰¹æ€§ Gradle å¯ä»¥ä½œä¸ºä¸€ä¸ªä½Žä¼˜å…ˆçº§çš„è¿›ç¨‹å¯åŠ¨: â€“priority low æˆ–è€… org.gradle.priority=low.å¯ä»¥ä¿è¯ IDE/Browser ä¸å¡,å³ä½¿æ˜¯ä¸€ä¸ªå¾ˆæ¶ˆè€—èµ„æºçš„ gradle ä»»åŠ¡. å¤šä»»åŠ¡è¾“å‡ºå±žæ€§ä¸å†ç¦ç”¨ç¼“å­˜.å½“ä½¿ç”¨ @OutputFiles æˆ– OutputDirectories æ ‡è®°ä¸€ä¸ªIterableç±»åž‹,Gradle é€šå¸¸ä¼šå¯¹è¯¥ä»»åŠ¡ç¦ç”¨ç¼“å­˜ä¸”è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯: 1Declares multiple output files for the single output property 'outputFiles' via @OutputFiles,@OutputDirectories or TaskOutputs.files() çŽ°åœ¨ä¸ä¼šå†é˜»æ­¢ç¼“å­˜äº†.å¯¹è¯¥ä»»åŠ¡ç¦ç”¨ç¼“å­˜çš„å”¯ä¸€ç†ç”±å¯èƒ½æ˜¯å¦‚æžœè¾“å‡ºåŒ…å«æ–‡ä»¶æ ‘. Java 11 è¿è¡Œæ—¶æ”¯æŒ æ’ä»¶æŽˆæƒç‰¹æ€§ Provider è¿½è¸ªäº§å“ä»»åŠ¡ï¼šProvider API å®žä¾‹æä¾›äº†è¿½è¸ªæŸå€¼å’Œä»»åŠ¡æˆ–ç”Ÿæˆè¯¥å€¼çš„ä»»åŠ¡ã€‚ Gradle Native ç‰¹æ€§ æŽ¨å¹¿ç‰¹æ€§ Gradle ç¼–è¯‘è¯­è¨€æŒ‡å—gradle å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æˆ– DSL æ¥æ‰§è¡Œç¼–è¯‘ä»»åŠ¡åŸºæœ¬æ¦‚å¿µç†è§£ä»¥ä¸‹æ¦‚å¿µå¯ä»¥å¸®åŠ©ä¹¦å†™ gradle è„šæœ¬.é¦–å…ˆï¼Œgradle è„šæœ¬æ˜¯ä¸€ç§å¯é…ç½®è„šæœ¬.å½“è„šæœ¬æ‰§è¡Œæ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç‰¹å®šç±»åž‹çš„é…ç½®å¯¹è±¡.ä¾‹å¦‚ build script æ‰§è¡Œæ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç±»åž‹ä¸º Project çš„é…ç½®å¯¹è±¡.è¿™ä¸ªå¯¹è±¡ä½œä¸ºè„šæœ¬çš„ä»£ç†å¯¹è±¡è¢«ä½¿ç”¨.ä¸‹é¢æ˜¾ç¤ºäº† gradle è„šæœ¬å¯¹åº”çš„ä»£ç†å¯¹è±¡. è„šæœ¬ç±»åž‹ ä»£ç†å¯¹è±¡ build script Project init script Gradle settings script settings åœ¨è„šæœ¬å†…å¯ä»¥ä½¿ç”¨è¿™äº›ä»£ç†å¯¹è±¡çš„å±žæ€§å’Œæ–¹æ³•. build script ç»“æž„ä¸€æ®µç¼–è¯‘è„šæœ¬ç”± 0 ä¸ªæˆ–å¤šä¸ªè¯­å¥å’Œè„šæœ¬å—ç»„æˆã€‚è¯­å¥å¯ä»¥åŒ…å«æ–¹æ³•è°ƒç”¨ï¼Œå±žæ€§èµ‹å€¼ï¼Œå®šä¹‰å±€éƒ¨å˜é‡ã€‚ä¸€ä¸ªè„šæœ¬å—æ˜¯ä¸€ä¸ªæŽ¥å— closure ä½œä¸ºå‚æ•°çš„æ–¹æ³•è°ƒç”¨.è¿™ä¸ª closure å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå½“å…¶æ‰§è¡Œæ—¶é…ç½®äº†ä¸€äº›ä»£ç†å¯¹è±¡çš„å¯é…ç½® closure. æœ€é¡¶å±‚çš„è„šæœ¬å—å¦‚ä¸‹ è„šæœ¬å— æè¿° allprojects{} é…ç½®æ­¤é¡¹ç›®åŠå…¶æ‰€æœ‰å­é¡¹ç›® artifacts{} é…ç½®æ­¤é¡¹ç›®çš„å‘å¸ƒäº§ç‰© buildscript{} é…ç½®æ­¤é¡¹ç›®çš„ build script classpath configurations{} é…ç½®æ­¤é¡¹ç›®çš„ä¾èµ–é…ç½®é¡¹ dependencies{} é…ç½®æ­¤é¡¹ç›®çš„ä¾èµ– repositories{} é…ç½®æ­¤é¡¹ç›®çš„ä»“åº“ sourceSets{} é…ç½®æ­¤é¡¹ç›®çš„ source set subprojects{} é…ç½®æ­¤é¡¹ç›®çš„å­é¡¹ç›® publishing{} é…ç½®ç”± publishing plugin æ·»åŠ çš„ publishingExtension ä¸€æ®µç¼–è¯‘è„šæœ¬åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª groovy è„šæœ¬,æ‰€ä»¥å¯ä»¥åŒ…å«èƒ½å‡ºçŽ°åœ¨ groovy è„šæœ¬ä¸­çš„å…ƒç´ ,å¦‚ æ–¹æ³•å®šä¹‰ï¼Œç±»å®šä¹‰ æ ¸å¿ƒç±»åž‹ä»¥ä¸‹æ˜¯åœ¨ gradle è„šæœ¬ä¸­å¸¸ç”¨çš„æ ¸å¿ƒç±»åž‹ ç±»åž‹ æè¿° Project æ­¤æŽ¥å£æ˜¯ä½ åœ¨ä½ çš„ç¼–è¯‘è„šæœ¬ä¸­æœ€å¸¸ä½¿ç”¨çš„ APIã€‚é€šè¿‡ Project,ä½ å¯ä»¥ä½¿ç”¨ gradle çš„æ‰€æœ‰ç‰¹æ€§ Task ä¸€ä¸ª task ä»£è¡¨ä¸€ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå•ä¸€åŽŸå­ä»»åŠ¡ï¼Œå¦‚ç¼–è¯‘ class,ç”Ÿæˆ javadoc Gradle è¡¨ç¤º gradle çš„è°ƒç”¨ Settings å£°æ˜Žå®žä¾‹åŒ–å’Œé…ç½®è¦å‚ä¸Žæž„å»ºçš„ Project å®žä¾‹çš„å±‚æ¬¡ç»“æž„æ‰€éœ€çš„é…ç½® Script æ­¤æŽ¥å£ç”±æ‰€æœ‰çš„ gradle è„šæœ¬å®žçŽ°å¹¶æ·»åŠ ä¸€äº› gradle ç‰¹å®šçš„æ–¹æ³•ã€‚å½“ä½ ç¼–è¯‘è„šæœ¬ç±»æ—¶å°†ä¼šå®žçŽ°æ­¤æŽ¥å£ï¼Œä½ å¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨æ­¤æŽ¥å£å£°æ˜Žçš„æ–¹æ³•å’Œå±žæ€§ JavaToolChain ä¸€ç»„ç”¨äºŽç¼–è¯‘ Java æºæ–‡ä»¶çš„å·¥å…· SourceSet è¡¨ç¤º Java æºæ–‡ä»¶å’Œèµ„æºæ–‡ä»¶çš„é€»è¾‘ç»„ SourceSetOutput æ‰€æœ‰è¾“å‡ºç›®å½•çš„é›†åˆ(ç¼–è¯‘çš„ç±»ï¼Œå¤„ç†è¿‡çš„èµ„æºç­‰),SourceSetOutput ç»§æ‰¿è‡ª FileCollection SourceDirectorySet è¡¨ç¤ºä¸€ç»„ç”±ä¸€ç³»åˆ—æºæ–‡ä»¶ç›®å½•ç»„æˆçš„æºæ–‡ä»¶ã€‚ä»¥åŠç›¸å…³çš„ include å’Œ exclude pattern IncrementalTaskInputs æä¾›é€šè¿‡å¢žé‡ä»»åŠ¡è®¿é—®ä»»æ„éœ€è¦è¢«å¤„ç†æ–‡ä»¶çš„é€”å¾„ Configuration è¡¨ç¤ºä¸€ç»„äº§ç‰©åŠå…¶ä¾èµ–ã€‚ä»Ž ConfigurationContainer ä¸­å¯ä»¥èŽ·å–æ›´å¤šå…³äºŽå¯¹ configuration å£°æ˜Žä¾èµ–æˆ–è€…ç®¡ç† configuration çš„ä¿¡æ¯ ResolutingStrategy å®šä¹‰ä¾èµ–è§£æžçš„ç­–ç•¥.ä¾‹å¦‚å¼ºåˆ¶å›ºå®šä¾èµ–ç‰ˆæœ¬å·ï¼Œæ›¿ä»£ï¼Œå†²çªè§£å†³æ–¹æ¡ˆæˆ–å¿«ç…§ ArtifactResolutingQuery å‘èµ·å¯ä»¥è§£æžç‰¹å®šç»„ä»¶çš„æŒ‡å®šè½¯ä»¶äº§ç‰©çš„æŸ¥è¯¢çš„ç”Ÿæˆå™¨ ComponentSelection è¡¨ç¤ºä¸€ä¸ªæ¨¡å—çš„ç»„ä»¶é€‰æ‹©å™¨å’ŒæŸä¸ªç»„ä»¶é€‰ä¸­è§„åˆ™ä¸­è¯„ä¼°çš„å€™é€‰ç‰ˆæœ¬çš„å…ƒç»„ ComponentSelectionRules è¡¨ç¤ºç»„ä»¶é€‰ä¸­è§„åˆ™çš„å®¹å™¨.è§„åˆ™å¯ä»¥ä½œä¸ºä¸€ä¸ª configuration çš„è§£æžè§„åˆ™ä¸€éƒ¨åˆ†è¢«ä½¿ç”¨ï¼Œè€Œä¸”ç‹¬ç«‹çš„ç»„ä»¶å¯ä»¥æ˜Žç¡®æŽ¥å—æˆ–æ‹’ç»è¯¥è§„åˆ™ã€‚æ—¢ä¸æŽ¥å—ä¹Ÿä¸æ‹’ç»çš„ç»„ä»¶å°†è¢«æŒ‡å®šåˆ°é»˜è®¤çš„ç‰ˆæœ¬åŒ¹é…è§„åˆ™ ExtensionAware åœ¨è¿è¡Œæ—¶å¯ä»¥å’Œå…¶ä»–å¯¹è±¡ä¸€èµ·è¢«æ‰©å±•çš„å¯¹è±¡ ExtraPropertiesExtension Gradle åŸŸå¯¹è±¡çš„é™„åŠ  ad-hoc å±žæ€§ PluginDependenciesSpec åœ¨è„šæœ¬ä¸­ä½¿ç”¨çš„å£°æ˜Žæ’ä»¶çš„ DSL PluginDependencySpec æ’ä»¶ä¾èµ–çš„å¯å˜è§„èŒƒ PluginManagementSpec é…ç½®æ’ä»¶å¦‚ä½•è¢«è§£æž ResourceHandler æä¾›è®¿é—®ç‰¹å®šèµ„æºçš„å·¥å…·æ–¹æ³•çš„é€”å¾„,ä¾‹å¦‚åˆ›å»ºå„ç§èµ„æºçš„å·¥åŽ‚æ–¹æ³• TextResourceFactory åˆ›å»ºç”±å­—ç¬¦ä¸²ã€æ–‡ä»¶ã€å­˜æ¡£å®žä½“ç­‰èµ„æºæä¾›çš„ TextResources type-safe model accessorsæ‰§è¡Œæ—¶æœºï¼šplugins{} å—åŽï¼Œscript è„šæœ¬ä¹‹å‰. 123456789101112131415161718192021222324252627282930313233// build.gradle.ktsplugins &#123; `java-library`&#125;dependencies &#123; api(&quot;junit:junit;4.12&quot;) implementation(&quot;junit:junit:4.12&quot;) testImplementation(&quot;junit:junit:4.12&quot;)&#125;configurations &#123; implementation &#123; resolutinStrategy.failOnVersionConflict() &#125;&#125;sourceSets &#123; main &#123; java.srcDir(&quot;src/core/java&quot;) &#125;&#125;java &#123; sourceCompatibility = JavaVersion.VERSION_11 targetCompatibility = JavaVersion.VERSION_11&#125;tasks &#123; test &#123; testLogging.showExceptions = true &#125;&#125; äº†è§£ type-safe accessors ä¸å¯ç”¨æ—¶è¦æ‰§è¡Œçš„æ“ä½œä¸‹é¢çš„è„šæœ¬æ˜Žç¡®ä½¿ç”¨äº† apply() æ–¹æ³•åº”ç”¨æ’ä»¶.ç¼–è¯‘è„šæœ¬æ— æ³•ä½¿ç”¨ type-safe accessors,å› ä¸º apply() æ–¹æ³•æ˜¯åœ¨è¿™ä¸ªç¼–è¯‘è„šæœ¬å†…è°ƒç”¨çš„ã€‚ä½ å¯ä»¥é‡‡ç”¨å…¶ä»–æŠ€å·§ï¼Œå¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031// build.gradle.ktsapply(plugin = &quot;java-library&quot;)dependencies &#123; &quot;api&quot;(&quot;junit:junit:4.12&quot;) &quot;implementation&quot;(&quot;junit:junit:&quot;4.12&quot;) &quot;testImplementation&quot;(&quot;junit:junit:4.12&quot;)&#125;configurations &#123; &quot;implementation&quot; &#123; resolutinStrategy.failOnVersionConflict() &#125;&#125;configure&lt;SourceSetContainer&gt; &#123; named(&quot;main&quot;) &#123; java.srcDir(&quot;src/core/java&quot;) &#125;&#125;configure&lt;JavaPluginConvention&gt; &#123; sourceCompatibility = JavaVersion.VERSION_11 targetCompatibility = JavaVersion.VERSION_11&#125;tasks &#123; named&lt;Test&gt;(&quot;test&quot;) &#123; testLogging.showException = true &#125;&#125; ä¸‹åˆ—æƒ…å†µä¸‹ï¼Œtype-safe accessor ä¸å¯ç”¨ ä½¿ç”¨ apply(plugin = id) åº”ç”¨æ’ä»¶ é¡¹ç›® build script é€šè¿‡ apply(from = â€œscript-plugin.gradle.ktsâ€) åº”ç”¨çš„è„šæœ¬æ’ä»¶ è·¨é¡¹ç›®é…ç½®çš„æ’ä»¶ äº§ç‰©é…ç½®1234567891011121314// build.gradle.jtsapply(plugin = &quot;java-library&quot;)&apos;dependencies &#123; &quot;api&quot;(&quot;junit:junit:4.12&quot;) &quot;implementation&quot;(&quot;junit:junit:4.12&quot;) &quot;testImplementation&quot;(&quot;junit:junit:4.12&quot;)&#125;configurations &#123; &quot;implementation&quot; &#123; resolutinStrategy.failOnVersionConflict() &#125;&#125; 123456789101112131415// settings.gradle.ktspluginManagement &#123; repositories &#123; google() gradlePluginPortal() &#125; resolutionStrategy &#123; eachPlugin &#123; if (requested.id.namespace == &apos;com.android&apos;) &#123; useModule(&apos;com.android.tools.build:gradle:$&#123;requested.version&#125;&apos;) &#125; &#125; &#125;&#125; 1234567891011121314151617181920212223// build.gradle.ktsval check by tasks.existingval myTask1 by tasks.registeringval compileJava by tasks.existing(JavaCompile::class)val myCopy1 by tasks.registering(Copy::class)va; assemble by tasks.existing &#123; dependsOn(myTask1)&#125;val myTask2 by tasks.registering &#123; description = &quot;some meaningful words&quot;&#125;val test by tasks.existing(Test::class) &#123; testLogging.showStackTrace = true&#125;val myCopy2 by tasks.registering(Copy::class) &#123; from(&quot;source&quot;) into(&quot;destination&quot;)&#125; å‡çº§ Gradle Wrapperå¦‚æžœå·²ç»æœ‰åŸºäºŽgradlew wrapperçš„é¡¹ç›®,å¯ä»¥é€šè¿‡è¿è¡Œwrapperä»»åŠ¡æ¥æŒ‡å®šéœ€è¦çš„gradleç‰ˆæœ¬. 1./gradlew wrapper --gradle-version=5.3 --distribution-type=bin å½“ç„¶æ²¡å¿…è¦ä½¿ç”¨gradle wrapperæ¥å®‰è£…gradle.è°ƒç”¨gradlewæˆ–gradlew.batå°†ä¼šä¸‹è½½å¹¶ç¼“å­˜æŒ‡å®šç‰ˆæœ¬çš„ Gradle. 1./gradlew taska CLI è‡ªåŠ¨è¡¥å…¨12brew install gradle-completionecho $fpath | grep "/usr/local/share/zsh/site-functions" è®¾è®¡ gradle æ’ä»¶å¯¹ gradle æ–°æ‰‹æ¥è¯´ï¼Œå®žçŽ° gradle æ’ä»¶å¯èƒ½æ˜¯ä¸€ä¸ªå‘:ç»„ç»‡ç®¡ç†æ’ä»¶é€»è¾‘ï¼Œæµ‹è¯•ã€è°ƒè¯•æ’ä»¶ä»£ç ç­‰.å¯ä»¥åœ¨æ­¤èŽ·å–åˆ°æ›´å¤šçš„ä¿¡æ¯. ### é€šè¿‡æŒ‡å®š subproject çš„è·¯å¾„ï¼Œå¯ä»¥å°†æœ¬åœ°ä»»ä½•è·¯å¾„ä¸‹çš„ä»£ç å¯¼å…¥å·¥ç¨‹ä¸­ï¼Œä¾›æœ¬åœ°å¼€å‘è°ƒè¯•ã€‚ 12include ':lib'project(':lib').projectDir = new File('xxx/xxx/lib') com.android.application æ’ä»¶ applicationVariants 12345678910111213141516// AppExtension ç»§æ‰¿è‡ª BaseExtension å”¯ä¸€æ‰©å±•çš„æˆå‘˜å˜é‡ï¼Œå®ƒçš„å‚æ•°ç±»åž‹æ˜¯ DefaultDomainObjectSet,è¿™æ˜¯ä¸åŒ buildType åŠ Flavor çš„é›†åˆ,applicationVariants æœ€é•¿çš„æ˜¯å®ƒçš„ all æ–¹æ³•ï¼Œå¦‚ä¿®æ”¹ apk åå­—def buildTime() &#123; return new Date().format("yyyy-MM-dd",TimeZone.getTimeZone("UTC"))&#125;android &#123; applicationVariants.all &#123; variant -&gt; variant.outputs.each &#123; output -&gt; def outputFile = output.outputFile if (outputFile != null &amp;&amp; outputFile.name.endsWith('.apk')) &#123; def fileName = "$&#123;variant.buildType.name&#125;-$&#123;variant.versionName&#125;-$&#123;buildTime()&#125;.apk" output.outputFile = new File(output.outputFile.parent,fileName) &#125; &#125; &#125;&#125; defaultConfig 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758defaultConfig &#123; applicationId '**.**.**' applicationIdSuffix '.two' //applicationIdçš„åŽç¼€ï¼Œå¯ä»¥ç”¨åœ¨æƒ³åŒæ—¶å®‰è£…è¿è¡Œä¸¤ä¸ªFlavoråŒ…çš„æ—¶å€™ï¼Œæ¯”å¦‚åŒæ—¶å®‰è£…debugåŒ…å’ŒReleaseåŒ…åšä¸€äº›å¯¹æ¯”ã€‚ minSdkVersion 14 minSdkVersion 14 targetSdkVersion 28 versionCode 1 versionName '1.0' versionNameSuffix '.0' // versionNameåŽç¼€ consumerProguardFiles 'proguard-rules.pro' //ç”¨äºŽLibraryä¸­ï¼Œå¯ä»¥å°†æ··æ·†æ–‡ä»¶è¾“å‡ºåˆ°aarä¸­ï¼Œä¾›Applicationæ··æ·†æ—¶ä½¿ç”¨ã€‚ dimension 'api' //ç»™æ¸ é“ä¸€ä¸ªåˆ†ç»„åŠ ç»´åº¦çš„æ¦‚å¿µï¼Œæ¯”å¦‚ä½ çŽ°åœ¨æœ‰ä¸‰ä¸ªæ¸ é“åŒ…ï¼Œåˆ†æˆå…è´¹å’Œæ”¶è´¹ä¸¤ç§ç±»åž‹ï¼Œ //å¯ä»¥æ·»åŠ ä¸€ä¸ªdimension, æ‰“æ¸ é“åŒ…çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰“å‡º6ä¸ªåŒ…ï¼Œè€Œä¸éœ€è¦æ·»åŠ 6ä¸ªæ¸ é“ï¼Œ // è¯¦ç»†çš„è¯´æ˜Žå¯è§ https://developer.android.com/studio/build/build-variants.html#flavor-dimensionsã€‚ externalNativeBuild &#123; //ndkçš„é…ç½®ï¼ŒAS2.2ä¹‹åŽæŽ¨èåˆ‡æ¢åˆ°cmakeçš„æ–¹å¼è¿›è¡Œç¼–è¯‘ã€‚ cnamke &#123; cppFlags '-frtti --fexceptions' arguments '-DANDROID_ARM_NEON=TRUE' buildStagingDirectory './outputs/cmake' path 'CMakeLists.txt' version '3.7.1' &#125; ndkBuild &#123; path 'Android.mk' buildStagingDirectory './outputs/ndk-build' &#125; &#125; javaCompileOptions &#123; annotationProcessorOptions &#123; // æ³¨è§£çš„é…ç½® includeCompileClasspath true // ä½¿ç”¨æ³¨è§£åŠŸèƒ½ arguments = [ eventBusIndex : 'org.greenrobot.eventbusperf.MyEventBusIndex' ] // AbstractProcessor ä¸­å¯ä»¥è¯»å–åˆ°è¯¥å‚æ•° classNames &#125; &#125; manifestPlaceholders = [key: 'value'] // manifest å ä½ç¬¦ï¼Œå®šä¹‰å‚æ•°ç»™ manifest è°ƒç”¨ï¼Œå¦‚ä¸åŒçš„æ¸ é“id multiDexEnabled true // å¯ç”¨ multiDex multiDexKeepFile file('multiDexKeep.txt') // æ‰‹åŠ¨æ‹†åŒ…ï¼Œå°†å…·ä½“çš„ç±»æ”¾åœ¨ä¸» dex mutliDexKeepProguard file('multiDexKeep.pro') // æ”¯æŒ proguard è¯­æ³•ï¼Œè¿›è¡Œä¸€äº›æ¨¡ç³ŠåŒ¹é…. ndk &#123; abiFilterss 'x86','x86_64','armeabi' // åªä¿ç•™ç‰¹å®šçš„ abi è¾“å‡ºåˆ° apk &#125; proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' // æ··æ·†æ–‡ä»¶çš„åˆ—è¡¨ï¼Œå¦‚é»˜è®¤çš„ android æ··æ·†æ–‡ä»¶åŠæœ¬åœ°çš„ proguard æ–‡ä»¶ï¼Œåˆ‡è®°ä¸è¦é—æ¼ android æ··æ·†æ–‡ä»¶ï¼Œå¦åˆ™å¯¼è‡´ä¸€äº›é»˜è®¤å®‰å“ç»„ä»¶æ— æ³•æ‰¾åˆ° signingConfig &#123; storeFile file('debug.keystore') // ç­¾åæ–‡ä»¶è·¯å¾„ storePassword 'android' // ç­¾åæ–‡ä»¶å¯†ç  keyAlias 'androiddebugkey' // åˆ«å keyPassword 'android' &#125; buildConfigField('boolean','IS_RELEASE','false') // åœ¨ä»£ç ä¸­å¯ä»¥é€šè¿‡ BuildConfig.IS_RELEASE è°ƒç”¨ã€‚é»˜è®¤ false resValue('string','appname','demo') // åœ¨ res/value ä¸­æ·»åŠ  &lt;string name="appname" translatable="false"&gt;demo&lt;/string&gt; resConfigs 'cn','hdpi' // æŒ‡å®šç‰¹å®šèµ„æºï¼Œå¯ä»¥ç»“åˆ productFlavors å®žçŽ°ä¸åŒæ¸ é“çš„æœ€å°çš„ apk åŒ….&#125; productFlavors: æ¸ é“åŒ…çš„åˆ—è¡¨ï¼Œå¯è¦†ç›– defaultConfig çš„å‚æ•°é…ç½®,å½¢æˆè‡ªå·±çš„é£Žå‘³ flavorDimensionList: æ·»åŠ çº¬åº¦çš„å®šä¹‰ resourcePrefix: åœ¨æ¨¡å—åŒ–å¼€å‘ä¸­ç»™æ¯ä¸ªæ¨¡å—æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„èµ„æºå‰ç¼€ï¼Œé¿å…å¤šæ¨¡å—ä½¿ç”¨ç›¸åŒçš„æ–‡ä»¶ååŽåˆå¹¶å†²çªï¼Œåœ¨ build.gradle æŒ‡å®šæ­¤é…ç½®åŽï¼ŒAS ä¼šæ£€æŸ¥ä¸åˆæ³•çš„èµ„æºå‘½åå¹¶æŠ¥é”™ buildTypes: é»˜è®¤æœ‰ debug å’Œ releaseã€‚ 123456789101112debug &#123; applicationIdSuffix '.debug' versionNameSuffix '.1' debugable true // ç”Ÿæˆçš„ apk æ˜¯å¦å¯è°ƒè¯•ï¼Œdebug -&gt; true,release -&gt; false jniDebuggable true // æ˜¯å¦å¯ä»¥è°ƒè¯• NDK ä»£ç ï¼Œä½¿ç”¨ lldb è¿›è¡Œ c/c++ ä»£ç è°ƒè¯• crunchPngs true // æ˜¯å¦å¼€å¯ png ä¼˜åŒ–ï¼Œä¼šå¯¹ png å›¾ç‰‡åšä¸€æ¬¡æœ€ä¼˜åŽ‹ç¼©ï¼Œå½±å“ç¼–è¯‘é€Ÿåº¦, debug -&gt; false,release -&gt; true embedMicroApp true // Android Wear æ”¯æŒ minifyEnabled true // æ˜¯å¦å¼€å¯æ··æ·† renderscriptDebuggable false // æ˜¯å¦å¼€å¯æ¸²æŸ“è„šæœ¬ renderscriptOptimLevel 5 // æ¸²æŸ“è„šæœ¬ç­‰çº§ é»˜è®¤ 5 zipAlignEnabled true // æ˜¯å¦ zip å¯¹é½ä¼˜åŒ–ï¼Œé»˜è®¤ true&#125; ndkDirectory: ä¹Ÿå¯åœ¨ local.properties ä¸­é…ç½® ndk.dir=/Users/shuttle/Library/Android/sdk sdkDirectory: .. aaptOptions: èµ„æºæ‰“åŒ…å·¥å…· 123456aaptOptions &#123; additionalParameters '--rename-manifest-package','cct.cn.gradle.lsn13','-S','src/main/res2','--auto-add-overlay' // appt æ‰§è¡Œæ—¶çš„é¢å¤–å‚æ•° cruncherEnabled true // å¯¹ png è¿›è¡Œä¼˜åŒ–æ£€æŸ¥ ignoreAssets '*.jpg' // å¯¹ res ç›®å½•ä¸‹çš„èµ„æºæ–‡ä»¶è¿›è¡ŒæŽ’é™¤ï¼ŒæŠŠ res æ–‡ä»¶ä¸‹çš„æ‰€æœ‰ .jpg æ–‡ä»¶æ‰“åŒ…åˆ° apk ä¸­ noCompress '.jpg' // å¯¹æ‰€æœ‰ jpg æ–‡ä»¶ä¸åŽ‹ç¼©&#125; adbExecutable: adb è·¯å¾„ adbOptions 1234adbOptions &#123; installOptions '-r','-d' // è°ƒç”¨ adb install å‘½ä»¤æ—¶é»˜è®¤ä¼ é€’çš„å‚æ•° timeOutInMs 1000 // æ‰§è¡Œ adb å‘½ä»¤çš„è¶…æ—¶æ—¶é—´&#125; compileOptions 123456compileOptions &#123; encoding 'UTF-8' // java æºæ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼Œé»˜è®¤ utf8 incrmental true // javaç¼–è¯‘æ˜¯å¦ä½¿ç”¨ gradle å¢žé‡ç¼–è¯‘ sourceCompatibility JavaVersion.VERSION_1_7 // java æºæ–‡ä»¶ç¼–è¯‘çš„ jdk ç‰ˆæœ¬ targetCompatibility JavaVersion.VERSION_1_7 // ç¼–è¯‘å‡ºçš„ class ç‰ˆæœ¬&#125; dataBinding 12345dataBinding &#123; enabled = true version = "1.0" addDefaultAdapters = true&#125; defaultPublishConfig: æŒ‡å®šå‘å¸ƒçš„æ¸ é“åŠ BuildType ç±»åž‹ã€‚åœ¨ Library ä¸­ä½¿ç”¨,é»˜è®¤ Release. signingConfigs: ç­¾åé…ç½®åˆ—è¡¨ï¼Œä¾›ä¸åŒæ¸ é“å’Œ buildType ä½¿ç”¨. lintOptions 12345678910111213141516171819202122232425lintOptions &#123; quiet true // true -&gt; ä¸æŠ¥å‘Šåˆ†æžçš„è¿›åº¦ abortOnError false // true -&gt; å‘çŽ°é”™è¯¯æ—¶ç»ˆæ­¢ gradle ignoreWarnings true // true -&gt; åªæŠ¥å‘Šé”™è¯¯ absolutePaths true // true -&gt; å½“æœ‰é”™è¯¯æ—¶æ˜¾ç¤ºæ–‡ä»¶çš„å…¨è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ checkAllWarnings true // true -&gt; æ£€æŸ¥æ‰€æœ‰é—®é¢˜ï¼ŒåŒ…æ‹¬é»˜è®¤ä¸æ£€æŸ¥é—®é¢˜ warningsAsErrors true // true -&gt; å°†æ‰€æœ‰è­¦å‘Šè§†ä¸ºé”™è¯¯ disable 'TypeographyFractions','TypographyQUotes' // ä¸æ£€æŸ¥ç»™å®šé—®é¢˜ id enable 'RtlHardCoded','RtlCompat','RtlEnabled' // æ£€æŸ¥ç»™å®šé—®é¢˜ id check 'NewApi','InlinedApi' // ä»… æ£€æŸ¥ç»™å®šé—®é¢˜ id noLines true // å¦‚æžœä¸º true,åˆ™åœ¨é”™è¯¯æŠ¥å‘Šçš„è¾“å‡ºä¸­ä¸åŒ…å«æºä»£ç è¡Œ showAll true // true -&gt; å¯¹ä¸€ä¸ªé”™è¯¯çš„é—®é¢˜æ˜¾ç¤ºå®ƒæ‰€åœ¨çš„æ‰€æœ‰åœ°æ–¹ï¼Œè€Œä¸ä¼šæˆªçŸ­åˆ—è¡¨ç­‰ç­‰ã€‚ lintConfig file('default-lint.xml') // é‡ç½® lint é…ç½®(ä½¿ç”¨é»˜è®¤çš„ä¸¥é‡æ€§ç­‰è®¾ç½®) textReport true // true -&gt; ç”Ÿæˆä¸€ä¸ªé—®é¢˜çš„çº¯æ–‡æœ¬æŠ¥å‘Š(default -&gt; false) textOuput 'stdout' // é»˜è®¤å†™å…¥è¾“å‡ºç»“æžœçš„ä½ç½®ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ– stdout xmlReport false // true -&gt; ç”Ÿæˆ xml æŠ¥å‘Šï¼Œjenkins å¯ä»¥ä½¿ç”¨ xmlOutput file("lint-report.xml") // å†™å…¥æŠ¥å‘Šçš„æ–‡ä»¶ï¼Œé»˜è®¤ line-results.xml htmlReport true // html æŠ¥å‘Š htmlOutput file('lint-report.html') // å†™å…¥æŠ¥å‘Šçš„è·¯å¾„ï¼Œå¯é€‰(é»˜è®¤ä¸ºæž„å»ºç›®å½•ä¸‹çš„ lint-results.html) checkReleaseBuilds true // true -&gt; å°†ä½¿æ‰€æœ‰ release æž„å»ºéƒ½ä»¥ issus çš„ä¸¥é‡æ€§çº§åˆ«ä¸º fatal (serverity=false)çš„è®¾ç½®æ¥è¿è¡Œ lint,ä¸”å¦‚æžœå‘çŽ°äº†è‡´å‘½(fatal)çš„é—®é¢˜,å°†ä¼šä¸­æ­¢æž„å»º(ç”±ä¸Šé¢æåˆ°çš„ abortOnError æŽ§åˆ¶) fatal 'NewApi','InlineApi' // è®¾ç½®ç»™å®šé—®é¢˜çš„ä¸¥é‡çº§åˆ«(serverity)ä¸º fatalï¼ˆå³å°†ä¼šåœ¨ release æž„å»ºæœŸé—´æ£€æŸ¥,å³ä½¿ lint è¦æ£€æŸ¥çš„é—®é¢˜æ²¡æœ‰åŒ…å«åœ¨ä»£ç ä¸­ï¼‰ error 'Wakelock','TextViewEdits' // è®¾ç½®ç»™å®šé—®é¢˜çš„ä¸¥é‡çº§åˆ«ä¸º error warning 'ResourceAsColor' // è®¾ç½®ç»™å®šé—®é¢˜çš„ä¸¥é‡çº§åˆ«ä¸º warning ignore 'TypographyQUotes' // è®¾ç½®ç»™å®šé—®é¢˜çš„ä¸¥é‡çº§åˆ«(serverity)ä¸º ignore (å’Œä¸æ£€æŸ¥è¯¥é—®é¢˜ä¸€æ ·)&#125; dexOptions: çƒ­ä¿®å¤å·®åˆ†åŒ… 123456789dexOptions &#123; additionalParameters '--minimal-main-dex','--set-max-idx-number=10000' // dx å‘½ä»¤é™„åŠ å‚æ•° javaMaxHeapSize '2048m' // æ‰§è¡Œ dx æ—¶ Java è™šæ‹Ÿæœºå¯ç”¨çš„æœ€å¤§å†…å­˜å¤§å° jumboMode true // å¼€å¯å¤§æ¨¡å¼ï¼Œæ‰€æœ‰çš„ class æ‰“åˆ°ä¸€ä¸ª dex ä¸­,å¯ä»¥å¿½ç•¥ 65535 æ–¹æ³•æ•°çš„é™åˆ¶, å¤§äºŽ14ç‰ˆæœ¬å¯ç”¨ keepRuntimeAnnotatedClasses true // åœ¨ dex ä¸­æ˜¯å¦ä¿ç•™ Runtime æ³¨è§£,é»˜è®¤ true maxProcessCount 4 // dex ä¸­çš„è¿›ç¨‹æ•°,é»˜è®¤ 4 threadCount 4 // é»˜è®¤çº¿ç¨‹æ•° preDexLibraries true // å¯¹ library é¢„ç¼–è¯‘ï¼Œæé«˜ç¼–è¯‘æ•ˆçŽ‡ï¼Œä½† clean æ—¶è¾ƒæ…¢ï¼Œé»˜è®¤ true&#125; packagingOptions 12345packagingOptions &#123; pickFirsts = ['META-INF/LICENSE'] // å½“æœ‰é‡å¤æ–‡ä»¶æ—¶ï¼Œæ‰“åŒ…ä¼šæŠ¥é”™ã€‚æ­¤é…ç½®ä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ–‡ä»¶æ‰“åŒ…è¿›å…¥ apk merge 'META-INF/LICENSE' // é‡å¤æ–‡ä»¶ä¼šåˆå¹¶æ‰“åŒ… exclue 'META-INF/LICENSE' // æ‰“åŒ…æ—¶æŽ’é™¤åŒ¹é…æ–‡ä»¶&#125; sourceSets 1234567891011121314151617sourceSets &#123; main &#123; res.srcDirs 'src/main/res' jniLibs.srcDirs = ['libs'] aidl.srcDirs 'src/main/aidl' assets.srcDirs 'src/main/assets' java.srcDirs 'src/main/java' jni.srcDirs 'src/main/jni' renderscript.srcDirs 'src/main/renderscript' resources.srcDirs 'src/main/resources' manifest.srcFile 'src/main/AndroidManifest.xml' &#125; // é™¤äº† main,ä¹Ÿå¯ç»™ä¸åŒçš„æ¸ é“æŒ‡å®šä¸åŒçš„é…ç½® free &#123; &#125;&#125; splits: google play æŒ‰ CPU/å±å¹•åƒç´ å¯†åº¦æ‰“åŒ… 123456789101112131415161718192021splits &#123; abi &#123; enable true // å¼€å¯ abi åˆ†åŒ… universalApk true // æ˜¯å¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰æœ‰æ•ˆåŠ¨æ€åº“çš„ apk reset() // æ¸…ç©º defaultConfig é…ç½® include 'x86','armeabi' // å’Œ defaultConfig åšå’Œé›† eclude 'mips' &#125; density &#123; enable true // å¼€å¯ density åˆ†åŒ… reset() // æ¸…ç©ºé»˜è®¤ include 'xhdpi','xxhdpi' // å’Œé›† exclude 'mdpi' &#125; language &#123; enable true include 'en','cn' &#125;&#125; variantFilter: è¿‡æ»¤é€šè¿‡ flavor å’Œ buildType æž„å»ºçš„ apk 123456789variantFilter &#123; variant -&gt; def buildTypeName = variant.buildType.name def flavorName = variant.flavors.name if (flavorName.contains("360") &amp;&amp; buildTypeName.contains("debug")) &#123; // ä¸ç”ŸæˆåŒ¹é…çš„ apk setIgnore(true) &#125;&#125; com.android.library 1234android.libraryVariants.all &#123; variant -&gt; def mergedFlavor = variant.getMergedFlavor() mergedFlavor.manifestPlaceholers = [hostName:'www.example.com']&#125;]]></content>
      <tags>
        <tag>kotlin</tag>
        <tag>gradle</tag>
        <tag>æž„å»º</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[git ç¬”è®°]]></title>
    <url>%2F2019%2F03%2F17%2Fgit-%E7%AC%94%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[config 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192# ä¿®æ”¹é…ç½®git config --local # å¯¹æŸä¸ªä»“åº“æœ‰æ•ˆgit config --global # å¯¹å½“å‰ç”¨æˆ·æ‰€æœ‰ä»“åº“æœ‰æ•ˆgit config --system # å¯¹ç³»ç»Ÿæ‰€æœ‰ç™»å½•ç”¨æˆ·æœ‰æ•ˆ# æŸ¥çœ‹é…ç½®git config --list --localgit config --list --globalgit config --list --system# æ‰“å¼€ç¼–è¾‘å™¨ä¿®æ”¹configgit config -e # ä»…å¯¹å½“å‰ä»“åº“æœ‰æ•ˆ# å˜æ›´æ–‡ä»¶ågit mv readme readme.md # é¿å… mv x y -&gt; git add -&gt; git rmgit log [åˆ†æ”¯] --oneline # ä¸€è¡Œæ˜¾ç¤º -n4 # æŒ‡å®šæœ€æ–°çš„å‡ æ¬¡æäº¤ --all # æ‰€æœ‰åˆ†æ”¯çš„æäº¤ --graph # å›¾å½¢åŒ–æ˜¾ç¤º# æ‰“å¼€å†…ç½®å¸®åŠ©ç½‘é¡µ.git help --web [log]# guigitk --allgit branch -av# åœ¨ ./git/refs/heads/xxx ä¸­æŸ¥çœ‹ä¿¡æ¯git cat-file -t master # è¿”å›ž git object model ç±»åž‹: blog, tree, commit, tag -p # æ˜¾ç¤ºæ‰€æœ‰å†…å®¹# åˆ é™¤åˆ†æ”¯git branch -D [fixup]# å˜åŸºgit rebase -i# æš‚å­˜åŒºå’Œæœ€è¿‘ä¸€æ¬¡æäº¤çš„åŒºåˆ«git diff --cached# å°†æš‚å­˜åŒºçš„å†…å®¹ä¸¢å¼ƒgit reset HEAD -- &lt;file&gt;# å°†æš‚å­˜åŒºçš„å†…å®¹æ¢å¤åˆ°æœ¬åœ°git checkout -- &lt;file&gt;# è®¾ç½®åˆ«ågit config --global alias.co checkoutgit config --global alias.br branchgit config --global alias.ci commitgit config --global alias.st statusgit config --global alias.last 'log -1 HEAD'git config --global alias.unstage 'reset HEAD --'; git unstage fileA === git reset HEAD -- fileAgit config --global alias.visual '!gitk'# æŸ¥çœ‹å„ä¸ªåˆ†æ”¯æ‰€æŒ‡çš„å¯¹è±¡ --decorategit log --oneline --decorategit log --oneline --decorate --graph --all# è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯git checkout --track origin/serverfixgit checkout -b sf origin/serverfix; sf åˆ†æ”¯è¿½è¸ª origin/serverfix åˆ†æ”¯.# æ·»åŠ ä¿®æ”¹æ­£åœ¨è¿½è¸ªçš„ä¸Šæ¸¸åˆ†æ”¯; -u / --set-upstream-togit branch -u origin/serverfix# å½“è®¾ç½®å¥½è·Ÿè¸ªåˆ†æ”¯åŽï¼Œå¯é€šè¿‡ @&#123;upstream&#125; æˆ– @&#123;u&#125; å¿«æ·æ–¹å¼æ¥å¼•ç”¨.æ‰€æœ‰å¦‚æžœ master è·Ÿè¸ª origin/masterã€‚é‚£ä¹ˆ git merge @&#123;u&#125; å¯ä»¥å–ä»£ git merage origin/master.# æŸ¥çœ‹æ‰€æœ‰è·Ÿè¸ªåˆ†æ”¯git branch -vv# åˆ é™¤æœåŠ¡ç«¯çš„åˆ†æ”¯git push origin --delete serverfix#git init --bare --shared ; # shared ä¼šè‡ªåŠ¨ä¿®æ”¹è¯¥ä»“åº“ç›®å½•çš„ç»„æƒé™ä¸ºå¯å†™.# ä¸ºæœåŠ¡ç«¯é…ç½® SSH è®¿é—®sudo adduser gitsu gitcdmkdir .ssh &amp;&amp; chmod 700 .sshtouch .ssh/authorized_keys &amp;&amp; chmod 600 .ssh/authorized_keyscat /tmp/id_rsa.john.pub &gt;&gt; ~/.ssh/authorized_keyscat /tmp/id_rsa.josie.pub &gt;&gt; ~/.ssh/authorized_keys# é™åˆ¶ git ç”¨æˆ·åªèƒ½è®¿é—®é¡¹ç›®ï¼Œæ— æ³•ç™»å½•è¿œç¨‹ä¸»æœº.cat /etc/shellswhich git-shellsudo vim /etc/shellsï¼› # å°† git-shell æ·»åŠ sudo chsh git /usr/bin/git-shell; # é™åˆ¶ git ç”¨æˆ·åªèƒ½åˆ©ç”¨ SSH è¿žæŽ¥å¯¹ Git ä»“åº“è¿›è¡ŒæŽ¨é€å’Œæ‹‰åŽ»æ“ä½œï¼Œè€Œä¸èƒ½ç™»å½•æœºå™¨å¹¶å–å¾—æ™®é€š shell.# ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è®¾ç½® git åè®®,ä¸éœ€è¦é…ç½® SSH å…¬é’¥.git daemon --reuseaddr --base-path=/opt/git/ /opt/git/;# --reuseaddr å…è®¸æœåŠ¡å™¨åœ¨æ— éœ€ç­‰å¾…æ—§è¿žæŽ¥è¶…æ—¶çš„æƒ…å†µä¸‹é‡å¯# --base-path å…è®¸ç”¨æˆ·åœ¨æœªå®Œå…¨æŒ‡å®šè·¯å¾„çš„æ¡ä»¶ä¸‹å…‹éš†é¡¹ç›®,ç»“å°¾çš„è·¯å¾„å°†å‘Šè¯‰ git å®ˆæŠ¤è¿›ç¨‹ä»Žä½•å¤„å¯»æ‰¾ä»“åº“æ¥å¯¼å‡º.å¦‚æžœæœ‰é˜²ç«å¢™è¿è¡Œï¼Œè¯·å¼€æ”¾ 9418 ç«¯å£.# ç©ºç™½é”™è¯¯(æ¢è¡Œ\tab\ã€‚ã€‚ã€‚)git diff --check# éƒ¨åˆ†æš‚å­˜git add --patch#git merge --squash featureB# --squash æŽ¥å—è¢«åˆå¹¶åˆ†æ”¯ä¸Šçš„æ‰€æœ‰å·¥ä½œï¼Œå¹¶å°†å…¶åŽ‹ç¼©è‡³ä¸€ä¸ªå˜æ›´åŠï¼Œä½¿ä»“åº“æˆä¸ºçœŸæ­£åˆå¹¶å‘ç”Ÿçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç”Ÿæˆä¸€ä¸ªåˆå¹¶æäº¤.# æ‰“åŒ… archivegit archive master --prefix='project/' | gzip &gt; `git describe master`.tar.gzgit archive master --prefix='project/' --format=zip &gt; `git describe master`.zips#git diff --ours # --theirs # --base -b]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JGit]]></title>
    <url>%2F2019%2F03%2F16%2FJGit%2F</url>
    <content type="text"><![CDATA[å‰è¨€JGit æ˜¯ä¸€ä¸ªåŸºäºŽ EDL(BSD åè®®çš„å˜ç§)æŽˆæƒçš„è½»é‡çº§ã€å®žçŽ° Git ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»ŸåŠŸèƒ½(å¸¸è§„ä»“åº“è®¿é—®,ç½‘ç»œåè®®,ç‰ˆæœ¬æŽ§åˆ¶æ ¸å¿ƒç®—æ³•)çš„çº¯ Java åº“. å…¥é—¨èŽ·å–åœ¨ä»“åº“æœç´¢å¼•æ“Žä¸­æœç´¢ jgit å³å¯èŽ·å–å„ç§æ·»åŠ ä¾èµ–çš„æ–¹å¼.æˆ‘çŽ°åœ¨åŸºæœ¬ä½¿ç”¨çš„æ˜¯ gradle ä¾èµ– 12implementation("org.eclipse.jgit:org.eclipse.jgit:5.3.0.201903130848-r")implementation("org.eclipse.jgit:org.eclipse.jgit.http.server:5.3.0.201903130848-r") JGit ä¹Ÿå…·æœ‰ CLI(åŠŸèƒ½æ¯” git CLI å°‘),å¯ä»¥è¯•ä¸€ä¸‹ JGit çš„åŠŸèƒ½. æ‰‹åŠ¨ç¼–è¯‘ JGit CLIå‡è®¾å·²ç» clone EGit ä»“åº“. git clone https://git.eclipse.org/r/jgit/jgit.git å…·ä½“æŸ¥çœ‹ 12345678~/src/jgit$ mvn clean install# è¿›å…¥ jgit å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹org.eclipse.jgit.pgm/target/jgit# æŸ¥çœ‹ version å‘½ä»¤prompt$ ./jgit versionjgit version xxxxx# å¦‚æžœç»å¸¸ä½¿ç”¨ jgit å‘½ä»¤,å¯ä»¥æ·»åŠ æ‰§è¡Œé“¾æŽ¥(é€šå¸¸åœ¨ /usr/local/bin)sudo ln -s /path/to/jgit /usr/local/bin/jgit åœ¨ JGit CLI è¿è¡Œå‘½ä»¤1234567891011121314151617181920prompt$ ./git# ä¼šåˆ—å‡ºæœ€å¸¸ç”¨çš„å‘½ä»¤jgit --git-dir GIT_DIR --help (-h) --show-stack-trace command [ARG ...]The most commonly used commands are: branch List, create, or delete branches clone Clone a repository into a new directory commit Record changes to the repository daemon Export repositories over git:// diff Show diffs fetch Update remote refs from another repository init Create an empty git repository log View commit history push Update remote repository from local refs rm Stop tracking a file tag Create a tag version Display the version of jgit # å¸¸ç”¨çš„ debug test å‘½ä»¤ prompt$ ./jgit debug-show-commands æŸ¥çœ‹ä»“åº“åœ¨æŸ¥çœ‹æœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹å‰ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“è¯¥ä»“åº“åŒ…å«äº†å¤šå°‘åˆ†æ”¯ï¼Œå½“å‰åˆ†æ”¯æ˜¯é‚£ä¸ª.ä½¿ç”¨ branch -v å¯ä»¥èŽ·å–æ‰€æœ‰åˆ†æ”¯çš„ç®€ç•¥ä¿¡æ¯ï¼Œç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·æäº¤ä¿¡æ¯çš„ç¬¬ä¸€è¡Œ. 12345678910111213prompt$ ./jgit branch -v# master 4d4adfb Git Project import: don't hide but gray out existing projects# * traceHistory 6b9fe04 [historyView] Add trace instrumentation# å’Œ git-log ä¸€æ · log å‘½ä»¤æ˜¾ç¤ºæäº¤ä¿¡æ¯jgit log --author Math --grep tycho master# æ˜¾ç¤º master åˆ†é’Ÿä¸­ï¼Œä½œè€…ååŒ…å« Math,æäº¤ä¿¡æ¯åŒ…å« tycho çš„æœæœ‰æäº¤ä¿¡æ¯.# commit xxxx# Author: Math xxxx# Date: xxx# Update build to use tycho x.xx.x# ...# å¤§å¤šæ•°çš„æœç´¢éƒ½ä¼šç²¾ç¡®è¿‡æ»¤æäº¤æ—¥å¿—ï¼Œå¦‚æäº¤è€…å§“åç­‰ åŽ†å²å›¾å½¢åŒ–jgit glog æ ¸å¿ƒæ¦‚å¿µAPIä»“åº“Repository ç®¡ç†æ‰€æœ‰çš„é¡¹ç›®å’Œå¼•ç”¨ï¼Œç®¡ç†ä»£ç  12345val repository = FileRepositoryBuilder() .setGitDir(File("/my/git/directory")) .readEnvironment() // æ‰«æ GIT_* çŽ¯å¢ƒå˜é‡ .findGitDir() // æ‰«ææ–‡ä»¶ç³»ç»Ÿ .build() Git å¯¹è±¡åœ¨ Git object model æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ç”± SHA-1 id è¡¨ç¤º.åœ¨ JGit ä¸­æ˜¯ç”± AnyObjectId å’Œ ObjectIdç±»è¡¨ç¤º.åœ¨ Git object model ä¸­å®šä¹‰äº†å››ç§å¯¹è±¡ç±»åž‹: blob: ç”¨äºŽå­˜å‚¨æ–‡ä»¶å¯¹è±¡ tree: å¯ä»¥çœ‹ä½œä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒæŒ‡å‘å…¶ä»–çš„ tree æˆ– blob commit: æŒ‡å‘ä¸€ä¸ª tree çš„æäº¤ä¿¡æ¯ tag: çªå‡ºæäº¤ä¿¡æ¯,é€šå¸¸ç”¨æ¥æ ‡è®°ç‰¹æ®Šçš„ release ç‰ˆæœ¬. ä¸ºäº†ä»Žä¸€ä¸ªä»“åº“ä¸­è¯†åˆ«ä¸€ä¸ªå¯¹è±¡ï¼Œåªè¦ä¼ å…¥ä¸€ä¸ªæ­£ç¡®çš„ revision å­—ç¬¦ä¸²å³å¯ 1val head = repository.resolve("HEAD") Refref æ˜¯ä¸€ä¸ªåŒ…å«å•ä¸ªå¯¹è±¡æ ‡è¯†ç¬¦çš„å˜é‡.å¯¹è±¡æ ‡è¯†ç¬¦å¯ä»¥æ˜¯ä»»ä½• Git åˆæ³•å¯¹è±¡(blob,tree,commit,tag)ä¾‹å¦‚,èŽ·å– head çš„å¼•ç”¨. 1val HEAD = repository.findRef("refs/heads/master") RevWalkRevWalk éåŽ† commit graphï¼Œå¹¶æŒ‰é¡ºåºç”ŸæˆåŒ¹é…çš„ commit 1val revWalk = RevWalk(repository) RevCommitRevCommit è¡¨ç¤º Git object model ä¸­çš„ä¸€ä¸ª commit 1val commit = walk.parseCommit(objectIdOfCommit); RevTagRevCommit è¡¨ç¤º Git object model ä¸­çš„ä¸€ä¸ª Tag 1val tag = walk.parseCommit(objectIdOfTag); RevTreeRevCommit è¡¨ç¤º Git object model ä¸­çš„ä¸€ä¸ª tree 1val tree = walk.parseCommit(objectIdOfTree); å‚è€ƒè™½ç„¶ JGit åŒ…å«äº†è®¸å¤šå’Œ Git ä»“åº“äº¤äº’çš„ä½Žçº§ä»£ç ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€äº›å‚è€ƒorg.eclipse.jgit.apitåŒ…ä¸­ Git porcelain å‘½ä»¤çš„é«˜çº§ API. æ·»åŠ å‘½ä»¤(git-add)add å‘½ä»¤å¯ä»¥å‘ç´¢å¼•ä¸­æ·»åŠ æ–‡ä»¶ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡ setter æ–¹æ³•é…ç½® addFilepattern() 1234val git = Git(repository)git.add() .addFilepattern("/dir") .call() æäº¤å‘½ä»¤(git-commit) setAuthor() setCommitter() setAll() 1234git.commit() .setAuthor("author","email") .setMessage("message") .call() tag å‘½ä»¤(git-tag) setName() setMessage() setTagger() setObjectId() setForceUpdate() setSigned(): æš‚ä¸æ”¯æŒï¼Œä¼šæŠ›å¼‚å¸¸ 123git.tag() .setName("tag") .call() log å‘½ä»¤(git-log) add(AnyObjectId start) addRange(AnyObjectId since,AnyObjectId until) 123git.log() .add(head) .call() merge å‘½ä»¤(git-merge)TODO Ant ä»»åŠ¡JGit åœ¨ org.eclipse.jgit.ant åŒ…ä¸­æä¾›äº† Ant ä»»åŠ¡åŠŸèƒ½.æ·»åŠ ä¾èµ– 1234567&lt;taskdef resource="org/eclipse/jgti/ant/ant-tasks.properties"&gt; &lt;classpath&gt; &lt;pathelement location="path/to/org.eclipse.jgit.ant-VERSION.jar"/&gt; &lt;pathelement location="path/to/org.eclipse.jgit-VERSION.jar"/&gt; &lt;pathelement location="path/to/jsch-0.1.44-1.jar"/&gt; &lt;/classpath&gt;&lt;/taskdef&gt; æä¾›äº† git-cloneã€git-initã€git-checkoutä»»åŠ¡. git-clone1&lt;git-clone uri="http://egit.eclipse.org/jgit.git"/&gt; uri(å¿…é¡») dest(å¯é€‰): å…‹éš†çš„ç›®æ ‡æ–‡ä»¶åœ°å€.é»˜è®¤ä½¿ç”¨åŸºäºŽ uri è·¯å¾„æœ€åŽä¸€ä¸ªç»„ä»¶ä½œä¸ºå¯è¯†åˆ«çš„åç§°çš„æ–‡ä»¶å¤¹. bare(å¯é€‰): true/false/yes/no è¡¨ç¤ºæ˜¯å¦å…‹éš† bare ä»“åº“. é»˜è®¤ false branch(å¯é€‰): é»˜è®¤ HEAD git-init1&lt;git-init/&gt; dest(å¯é€‰): é»˜è®¤ \$GIT_DIR æˆ–å½“å‰æ–‡ä»¶å¤¹ bare(å¯é€‰) git-checkout1&lt;git-checkout src="path/to/repo" branch="origin/experimental"/&gt; src(å¿…é¡») branch(å¿…é¡») createbranch(å¯é€‰): true/false/yes/no æ˜¯å¦ä¼šåˆ›å»ºæ–° branchã€‚é»˜è®¤ false. force(å¯é€‰): true/false/yes/no å¦‚æžœ true/yes,å‘½åçš„ branch å·²å­˜åœ¨ï¼Œå·²å­˜åœ¨ branch çš„èµ·ç‚¹å°†ä¼šè¢«è®¾ç½®åˆ°æ–°çš„èµ·ç‚¹ã€‚å¦‚æžœ false,å­˜åœ¨çš„ branch ä¸ä¼šè¢«æ”¹å˜.é»˜è®¤ false. git-addTODO ä»£ç ç‰‡æ®µèŽ·å–æŸä¸€æäº¤è®°å½•çš„å­è®°å½•12345678PlotWalk revWalk = new PlotWalk(repo());ObjectId rootId = (branch == null) ? repo().resolve(HEAD) : branch.getObjectId();RevComment root = revWalk.parseCommit(rootId);revWalk.markStart(root);PlotCommitList&lt;PlotLane&gt; plotCommitList = new PlotCommitList&lt;PlotLane&gt;();plotCOmmitList.source(revWalk);plotCommitList.fillTo(Integer.MAX_VALUE);return revWalk; é«˜çº§ä¸»é¢˜ä½¿ç”¨ RevWalk å‡å°‘å†…å­˜ä½¿ç”¨revision walk æŽ¥å£å’Œ RevWalkï¼ŒRevCommit ç±»è½»é‡çº§è®¾è®¡ã€‚ç„¶è€Œå½“é¢å¯¹ç›¸å½“å¤§çš„ä»“åº“æ—¶å®ƒä»¬å¯èƒ½ä»ç„¶éœ€è¦å¾ˆå¤šå†…å­˜ã€‚æŽ¥ä¸‹æ¥æä¾›äº†ä¸€äº›æ–¹æ³•åœ¨éåŽ†ä¿®è®¢å›¾(walking the revision graph)æ—¶å‡å°‘å†…å­˜ã€‚ é™åˆ¶éåŽ†ä¿®è®¢å›¾(Restrict the walked revision graph)ä»…éåŽ†é‚£äº›å¿…è¦çš„å›¾.å³å¦‚æžœæŸ¥æ‰¾ refs/heads/master è€Œä¸æ˜¯ refs/remotes/origin/master çš„æäº¤è®°å½•,ç¡®ä¿å¯¹ refs/heads/master è°ƒç”¨ markStart(),å¯¹ refs/remotes/origin/master è°ƒç”¨ markUninteresting(). RevWalk traversal è®²åªè§£æžå¯¹ä½ æœ‰ç”¨çš„æäº¤è®°å½•,è€Œä¸”ä¼šé¿å…åœ¨åŽ†å²è®°å½•ä¸­æŸ¥è¯¢.è¿™è®²å‡å°‘å†…éƒ¨ object map çš„å¤§å°,å› æ­¤å‡å°‘æ•´ä½“å†…å­˜å ç”¨. 123456RevWalk walk = new RevWalk(repository);ObjectId from = repository.resolve("refs/heads/master");ObjectId to = repository.resolve("refs/remotes/origin/master");walk.markStart(walk.parseCommit(from));walk.markUnInteresting(walk.parseCommit(to)); ä¸¢å¼ƒæäº¤è®°å½•å†…å®¹setRetainBody(false) å¯ä»¥ç”¨æ¥ä¸¢å¼ƒæäº¤è®°å½•å†…å®¹ï¼Œå¦‚æžœä½ ä¸éœ€è¦ä½œè€…ï¼Œæäº¤è€…ï¼Œæˆ–ä¿¡æ¯ç­‰.ä¸éœ€è¦è¯¥æ•°æ®çš„ä¾‹å­å¦‚åªä½¿ç”¨ RevWalk å®Œæˆ branch merge æˆ–ä½¿ç”¨ git rev-list å®Œæˆç›¸å…³åŠŸèƒ½. 12RevWalk walk = new RevWalk(repository);walk.setRetainBody(false); å¦‚æžœç¡®å®žéœ€è¦è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥è€ƒè™‘æ‹†åˆ†ä½ éœ€è¦çš„æ•°æ®ç„¶åŽå¯¹ RevCommit è°ƒç”¨ dispose().å¦‚æžœéœ€è¦é•¿æ—¶é—´ä½¿ç”¨è¿™äº›ä¿¡æ¯,ä½ ä¼šå‘çŽ° JGit å†…éƒ¨ä½¿ç”¨çš„å†…å­˜æ¯”ä½ è‡ªå·±å¤„ç†å ç”¨çš„å†…å­˜è¦å°‘ï¼Œç‰¹åˆ«æ˜¯éœ€è¦å…¨éƒ¨çš„ä¿¡æ¯æ—¶ã€‚è¿™æ˜¯å› ä¸º JGit å†…éƒ¨ä½¿ç”¨ byte æ•°ç»„ä¿å­˜ UTF-8 ç¼–ç çš„ä¿¡æ¯.å¦‚æžœä½¿ç”¨ UTF-16 ç¼–ç çš„ Java String å å†…å­˜å°†ä¼šå˜å¤§ï¼Œå‡è®¾å¤§éƒ¨åˆ†çš„æ¶ˆæ¯æ˜¯ US-ASCII ç¼–ç çš„. 123456RevWalk walk = new RevWalk(repository);Set&lt;String&gt; authorEmails = new HashSet&lt;String&gt;();for (RevCommit commit : walk) &#123; authorEmails.add(commit.getAuthorIdent().getEmailAddress()); commit.dispose();&#125; RevWalk å’Œ RevCommit çš„å­ç±»å¦‚æžœéœ€è¦èŽ·å–æŸä¸ªæäº¤è®°å½•çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ RevWalk RevCommit çš„å­ç±», RevWalk.createCommit() æž„å»º RevCommit å­ç±»çš„å®žä¾‹ã€‚ç„¶åŽå°†æ›´å¤šçš„ä¿¡æ¯å­˜å…¥ RevCommit å­ç±»,è¿™æ ·å°±ä¸éœ€è¦é¢å¤–çš„ HashMap å°† RevCommit æˆ– ObjectId è½¬æ¢ä¸º è‡ªå®šä¹‰çš„æ•°æ®å±žæ€§. 12345678910111213141516171819202122232425262728293031public class ReviewedRevision extends RevCommit &#123; private final Date reviewDate; private ReviewedRevision(AnyObjectId id,Date reviewDate) &#123; super(id); this.reviewDate = reviewDate; &#125; public List&lt;String&gt; getReviewedBy() &#123; return getFooterLines("Reviewed-by"); &#125; public Date getReviewDate() &#123; return reviewDate; &#125; public static class Walk extends RevWalk &#123; public Walk(Repository repo) &#123; super(repo); &#125; @Override protected RevCommit createCommit(AnyObjectId id) &#123; return new ReviewedRevision(id,getReviewDate(id)); &#125; private Date getReviewDate(AnyObjectId id) &#123; &#125; &#125;&#125; éåŽ†ä¿®è®¢åŽæ¸…ç†RevWalk æ— æ³•ç¼©å°å†…éƒ¨çš„ object map.å¦‚æžœåˆšå®Œæˆäº†éåŽ†ä»“åº“çš„æ‰€æœ‰åŽ†å²ï¼Œè¿™å°†ä¼šå°†æ‰€æœ‰ä¸œè¥¿åŠ è½½åˆ° object mapï¼Œå¹¶ä¸”æ— æ³•è¢«é‡Šæ”¾.å¦‚æžœå†ä¸éœ€è¦è¿™äº›æ•°æ®ï¼Œå¥½çš„ä¹ æƒ¯æ˜¯ä¸¢å¼ƒè¿™ä¸ª RevWalkï¼Œç„¶åŽä¸ºä¸‹æ¬¡éåŽ†é‡æ–°ç”³è¯·æ–°çš„ RevWalkã€‚è¿™æ · GC å°±ä¼šå›žæ”¶åžƒåœ¾ã€‚å¦å¤–ï¼Œé‡ç”¨ä¸€ä¸ªå­˜åœ¨ çš„ object map æ¯”å®Œå…¨é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æ›´å¿«.æ‰€ä»¥ä½ éœ€è¦å¹³è¡¡å†…å­˜å›žæ”¶å’Œç”¨æˆ·æ¸´æœ›æ›´å¿«çš„æ“ä½œä¹‹é—´çš„å…³ç³». 123RevWalk walk = new RevWalk(repository);for (RevCommit commit : walk) &#123;&#125;walk.repository(); åŠŸèƒ½åˆ—è¡¨ é€šç”¨ä»“åº“æ“ä½œ æ‰“å¼€å­˜åœ¨çš„ git ä»“åº“ åˆ›å»ºæ–°çš„ git ä»“åº“ git å‘½ä»¤æ”¯æŒ åˆå§‹åŒ–æ–°çš„ä»“åº“ æ·»åŠ æ–°æ–‡ä»¶åˆ°ç´¢å¼•ä¸­ å‘å­˜åœ¨çš„ä»“åº“æäº¤æ–‡ä»¶ æäº¤æ‰€æœ‰æ›´æ”¹ åˆ—å‡ºæäº¤è®°å½•,å¦‚ Log åˆ—å‡ºä»“åº“çš„æ‰€æœ‰æ ‡ç­¾ åˆ—å‡ºä»“åº“çš„æ‰€æœ‰åˆ†æ”¯ åˆ—å‡ºä»“åº“çš„æ‰€æœ‰æäº¤è®°å½• åˆ—å‡ºä»“åº“æ‰€æœ‰æœªæäº¤çš„æ›´æ”¹ åˆ›å»º/åˆ é™¤åˆ†æ”¯ åˆ›å»º/åˆ é™¤æ ‡ç­¾ å›žé€€è¢«ä¿®æ”¹çš„è¿½è¸ªæ–‡ä»¶åˆ°æœ€è¿‘æäº¤è®°å½•ä¸­çš„åˆå§‹çŠ¶æ€ è¿”å›žä¸¤ä¸ªåˆ†æ”¯çš„ diff æ˜¾ç¤ºä¸¤ä¸ª revs ä¸­åŒä¸€ä¸ªæ–‡ä»¶çš„æ”¹å˜ diff æ˜¾ç¤ºä¸¤ä¸ªæäº¤è®°å½•ä¸­æ‰€æœ‰æ–‡ä»¶çš„æ”¹å˜ diff æ˜¾ç¤ºä¸¤ä¸ªæäº¤è®°å½•ä¸­åŒä¸€ä¸ªæ–‡ä»¶çš„æ”¹å˜ diff,å½“æ–‡ä»¶è¢«é‡å‘½ååŽ æ˜¾ç¤ºçŠ¶æ€ æŠŠåˆ†æ”¯ä¸­çš„å†…å®¹å­˜å‚¨åˆ°ä¸€ä¸ªåŽ‹ç¼©æ–‡ä»¶ä¸­ ä½¿ç”¨è‡ªå®šä¹‰çš„æ‰“åŒ…æ ¼å¼å°†åˆ†æ”¯ä¸­çš„å†…å®¹å†™å…¥åˆ°ä¸€ä¸ªåŽ‹ç¼©æ–‡ä»¶ä¸­ Blame,ä¾‹å¦‚æŸ¥æ‰¾é‚£ä¸ªæäº¤è®°å½•æ”¹å˜äº†æŸä¸ªæ–‡ä»¶çš„ç‰¹å®šè¡Œ æ·»åŠ /åˆ—å‡ºæäº¤è®°å½•é™„å¸¦çš„ç¬”è®° åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ç¬”è®° æ¸…ç†æ‰€æœ‰æœªè¿½è¸ªçš„æ–‡ä»¶ åˆ›å»º/åˆ—å‡º/æäº¤/ä¸¢å¼ƒ stashes è¿è¡Œåžƒåœ¾å›žæ”¶ Blame,å¦‚æŸ¥æ‰¾è°æœ€åŽä¿®æ”¹äº†æŸæ–‡ä»¶çš„ç‰¹å®šè¡Œ åˆå¹¶æŸä¸€åˆ†æ”¯çš„ä¿®æ”¹ åˆ—å‡ºä¸¤ä¸ªæäº¤è®°å½•ä¿®æ”¹çš„æ‰€æœ‰æ–‡ä»¶ ä¾›è¿œç¨‹ä»“åº“ä½¿ç”¨çš„å‘½ä»¤ å¤åˆ¶è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°çš„æ–°æ–‡ä»¶å¤¹ä¸­ åœ¨ä¸€ä¸ªä»“åº“ä¸­è¿­ä»£è¿œç¨‹å¼•ç”¨ ä¸å…‹éš†åˆ—å‡ºè¿œç¨‹ä»“åº“çš„æ‰€æœ‰ heads/tags fetch from remote repository fetch from remote repository ä¸”ä½¿ç”¨ prune ç§»é™¤è¿‡æœŸçš„è¿œç¨‹ branches/tags ä½¿ç”¨ SSH åè®®/ç”¨æˆ·åå¯†ç éªŒè¯å…‹éš†è¿œç¨‹ä»“åº“ å¯¹ä¸€ä¸ª upstream åˆ†æ”¯æ‰§è¡Œ Rebase ä½¿ç”¨ InMemoryRepository åœ¨å†…å­˜ä¸­å…‹éš†ä¸€ä¸ªä»“åº“ï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­å®Œæˆæ“ä½œ åº•å±‚ API ä»Žä¸€ä¸ªå‘½å ref (refs/heads/master) ä¸­èŽ·å– SHA-1 ä»Žä¸€ä¸ªåç§°æˆ– SHA-1 èŽ·å–æäº¤è®°å½•å¯¹è±¡ èŽ·å–æäº¤ä¿¡æ¯ ä»Žæäº¤è®°å½•å¯¹è±¡ï¼Œåç§°ï¼ŒSHA-1 èŽ·å– tree å¯¹è±¡ è¯»å– file/blob çš„å†…å®¹ ä»Žåç§°ï¼ŒSHA-1 èŽ·å– tag å¯¹è±¡ è§£æžå¤æ‚çš„å¼•ç”¨(å¦‚ HEAD^^)ä¸º SHA-1 è¿­ä»£ä¸€ä¸ªåˆ†æ”¯çš„æ‰€æœ‰æäº¤è®°å½• è¿­ä»£æŸä¸ªèŒƒå›´å†…çš„æäº¤è®°å½• ä»Žç‰¹å®šçš„æäº¤è®°å½•ä¸­è¯»å–ç‰¹å®šæ–‡ä»¶çš„å†…å®¹ åˆ—å‡ºå½“å‰ä»“åº“çš„è¿œç¨‹é…ç½® ä»Ž Git ä¸­æ‰“å°å‡ºç”¨æˆ·çš„ä¿¡æ¯ è¯»å–æ–‡ä»¶å±žæ€§ï¼Œå¦‚å¯æ‰§è¡ŒçŠ¶æ€ï¼Œæ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹ï¼Œå¤§å°ç­‰ ä½¿ç”¨ BranchTrackingStatus ç±»èŽ·å–å½“å‰åˆ†æ”¯ç›¸å¯¹äºŽè¿œç¨‹åˆ†æ”¯è¶…å‰/è½åŽçš„æäº¤è®°å½• æ£€æŸ¥å…¶ä»–åˆ†æ”¯çš„æŸä¸ªæäº¤æ˜¯å¦è¢«åˆå¹¶åˆ°äº†ç»™å‡ºçš„åˆ†æ”¯ åˆ—å‡ºä½œä¸ºæŸä¸ªç‰¹å®šæäº¤è®°å½•æˆ–æ ‡ç­¾çš„æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ å¾ªçŽ¯è¿­ä»£æŸä¸ªæäº¤çš„æ–‡ä»¶ éžå¾ªçŽ¯è¿­ä»£æŸä¸ªæäº¤çš„æ–‡ä»¶ æŸ¥æ‰¾æ‰€æœ‰å¯ä»¥é€šè¿‡ tags,branches,remotes,HEADsâ€¦ç­‰å¯è®¿é—®çš„æäº¤è®°å½• ç¼ºå¤±çš„ä»£ç ç‰‡æ®µ è¿­ä»£ä»“åº“çš„æ‰€æœ‰æäº¤ å•å…ƒæµ‹è¯• å­æ¨¡å—(http://stackoverflow.com/questions/13426798/jgit-read-gitmodules) diffing ä¿®æ”¹ä¹‹å‰çš„æäº¤ ä»Žç´¢å¼•ä¸­ç§»é™¤ä¸€ä¸ªæ–‡ä»¶ Amazon S3 ä¸Šçš„ git ä»“åº“ cherrypick æ›´å¤šæŽˆæƒ]]></content>
  </entry>
  <entry>
    <title><![CDATA[teamcityè‡ªåŠ¨åŒ–æ›´æ–°hexoåšå®¢]]></title>
    <url>%2F2019%2F03%2F09%2Fteamcity%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9B%B4%E6%96%B0hexo%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨çŸ¥ä¹Žæ‰¾åˆ°äº†ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•: åŽŸæ–‡åœ¨è¿™é‡Œæˆ‘æ•´ç†ä¸€ä¸‹: åˆ›å»ºä»“åº“ xxx.github.io. åˆ›å»ºä¸¤ä¸ªåˆ†æ”¯: master/hexo.(å¯åœ¨ github ç½‘é¡µæˆ–æœ¬åœ°åˆ›å»º) git clone git@github.com:xxx/xxx.github.io.git å¦‚æžœæ²¡æœ‰åœ¨ç½‘é¡µåˆ›å»ºåˆ†æ”¯,å¯ä»¥åœ¨æ­¤å¤„åˆ›å»º.git checkout -b master; git checkout -b hexo æŽ¥ä¸‹æ¥æ‰§è¡Œ npm install hexo; hexo init; npm i; npm i hexo-deployer-git,æ­¤å¤„åœ¨ hexo åˆ†æ”¯æ“ä½œ ä¿®æ”¹ _config.yml çš„ deploy å‚æ•°,æ­¤å¤„åœ¨ master åˆ†æ”¯æ“ä½œ. æˆ‘ä½¿ç”¨äº†hexo-next-theme,ä»Ž git ä¸Šä¸‹è½½åŽ,è¿›å…¥ themes/next æ‰§è¡Œ git submodule init,å°† next ä¸»é¢˜å…³è”,æ­¤å¤„åœ¨ hexo åˆ†æ”¯æ“ä½œ git add .; git commit -m &quot;blahblahblah&quot;; git push origin hexo; æäº¤ç½‘ç«™ç›¸å…³æ–‡ä»¶. hexo g -d ç”Ÿæˆç½‘ç«™å¹¶éƒ¨ç½²åˆ° github. å°† CNAME,å›¾ç‰‡ç­‰æ–‡ä»¶æ”¾å…¥ source ç›®å½•ä¸‹,å¯ä¿è¯æŽ¨é€åˆ° github ä¸ä¼šè¢«åˆ é™¤.âš ï¸ ðŸ‘‡ èƒ¡æ‰¯,è§‚çœ‹è¯·è°¨æ…Ž!!!TeamCity æ˜¯ Jetbrains å…¬å¸å‡ºå“çš„æŒç»­åŒ–é›†æˆå·¥å…·ï¼Œç±»ä¼¼Jenkins,ç•Œé¢æ›´åŠ çŽ°ä»£åŒ–ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§,è€Œä¸”å®ƒçš„ server å’Œ agent æ˜¯åˆ†ç¦»çš„ï¼Œå¯ä»¥æŒ‡å®šæœ¬æœºæˆ–è¿œç¨‹çš„æœºå™¨æ¥è¿è¡Œæž„å»ºç­–ç•¥ï¼Œå…¶ä¸­è¿˜æœ‰è°ƒåº¦é˜Ÿåˆ—ç®—æ³•.hexo æ˜¯é™æ€åšå®¢ç”Ÿæˆå·¥å…·.hexo d -gå‘½ä»¤å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ public æ–‡ä»¶å¤¹åŠ HTMLï¼Œç„¶åŽå°†å…¶æŽ¨é€åˆ° github(åœ¨_config.ymlä¸­å·²ç»é…ç½®è¿‡).ä¸€èˆ¬ç”¨æˆ·å¯èƒ½å¯¹themeè‡ªå®šä¹‰(ä¿®æ”¹themeä¸‹çš„_config.yml),å½“æ¢æœºæˆ–å¤‡ä»½æ—¶ï¼Œå¸Œæœ›å°†åšå®¢æºæ–‡ä»¶(*.md)åŠä¿®æ”¹çš„ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸€å¹¶å¤‡ä»½.è€Œhexoé»˜è®¤åªå¤‡ä»½publicæ–‡ä»¶å¤¹,æ‰€ä»¥æœ¬æ–‡æŽ¢ç´¢ä½¿ç”¨ CITeamCityå°†æŽ¨é€åˆ°Githubçš„æºæ–‡ä»¶ç¼–è¯‘ç”Ÿæˆpublicæ–‡ä»¶,è¿™æ ·æ¯æ¬¡å†™å®Œæ–‡ç« ,åªè¦å°†å…¶æŽ¨é€åˆ°Github,TeamCityä¼šè‡ªåŠ¨ç”Ÿæˆåšå®¢HTML. èŽ·å–åˆ°è¯¥ Key.è€Œå®žé™…ä¸Šåœ¨ build æ‰§è¡Œæ—¶ key ä»¥ ing è¢«åˆ é™¤äº†,ä¸å¯èƒ½èŽ·å–åˆ°.è¿™å¹¶ä¸æ„å‘³ç€ç»å¯¹å®‰å…¨ï¼Œåªæ˜¯å¢žåŠ äº† key è¢«ç›—çš„éš¾åº¦. agent å¿…é¡»å®‰å…¨. teamcity å®‰è£…TeamCityæä¾›äº† Dockerå®‰è£…æ–¹å¼ï¼Œå› æ­¤è¯·æå‰å®‰è£…å¥½Docker.æ–‡ä»¶ç›®å½•å¦‚ä¸‹(è¯·æå‰åˆ›å»º),teamcity æ”¯æŒå¤šç§æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œæ­¤å¤„ä½¿ç”¨ mysql æ¥å­˜å‚¨ã€‚ 123456789101112# - teamcity - agent - conf - data - server - data - datadir - opt - mysql - backup - data dockery-compose.yml æŽ¥ä¸‹æ¥æ˜¯docker-compose.yml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162``yamlversion: "3.3"services: teamcity-server: image: jetbrains/teamcity-server container_name: teamcity-server restart: always ports: - 8111:8111 volumes: - $PWD/server/datadir:/data/teamcity_server/datadir - $PWD/server/opt/logs:/opt/teamcity/logs - $PWD/server/data:/data/teamcity_server/others # å…¶ä»–çš„ä¸€äº›èµ„æºï¼Œå¯ä»¥ä»Žæœ¬æœºå¤åˆ¶åˆ° server ä¸Š environment: # TEAMCITY_SERVER_MEM_OPTS: -Xmx2g -XX:MaxPermSize=270m -XX:ReservedCodeCacheSize=350m MYSQL_USER: team-user MYSQL_PASSWORD: team-pwd MYSQL_ROOT_PASSWORD: teamcity8080 MYSQL_DATABASE: teamcitydb depends_on: - db links: - db networks: - team db: image: mysql container_name: teamcity-db restart: always volumes: - $PWD/mysql:/etc/mysql/conf.d - $PWD/mysql/backup:/var/lib/mysql # åªæœ‰ /var/lib/mysql å¯¹åº”æœ¬åœ°æ–‡ä»¶ä¸ºç©ºï¼Œæ‰ä¼šåˆ›å»ºè¿™ä¸ªæ•°æ®åº“,å³åˆæ¬¡åˆ›å»ºæ—¶ï¼Œè¿™ä¸ªå¯¹åº”çš„æœ¬åœ°æ–‡ä»¶å¤¹è¦ä¸ºç©º - $PWD/mysql/data:/others environment: MYSQL_USER: team-user MYSQL_PASSWORD: team-pwd MYSQL_ROOT_PASSWORD: teamcity8080 MYSQL_DATABASE: teamcitydb ports: - 3306:3306 networks: - team # &lt;&gt;&lt;&gt; agent &lt;&gt;&lt;&gt; teamcity-agent: image: jetbrains/teamcity-agent container_name: teamcity-agent restart: always volumes: - $PWD/agent/conf:/data/teamcity_agent/conf - $PWD/agent/data:/data/teamcity_agent/others environment: AGENT_NAME: MacbookPro SERVER_URL: http://xxx.xxx.x.xxx:8111 # æ­¤å¤„å¯¹åº”çš„æ˜¯ TeamCityServer çš„IP, localhost/127.0.0.1 éƒ½ä¸è¡Œï¼Œè¯·ä½¿ç”¨æ­£ç¡®çš„ IP,ç«¯å£å¯¹åº”ä¸Šé¢æš´éœ²å‡ºæ¥çš„ç«¯å£ links: - teamcity-server # teamcity_agent é»˜è®¤çš„ä»»åŠ¡çŽ¯å¢ƒè·¯å¾„: opt/buildagent/worknetworks: team: driver: bridge ç„¶åŽæ‰§è¡Œ docker-compose up -d å³å¯ã€‚ éœ€è¦å…ˆæ ¹æ®æœ¬æœº OS å®‰è£…docker-compose &gt; docker-compose up -d ç”ŸæˆæœåŠ¡docker-compose down è§£ä½“æœåŠ¡ï¼Œåˆ é™¤å®¹å™¨,ç½‘ç»œdocker-compose start/stop å¯åŠ¨ç»ˆæ­¢æœåŠ¡ æ‰“å¼€ http://localhost:8111 æˆ– http://[ip]:8111 å³å¯è¿›å…¥ TeamCity Server web äº¤äº’çŽ¯å¢ƒ.æŒ‰ç…§æç¤ºåˆå§‹åŒ–.ç™»å½•æ—¶é»˜è®¤æ²¡æœ‰è®¿å®¢åˆ›å»ºæ–°ç”¨æˆ·çš„æƒé™ï¼Œæ‰€ä»¥éœ€è¦å·²è¶…çº§ç”¨æˆ·æƒé™ç™»å½•ï¼Œç‚¹å‡»ä¸‹é¢çš„ä»¥è¶…çº§æƒé™ç™»å½•åŽæç¤ºè¾“å…¥ token,å¯ä»¥è¿›å…¥ TeamCity Server æœ¬åœ°æ˜ å°„æ–‡ä»¶ä¸­æŸ¥æ‰¾ï¼Œæˆ–æ˜¯ä½¿ç”¨ docker logs teamcity-server å³å¯çœ‹åˆ° tokenã€‚ åˆ›å»ºé¡¹ç›®æ—¶ï¼ŒTeamCity é»˜è®¤ä½¿ç”¨ç”¨æˆ·åå¯†ç è¿žæŽ¥ Github,å½“ç„¶å¯ä»¥é€šè¿‡ä¸Šä¼ æœ¬åœ° ssh key å¯†é’¥åˆ° TeamCity Server,é€šè¿‡ TeamCity Server è¿žæŽ¥. è®¾ç½®ç¼–è¯‘æ­¥éª¤,æˆ‘å†æ¬¡æ‰§è¡Œäº†shell è„šæœ¬ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#! /bin/bash# å®‰è£… nodejsVERSION=v10.15.2DISTRO=linux-x64function checkNode() &#123; ISNODESUCCEED=$(node -v) if [ ISNODESUCCEED != $VERSION ]; then installNode else echo "NodeJSå·²å®‰è£…" fi&#125;function insallNode() &#123; mkdir -p /usr/local/lib/nodejs tar -xJf /data/teamcity_agent/others/node-$VERSION-$DISTRO # -v ä¼šè¾“å‡ºè§£åŽ‹æ—¥å¿—ï¼Œæ­¤å¤„å¤ªå¤šï¼Œæ‰€ä»¥å…³é—­ export PATH=/usr/local/lib/nodejs/node-$VERSION-$DISTRO/bin:$PATH source ~/.profile checkNode&#125;checkNode# å®‰è£…ä¾èµ–npm i# ç”Ÿæˆpublicæ–‡ä»¶./node_modules/hexo/bin/hexo g# ä¸º github.io é…ç½® CNAMEif [ ! -f "/CNAME" ]; then echo "blog.dang8080.cn" &gt; CNAMEfi# é…ç½® gitgit config --global credential.helper store # ä¿å­˜ github æäº¤è€…ä¿¡æ¯ï¼Œä¸‹æ¬¡ä¸ç”¨å†è¾“å¯†ç git config --global user.name "Humphrey"git config --global user.email "dang8080@qq.com"git add --allgit commit -m "TeamCity CI æäº¤éƒ¨ç½²: $(date)"git push origin master é—®é¢˜: æ‰€ä»¥é—®é¢˜æ¥äº†,é…ç½®å®Œäº†ç‚¹å‡» run æŸ¥çœ‹ Build log ä¼šå‘çŽ° push å¤±è´¥ã€‚å› ä¸ºé€šè¿‡ https å‘ github æäº¤ä»£ç éœ€è¦äº¤äº’å¼è¾“å…¥ç”¨æˆ·å¯†ç ã€‚è€Œæ­¤å¤„æ²¡æœ‰æä¾›ï¼Œå°†å¯†ç ç¡¬ç¼–ç åˆ°æ­¤ shell é‡Œæäº¤åˆ° github ä¹Ÿä¸å®‰å…¨ã€‚æˆ–è€…å³ä½¿æ˜¯é€šè¿‡ä¿®æ”¹ VCS root ä½¿ç”¨ git@github.com ssh checkout çš„ä»£ç ï¼Œä¹Ÿæ— æ³•æŽ¨é€åˆ° github. é—®é¢˜å®šä½: TeamCity SSH agent ä½¿ç”¨æœ¬æœº(Linux/MacOS)çš„ OpenSSH ç®¡ç† SSH,å¯¹äºŽ Windows,éœ€è¦æ‰‹åŠ¨å®‰è£… OpenSSH (CygWin,MinGW,Git for Windows).SSH agent å¿…é¡»æ·»åŠ åˆ° $PATH ä¸­.ç¬¬ä¸€æ¬¡è¿žæŽ¥åˆ°è¿œç¨‹åœ°å€æ—¶ï¼ŒSSH agent ä¼šè¯¢é—®æ˜¯å¦ä¿å­˜è¿œç¨‹åœ°å€çš„ fingerprint åˆ°åœ°å€æ•°æ®åº“ ~/.ssh/known_hostsä¸­.ä¸ºäº†é¿å…è¯¢é—®ï¼Œå¯ä»¥æå‰é…ç½®ã€‚å¦‚æžœç›¸ä¿¡è¯¥è¿œç¨‹åœ°å€ï¼Œå¯ä»¥ç¦ç”¨è¿œç¨‹åœ°å€æ£€æŸ¥ å¯¹æ‰€æœ‰çš„è¿žæŽ¥éƒ½ç¦ç”¨ï¼Œ~/.ssh/config 123Host \*StrictHostKeyChecking no ç‰¹å®šè¿žæŽ¥,-o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no TeamCity å½“å‰ä»…æ”¯æŒ PEM æ ¼å¼çš„ key.å¦‚æžœä½¿ç”¨äº†å…¶ä»–æ ¼å¼çš„ keyï¼Œè¯·å°†å…¶è½¬æ¢ä¸º PEM.å¯ä»¥åœ¨ TeamCity web ç•Œé¢ Conversions -&gt; Export OpenSSH key ä¸­è½¬æ¢. OpenSSH æœ€è¿‘ç‰ˆæœ¬é»˜è®¤ä¸ç”Ÿæˆ PEM æ ¼å¼ key.ä½¿ç”¨ä¸‹åˆ—æ–¹å¼ç”Ÿæˆ PEM: ssh-keygen -t rsa -m PEM ä¸Šä¼ åˆ° TeamCity Server çš„ SSH key é»˜è®¤ä¿å­˜åœ¨ &lt;TeamCity Data Directory&gt;/config/projects/&lt;project&gt;/pluginData/ssh_keysï¼ŒTeamCity ä¼šè¿½è¸ªæ­¤æ–‡ä»¶å¤¹ä¿è¯ SSH key æ›´æ–°ã€‚SSH key é€‚ç”¨äºŽæœ¬é¡¹ç›®åŠå­é¡¹ç›®. åœ¨ TeamCity agent checkout æ‰§è¡Œæ—¶ï¼ŒGit æ’ä»¶ä¼šä»Ž TeamCity Server ä¸‹è½½ SSH key åˆ° agent.è¯¥ key ä¼šæš‚æ—¶ä¿å­˜åœ¨ TeamCity agent çš„æ–‡ä»¶ç³»ç»Ÿé‡Œï¼Œåœ¨ fetch/clone ç»“æŸåŽå°±è¢«åˆ é™¤. key è¢«åˆ é™¤çš„åŽŸå› æ˜¯ï¼šé€šè¿‡ build æ‰§è¡Œçš„ test å¯èƒ½ä¼šç•™ä¸‹æ¶æ„ä»£ç ï¼Œä¹‹åŽä¼šè®¿é—® TeamCity agent æ–‡ä»¶ç³»ç»Ÿ, TeamCity æ˜¯ä¸æ”¯æŒ git ssh æŽ¨åŠ¨ä»£ç åˆ° github çš„.ï¼ˆæ”¯æŒ ssh ä¼ é€æ–‡ä»¶ï¼‰ æ–¹æ¡ˆä¸€:å½“ run ä¸€æ¬¡ä¹‹åŽï¼Œæ‰§è¡Œ docker exec -it teamcity-agent bash è¿›å…¥ opt/buildagent/work/xxxxx/ ä¸‹,æ‰‹åŠ¨ git push origin masterã€‚è¿™æ ·åŽç»­å°±ä¸ç”¨å†é…ç½®äº† æ–¹æ¡ˆäºŒ:(ç¡¬æ ¸)github éœ€è¦ä¿å­˜æœ¬æœºçš„ SSH pub key,æ‰æŽ¥å— git ssh æŽ¨é€.é‚£æˆ‘ä»¬å°±åœ¨ TeamCity ç”Ÿæˆ ssh key,ç„¶åŽæ·»åŠ åˆ° github. å®žè·µä¸€1234docekr exec -it teamcity-agent bashssh-keygen -t rsassh-add [id_rsa]# ç„¶åŽå¤åˆ¶ id_rsa.pub çš„å†…å®¹åˆ° github å³å¯ å®žè·µäºŒè¿ž TeamCity agent bash ä¹Ÿä¸æƒ³è¿›ï¼Œä½¿ç”¨ shell æž„å»ºå…ˆå®‰è£… expect tcl tk 123456789101112131415161718192021222324apt-get update &amp;&amp; apt-get install tcl tk expect# ä¸‹é¢æ˜¯ shell#! /usr/bin/expect -fset context $PWD# åˆ é™¤æ—§keyspawn rm -f "$context/id_rsa" "$context/id_rsa.pub"expect&#123;&#125;# ç”Ÿæˆæ–°keyspawn ssh-keygen -t rsaexpect&#123; "*save the key*" &#123; send "$context/id_rsa\r";exp_continue &#125; "*passphrase*" &#123; send "\r";exp_continue &#125; "*again*" &#123; send "\r" &#125;&#125;spawn ssh-add "$context/id_rsa"sshcheck=$(ssh -vT git@github.com)if [[ $sshcheck =~ "successfully authenticated" ]]; then echo "ssh é…ç½®æˆåŠŸ"else echo "ssh é…ç½®å¤±è´¥"fi# å¤åˆ¶ pubpubkey=$(cat "$context/id_rsa)curl -H "Content-Type:application/json" -X POST --data '&#123; "title":"TeamCityAgentAuto","key":"$pubkey"&#125;']]></content>
      <tags>
        <tag>teamcity</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Room & kotlin coroutine]]></title>
    <url>%2F2019%2F03%2F03%2FRoom-kotlin-coroutine%2F</url>
    <content type="text"><![CDATA[OverviewRoom 2.1 å¼€å§‹æ”¯æŒ Kotlin åç¨‹ã€‚DAO æ–¹æ³•å¯ä»¥ä½¿ç”¨ suspend æ ‡è®°ä»¥ç¡®ä¿è¿™äº›æ–¹æ³•ä¸ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­è¢«æ‰§è¡Œã€‚Room ä½¿ç”¨ Executor(æ¥è‡ªæ¡†æž¶ç»„ä»¶) ä½œä¸º Dispatcher è¿è¡Œ SQL è¯­å¥ï¼Œå½“ç„¶åœ¨ç¼–è¯‘ RoomDatabase æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥æä¾›è‡ªå·±çš„ Executor. å½“å‰åç¨‹æ”¯æŒæ­£åœ¨å¼€å‘ä¸­ï¼Œæ›´å¤šç‰¹æ€§æ­£åœ¨è®¡åˆ’ä¸­ æ·»åŠ ä¾èµ–è¯·å‡çº§ Room åˆ° v2.1, åŒæ—¶ Kotlin v1.3.0+ , Coroutines v1.0.0+ 1implementation "androidx.room:room-coroutines:$&#123;versions.room&#125;" çŽ°åœ¨å°±å¯ä»¥ä½¿ç”¨å•¦ 123456789101112131415161718@Daointerface UsersDao &#123; @Query("SELECT * FROM users") suspend fun getUsers(): List&lt;User&gt; @Query("UPDATE users SET age = age + 1 WHERE userId = :userId) suspend fun incrementUserAge(userId: String) @Insert suspend fun insertUser(user: User) @Update suspend fun updateUser(user: User) @Delete suspend fun deleteUser(user: User)&#125; åœ¨è°ƒç”¨å…¶ä»– suspending DAO å‡½æ•°æ—¶ï¼Œ@Transaction ä¹Ÿå¯ä»¥è¢« suspending 123456789101112131415@Daoabstract class UsersDao &#123; @Transaction open suspend fun setLoggedInUser(loggedInUser: user) &#123; deleteUser(loggedInUser) insertUser(loggedInUser) &#125; @Query("DELETE FROM users") abstract fun deleteUser(user: User) @Insert abstract suspend fun insertUser(user: User)&#125; æ ¹æ®æ˜¯å¦åœ¨ transaction å†…è°ƒç”¨ï¼ŒRoom å¯¹ suspending å‡½æ•°å¤„ç†é€»è¾‘ä¸åŒ. åœ¨ Transaction ä¸­ åœ¨æ•°æ®åº“è¯­å¥è¢«è§¦å‘çš„ CoroutineContext ä¸‹ï¼ŒRoom ä¸åšä»»ä½•å¤„ç†ã€‚å‡½æ•°è°ƒç”¨è€…åº”è¯¥ç¡®ä¿æ­¤æ–¹æ³•ä¸ä¼šåœ¨ UI çº¿ç¨‹ä¸­æ‰§è¡Œ.å› ä¸º suspend å‡½æ•°åªèƒ½è¢«å…¶ä»– suspend å‡½æ•° æˆ–åœ¨ coroutine å†…è°ƒç”¨ï¼Œæ‰€ä»¥ä½ ä¸èƒ½æŠŠ Dispatchers.Main èµ‹å€¼ç»™ Dispatcherï¼Œåº”è¯¥æ˜¯ Dispatchers.IO æˆ–è‡ªå®šä¹‰ ä¸åœ¨ Transaction ä¸­ Room ä¼šç¡®ä¿æ•°æ®åº“è¯­å¥åœ¨ Architecutre Components I/O Dispatcher ä¸­è§¦å‘ã€‚è¯¥ Dispatcher åœ¨åŒä¸€ä¸ª I/O Executor çš„ä¸€ä¸ªåŽå°çº¿ç¨‹ä¸­è¿è¡Œ LiveData åº•å±‚12345@Insertfun insertUserSync(user: User)@Insertsuspend fun insertUser(user: User) å¯¹äºŽåŒæ­¥ insert,ç”Ÿæˆçš„ä»£ç å¼€å§‹å¯åŠ¨ä¸€ä¸ª transaction,ç„¶åŽæ‰§è¡Œ insert,æ ‡è®° transaction successfull ï¼Œç»ˆç»“ã€‚åŒæ­¥æ–¹æ³•åœ¨è¢«è°ƒç”¨å¤„çš„çº¿ç¨‹æ‰§è¡Œ. 12345678910@Overridepublic void insertUserSync(final User user) &#123; __db.beginTransaction(); try &#123; __insertionAdapterOfUser.insert(user); __db.setTransactionSuccessful(); &#125; finally &#123; __db.endTransaction(); &#125;&#125; suspending ä¼šç¡®ä¿ä¸ä¼šåœ¨ UI çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ç”Ÿæˆçš„ä»£ç ä¼šä¼ é€’ä¸€ä¸ª Continuation.åœ¨ Callable#call() ä¸­æ‰§è¡Œå’ŒåŒæ­¥ç›¸åŒçš„ä»£ç  1234567891011121314151617@Overridepublic Object insertUserSuspend(final User user, final Continuation&lt;? super Unit&gt; p1) &#123; return CoroutinesRoom.execute(__db, new Callable&lt;Unit&gt;() &#123; @Override public Unit call() throws Exception &#123; __db.beginTransaction(); try &#123; __insertionAdapterOfUser.insert(user); __db.setTransactionSuccessful(); return kotlin.Unit.INSTANCE; &#125; finally &#123; __db.endTransaction(); &#125; &#125; &#125;, p1);&#125; CoroutinesRoom.execute ä¼šæ ¹æ®æ•°æ®åº“æ˜¯å¦ open,å½“å‰è°ƒç”¨æ˜¯å¦åœ¨ transaction å†…æ¥åˆ‡æ¢å¤„ç† context. is open &amp; in transaction ä»…è°ƒç”¨ insert é€»è¾‘ not in transaction ä½¿ç”¨ Architecture Components IO Executor åœ¨åŽå°çº¿ç¨‹æ‰§è¡Œ insert é€»è¾‘]]></content>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>Room</tag>
        <tag>Kotlin</tag>
        <tag>Kotlin åç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[docker,docker-composeå­¦ä¹ ç¬”è®°]]></title>
    <url>%2F2019%2F03%2F01%2Fdocker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[OverviewCompose æ˜¯ä¸€ä¸ªä¸ºäº†å®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨çš„å·¥å…·ã€‚å®˜æ–¹åŠ¨æ‰‹ç¤ºä¾‹ ç‰¹æ€§ ä¸€ä¸ªä¸»æœºå¤šä¸ªéš”ç¦»çŽ¯å¢ƒ å½“å®¹å™¨åˆ›å»ºæ—¶ä¿ç•™æ‰€æœ‰çš„ volume åªæœ‰å®¹å™¨è¢«æ›´æ”¹æ—¶æ‰è§¦å‘åˆ›å»º å®šä¹‰å˜é‡å’Œåœ¨ä¸åŒçŽ¯å¢ƒä¸­ä½¿ç”¨ ä½¿ç”¨åœºæ™¯ è‡ªåŠ¨æµ‹è¯•çŽ¯å¢ƒ å•ç‹¬ä¸»æœºéƒ¨ç½² docker-compose å®‰è£…1234sudo curl -L "https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-composesudo chmod +x /usr/local/bin/docker-composesudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-composesudo docker-compose --version pip å®‰è£… 1pip install docker-compose å¸è½½ 12sudo rm /usr/local/bin/docker-composepip uninstall docker-compose docker-compose å‘½ä»¤ -f æŒ‡å®š ä¸€ä¸ªæˆ–å¤šä¸ª compose æ–‡ä»¶çš„åç§°å’Œè·¯å¾„ 1ã€ä½¿ç”¨å¤šä¸ª Compose æ–‡ä»¶æ—¶ï¼ŒCompose ä¼šæŠŠè¿™å‡ ä¸ªæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªé…ç½®ã€‚æŒ‰é¡ºåºåˆå¹¶ï¼ŒåŽè¾¹çš„è¦†ç›–å‰è¾¹çš„é…ç½®ã€‚2ã€docker-compose -f docker-compose.yml -f docker-compose.admin.yml run backup_db3ã€ä½¿ç”¨ -(dash) ä½œä¸º -f çš„å€¼ï¼Œå°†ä¼šä»Žè¾“å…¥ä¸­è¯»å–é…ç½®æ–‡ä»¶åã€‚ä½¿ç”¨ stdin æ—¶ï¼Œé…ç½®é‡Œæ¶‰åŠåˆ°çš„è·¯å¾„éƒ½æ˜¯ç›¸å¯¹äºŽå½“å‰å·¥ä½œä¸Šä¸‹æ–‡è·¯å¾„ã€‚4ã€å¦‚æžœä¸æ˜¯ç”¨ -f,Compose éåŽ†å½“å‰ä¸Šä¸‹æ–‡è·¯å¾„å’Œå®ƒçš„çˆ¶è·¯å¾„æŸ¥è¯¢ docker-compose.yml å’Œ docker-compose.override.yml æ–‡ä»¶ã€‚è¯·è‡³å°‘æä¾›ä¸€ä¸ª docker-compose.yml æ–‡ä»¶ã€‚å¦‚æžœæ‰€æœ‰çš„æ–‡ä»¶éƒ½åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼ŒCompose å°†åˆå¹¶å®ƒä»¬ã€‚5ã€docker-compose.override.yml çš„é…ç½®é«˜äºŽ docker-compose.yml,ä¸”ä¸ºåŽè€…æä¾›é¢å¤–çš„é…ç½®å±žæ€§ã€‚ ä¸ºå•ç‹¬çš„ Compose æ–‡ä»¶æŒ‡å®šè·¯å¾„ 1ã€ä½¿ç”¨ -f, æˆ–ä»Žå‘½ä»¤è¡Œè¾“å…¥ï¼Œæˆ–åœ¨ shell / æŸä¸ªçŽ¯å¢ƒé…ç½®æ–‡ä»¶ä¸­è®¾ç½® COMPOSE_FILE çŽ¯å¢ƒå˜é‡,æŒ‡å®šä¸åœ¨å½“å‰æ–‡ä»¶å¤¹çš„ Compose æ–‡ä»¶è·¯å¾„.2ã€docker-compose -f ~/sandbox/rails/docker-compose.yml pull db ä»Ž ~/sandbox/rails/docker-compose.yml æ–‡ä»¶ä¸­èŽ·å– db æœåŠ¡ä¸­å®šä¹‰çš„ postgres db é•œåƒã€‚ -p æŒ‡å®šé¡¹ç›®å 1ã€å¦‚æžœä¸æŒ‡å®š -p,Compose é»˜è®¤ä½¿ç”¨å½“å‰æ–‡ä»¶å¤¹çš„åç§°ã€‚ é…ç½®çŽ¯å¢ƒå˜é‡ docker-compose CLI çŽ¯å¢ƒå˜é‡é»˜è®¤å†…ç½®äº†å‡ ä¸ªçŽ¯å¢ƒå˜é‡å¯ä»¥é…ç½® docker-compose.ä»¥ DOCKER_ å¼€å¤´çš„å˜é‡å’Œé…ç½® docker å‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„å˜é‡ç±»ä¼¼ã€‚å¦‚æžœä½¿ç”¨ docker-machineçš„è¯ï¼Œeval &quot;$(docker-machine env my-docker-vm)&quot;å°†ä¸ºå˜é‡è®¾ç½®æ­£ç¡®çš„å€¼ã€‚ COMPOSE_PROJECT_NAME 1ã€è®¾ç½®é¡¹ç›®å.è¯¥å€¼åœ¨å¯åŠ¨æ—¶ä¼šä½œä¸ºå®¹å™¨æœåŠ¡çš„å‰ç¼€.æ¯”å¦‚é¡¹ç›®å myapp,åŒ…å«ä¸¤ä¸ªæœåŠ¡ db å’Œ web,é‚£ä¹ˆ Compose å¯åŠ¨çš„å®¹å™¨åä¸º myapp_db_1 å’Œ myapp_web_1.2ã€é»˜è®¤æ—¶é¡¹ç›®æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•åã€‚ COMPOSE_FILE 1ã€æŒ‡å®š Compose æ–‡ä»¶è·¯å¾„ã€‚å¦‚æžœæœªæŒ‡å®šï¼ŒCompose å°†åœ¨å½“å‰æ–‡ä»¶å¤¹æŸ¥è¯¢ docker-compose.yml æ–‡ä»¶ï¼Œå¦‚æžœä¸å­˜åœ¨å°†ç»§ç»­éåŽ†çˆ¶ç›®å½•ç›´åˆ°æ‰¾åˆ°ã€‚2ã€æ”¯æŒä½¿ç”¨æ–‡ä»¶è·¯å¾„åˆ†éš”ç¬¦(Linux &amp; MacOS [:] Windows [;]).æ¯”å¦‚ COMPOSE_FILE=docker-compose.yml:docker-compose.prod.yml,è·¯å¾„åˆ†éš”ç¬¦å¯ä»¥é€šè¿‡ COMPOSE_PATH_SEPARATOR è‡ªå®šä¹‰ COMPOSE_API_VERSION 1ã€Docker API ä»…æ”¯æŒæ¥è‡ªæŒ‡å®šç‰ˆæœ¬å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ä½¿ç”¨ docker-compose æ—¶å‡ºçŽ° client and server don&#39;t have same version é”™è¯¯ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è®¾ç½®è¯¥å˜é‡è§£å†³ã€‚2ã€è®¾ç½®è¯¥å˜é‡ä¸»è¦é’ˆå¯¹ä¸´æ—¶çš„è¿è¡Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç‰ˆæœ¬ä¸ä¸€è‡´çš„æƒ…å†µã€‚ DOCKER_HOST 1ã€ä¸º docker daemon è®¾ç½® URL.å’Œ docker å®¢æˆ·ç«¯ä¸€æ ·ï¼Œé»˜è®¤ä¸º unix:///var/run/docker.sock DOCKER_TLS_VERIFY 1ã€è®¾ç½®ç©ºå­—ç¬¦ä»¥å¤–çš„ä»»ä½•å€¼æ—¶ï¼Œå¼€å¯ TLS. DOCKER_CERT_PATH 1ã€é…ç½® ca.pem,cert.pem,key.pem çš„è·¯å¾„ã€‚é»˜è®¤ ~/.docker COMPOSE_HTTP_TIMEOUT 1ã€è¶…æ—¶æ—¶é—´(ç§’).é»˜è®¤ 60s COMPOSE_TLS_VERSION 1ã€TLS ç‰ˆæœ¬.é»˜è®¤ TLSv1. å¯ä¾›é€‰é¡¹ TLSv1, TLSv1_1, TLSv1_2 COMPOSE_CONVERT_WINDOWS_PATH 1ã€æ˜¯å¦å¼€å¯æŠŠ Windos-style çš„è·¯å¾„è½¬ä¸º Unix-style çš„å·å®šä¹‰ã€‚åœ¨ Windos ä¸Šä½¿ç”¨ Docker Machine å’Œ Docker Toolbox æ—¶æ€»æ˜¯è¦è®¾ç½®è¯¥å˜é‡ã€‚é»˜è®¤ 0ã€‚ true/1 ä»£è¡¨å¼€å¯ï¼Œfalse/0 ä»£è¡¨å…³é—­. COMPOSE_PATH_SEPARATOR 1ã€å¦‚æžœè®¾ç½®ï¼ŒCOMPOSE_FILE å€¼å°†ä½¿ç”¨æ­¤å¤„çš„å®šä¹‰ä½œä¸ºåˆ†éš”ç¬¦ã€‚ COMPOSE_FORCE_WINDOWS_HOST 1ã€å¦‚æžœè®¾ç½®ï¼Œå³ä½¿ Compose è¿è¡Œåœ¨ Unix-based ç³»ç»Ÿä¸Šï¼Œå·å®šä¹‰ä¹Ÿå°†ä½¿ç”¨ç®€ç•¥è¯­æ³•è§£æžä¸ºå‡è®¾è¿è¡Œåœ¨ Windows ä¸Šçš„è·¯å¾„ã€‚true/a,false/0 COMPOSE_IGNORE_ORPHANS 1ã€å¦‚æžœè®¾ç½®ï¼ŒCompose ä¸ä¼šè¯•ç€å¯¹é¡¹ç›®çš„å•ç‹¬å®¹å™¨æ£€æµ‹ã€‚true/1,false/0 COMPOSE_PARALLEL_LIMIT 1ã€å¹¶è¡Œæ‰§è¡Œçš„é™åˆ¶ã€‚é»˜è®¤ 64ï¼Œç»ä¸èƒ½ä½ŽäºŽ 2. COMPOSE_INTERACTIVE_NO_CLI 1ã€å¦‚æžœè®¾ç½®ï¼ŒCompose ä¸ä¼šå°è¯•ä½¿ç”¨ Docker CLI å’Œ run exec æ“ä½œäº¤äº’ã€‚true/1,false/0 Compose fileversion 3buildé…ç½®é€‰é¡¹åœ¨ç¼–è¯‘æœŸç”Ÿæ•ˆã€‚build å¯ä»¥æŒ‡å®šä¸€ä¸ªè·¯å¾„ 1234version: "3"services: webapp: build: ./dir æˆ–è€…æ˜¯ä¸€ä¸ªåœ¨æŒ‡å®š context ä¸‹çš„è·¯å¾„å¯¹è±¡ï¼ŒåŒæ—¶å¯åŒ…å« Dockerfile å’Œ args 12345678version: "3"services: webapp: build: context: ./dir dockerfile: Dockerfile-alternate args: buildno: 1 å¦‚æžœåŒæ—¶ä¹ŸæŒ‡å®šäº† image,Compose ä½¿ç”¨ webapp å’Œ image ä¸­æŒ‡å®šçš„å¯é€‰çš„ tag å‘½åæœ€ç»ˆç”Ÿæˆçš„é•œåƒå 12build: ./dirimage: webapp:tag swarm mode ä¸æ”¯æŒã€‚docker stack å‘½ä»¤åªæŽ¥å—é¢„ç¼–è¯‘çš„é•œåƒ. CONTEXTå¯ä»¥æ˜¯åŒ…å« Dockerfile æ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ– git ä»“åº“çš„ url.å¦‚æžœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆè¢«è§£æžä¸ºç›¸å¯¹äºŽå½“å‰ Compose æ–‡ä»¶çš„è·¯å¾„ã€‚æ­¤æ–‡ä»¶å¤¹åŒæ—¶ä¹Ÿæ˜¯å‘é€åˆ° Docker daemon çš„ç¼–è¯‘ä¸Šä¸‹æ–‡ã€‚ DOCKERFILEå¯é€‰æ­¤å¤„å¿…é¡»æŒ‡å®šç¼–è¯‘è·¯å¾„ ARGSåªæœ‰åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å¯è®¿é—®çš„çŽ¯å¢ƒå˜é‡ã€‚é¦–å…ˆï¼Œåœ¨ Dokcerfile ä¸­æŒ‡å®šå‚æ•°: 12345ARG buildnoARG gitcommithashRUN echo "Build number: $buildno"RUN echo "Bashed on commit: $gitcommithash" ç„¶åŽåœ¨ build ä¸‹ç»™è¯¥å‚æ•°å¤åˆ¶ï¼ˆå¯ä»¥æ˜¯é”®å€¼å¯¹åˆ—è¡¨ï¼‰ï¼š 1234567891011build: context: . args: buildno: 1 gitcommithash: cdc3b19build: context: . args: - buildno=1 - gitcommithash=cdc3b19 ä½ ä¹Ÿå¯ä»¥ä¸æŒ‡å®šå€¼ï¼Œå®ƒçš„å€¼å°±æ˜¯ç¼–è¯‘æ—¶ Compose å½“å‰è¿è¡ŒçŽ¯å¢ƒçš„å€¼. YAML å¸ƒå°”å€¼(true,false,yes,no,on,off)åº”è¯¥ä½¿ç”¨å¼•å·åº”ç”¨ï¼Œè¿™æ ·è§£æžå™¨æ‰èƒ½æŠŠå®ƒä»¬è§£æžä¸º string CACHE_FROM v3.2+ æŒ‡å®š engine å¯ä»¥ç¼“å­˜çš„é•œåƒåˆ—è¡¨ 12345build: context: . cache_from: - alpine:latest - corp/webapp:3.14 LABELS v3.3+ å‘ç”Ÿæˆçš„é•œåƒæ·»åŠ å…ƒæ•°æ®ã€‚å¯ä»¥æ˜¯æ•°ç»„æˆ–ç›®å½•æŽ¨èä½¿ç”¨åå‘ DNS æ ‡è®°ä»¥é¿å…å’Œå…¶ä»–è½¯ä»¶å†²çª 12345678910111213build: context: . labels: com.example.description: "Accounting webapp" com.example.department: "Finance" com.example.label-with-empty-value: ""build: context: . labels: - "com.example.description=Accounting webapp" - "com.example.department=Finance" - "com.example.label-with-empty-value" SHM_SIZE v3.5+ è®¾ç½®ç¼–è¯‘ç”Ÿæˆå®¹å™¨ dev/shm&#39; åˆ†åŒºå¤§å°ã€‚int å€¼å•ä½ä¸º byte. string å¯ä»¥æºå¸¦å•ä½ 1234567build: context: . shm_size: '2gb'build: context: . shm_size: 10000000 TARGET v3.4+ ç¼–è¯‘ Dockerfile ä¸­å®šä¹‰çš„æŒ‡å®šç‰ˆæœ¬ 123build: context: . target: prod cap_add,cap_dropæ·»åŠ æˆ–åˆ é™¤å®¹å™¨çš„å®¹é‡ã€‚man 7 capabilities æŸ¥çœ‹å¯ç”¨åˆ—è¡¨ 12345cap_add: - ALLcap_drop: - NET_ADMIN - SYS_ADMIN swarm mode æ— æ•ˆ cgroup_parentä¸ºå®¹å™¨æŒ‡å®šå¯é€‰çš„ cgroup parent 1cgroup_parent: m-executor-abcd swarm mode æ— æ•ˆ commandè¦†ç›–é»˜è®¤çš„å‘½ä»¤ 1command: bundle exec thin -p 3000 ä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨ 1command: ["bundle", "exec", "thin", "-p", "3000"] configsTips å…±äº«æ–‡ä»¶å¤¹ï¼Œå·ï¼Œç»‘å®šæŒ‚è½½ å¦‚æžœä½ çš„é¡¹ç›®ä¸åœ¨ Usersç›®å½•(cd ~),é‚£ä¹ˆä½ éœ€è¦å…±äº«é©±åŠ¨å™¨æˆ– Dockerfile æ‰€åœ¨ä½ç½®å’Œå½“å‰æ­£åœ¨ä½¿ç”¨çš„å·ã€‚å¦‚æžœå‡ºçŽ°è¿è¡Œæ—¶é”™è¯¯è¡¨ç¤ºæ–‡ä»¶æœªæ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªæŒ‚è½½å·çš„è¯·æ±‚è¢«æ‹’ç»ï¼Œæˆ–æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè¯•ç€å…±äº«æ–‡ä»¶æˆ–é©±åŠ¨ã€‚æŒ‚è½½å·è¦æ±‚å…±äº«é¡¹ç›®ä¸åœ¨ C:\Users (Windows),æˆ– /Users (Mac) çš„é©±åŠ¨ï¼Œå¹¶ä¸”å¦‚æžœæ˜¯è¿è¡Œåœ¨ Dokcer Desktop for Windows çš„ Linux å®¹å™¨ä¸Šçš„æ‰€æœ‰åº”ç”¨éƒ½éœ€è¦å…±äº«ã€‚ å¦‚æžœæ”¹å˜äº†ä¸€ä¸ªæœåŠ¡çš„ Dockerfile æˆ–è€…ç¼–è¯‘æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹ï¼Œè¿è¡Œ docker-compose buildé‡æ–°ç¼–è¯‘ å®˜æ–¹ç¤ºä¾‹Compose &amp; WordPress ä¸ºé¡¹ç›®åˆ›å»ºç©ºæ–‡ä»¶å¤¹ã€‚è¯¥æ–‡ä»¶å¤¹ä½œä¸ºåº”ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œä¸”åªä¿å­˜æž„å»ºé•œåƒæ‰€éœ€çš„èµ„æºã€‚ åˆ›å»º docker-compose.yml 1234567891011121314151617181920212223242526272829version: "3.3"services: db: image: mysql:5.7 volumes: - db_data:/var/lib/mysql restart: always environment: MYSQL_ROOT_PASSWORD: somewordpress MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress wordpress: depends_on: - db image: wordpress:latest ports: - "8000:80" restart: always environment: WORDPRESS_DB_HOST: db:3306 WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: wordpress WORDPRESS_DB_NAME: wordpress volumes: db_data: &#123;&#125;# db_data å·ä¼šä¿å­˜ä»»ä½• WordPress å¯¹æ•°æ®åº“çš„æ”¹å˜ã€‚# WordPress é€šå¸¸å¼€æ”¾ 80 å’Œ 443 ç«¯å£. docker-compose up -d. å¦‚æžœä½¿ç”¨ Docker Machine, é‚£ä¹ˆè¿è¡Œ docker-machine ip MACHINE_VM èŽ·å–è¿è¡Œåœ°å€ã€‚å¦‚æžœæ˜¯ destop ç‰ˆï¼Œhttp://localhost å³å¯. docker-compose down ç§»é™¤å®¹å™¨ï¼Œé»˜è®¤çš„ç½‘ç»œï¼Œä¿ç•™ WordPress å’Œæ•°æ®åº“ã€‚docker-compose down --volumes å…¨éƒ¨ç§»é™¤ã€‚]]></content>
      <tags>
        <tag>docker</tag>
        <tag>å­¦ä¹ ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[è¯‘]-LiveData with SnackBar,Navigation and other events(the SingleLiveEvent case)]]></title>
    <url>%2F2019%2F02%2F28%2F%E8%AF%91-LiveData-with-SnackBar-Navigation-and-other-events-the-SingleLiveEvent-case%2F</url>
    <content type="text"><![CDATA[åŽŸæ–‡ view(activity/fragment) å’Œ ViewModel äº¤æµçš„æ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ LiveData observables. view è®¢é˜… LiveData çš„æ”¹å˜ä¸”éšæ—¶å“åº”ã€‚è¿™é€‚ç”¨äºŽè¿žç»­ä¸æ–­çš„æ˜¾ç¤ºåœ¨ä¸€ä¸ªå±å¹•çš„æ•°æ®ã€‚ä½†æ˜¯æŸäº›æ•°æ®å´æ›´åº”è¯¥è¢«æ¶ˆè´¹ä¸€æ¬¡ï¼Œæ¯”å¦‚ Snackbar æ¶ˆæ¯ï¼Œnavigation äº‹ä»¶ æˆ– dialog è§¦å‘å™¨ã€‚ä¸Žå…¶è¯•ç€é€šè¿‡æ‰©å±• Architecture Components æ‰©å±•æˆ–åº“è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸å¦‚æˆ‘ä»¬å¯ä»¥ç›´é¢è¿™æ˜¯ä¸ªè®¾è®¡ç¼ºé™·ã€‚æˆ‘ä»¬æŽ¨èä½ æŠŠä½ çš„äº‹ä»¶çœ‹ä½œæ˜¯çŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚æœ¬æ–‡æˆ‘ä»¬å°†åˆ—ä¸¾ä¸€äº›å¸¸è§çš„é”™è¯¯å’ŒæŽ¨èçš„è§£å†³æ–¹æ¡ˆã€‚ âŒ Bad: 1. å¯¹äº‹ä»¶ä½¿ç”¨ LiveDataåœ¨ LiveData å¯¹è±¡å†…éƒ¨ç›´æŽ¥æŒæœ‰ Snackbar æ¶ˆæ¯æˆ– navigation ä¿¡å·ã€‚åŽŸåˆ™ä¸Šæ™®é€šçš„ LiveData å¯¹è±¡å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼Œä½†å®žé™…ä¸Šä¼šæš´éœ²ä¸€äº›é—®é¢˜ã€‚åœ¨ master/detail æž¶æž„çš„ app ä¸­ï¼Œå¦‚ä¸‹æ˜¯ maters çš„ ViewModel 12345678910// è¯·ä¸è¦å¯¹äº‹ä»¶è¿™æ ·ç”¨class ListViewModel : ViewModel &#123; private val _navigateToDetails = MutableLiveData&lt;Boolean&gt;() val navigateToDetails : LiveData&lt;Boolean&gt; get() = _navigateToDetails fun userClicksOnButton() &#123; _navigateToDetails.value = true &#125;&#125; åœ¨ View(activity/fragment) ä¸­ 123myViewModel.navigateToDetails.observe(this,Observer &#123; if (it) startActivity(DetailsActivity....)&#125;) æ­¤æ–¹æ¡ˆçš„ä¸è¶³åœ¨äºŽ _navigateToDetailså°†ä¼šä¸€ç›´ä¸º true,è€Œä¸”ä¸å¯èƒ½å›žåˆ°é¦–å±: ç”¨æˆ·ç‚¹å‡»æŒ‰é’®å¯åŠ¨ Details Activity ç”¨æˆ·æŒ‰è¿”å›žæŒ‰é’®ï¼Œå›žåˆ°ä¸» Activity å½“ activity è¿›å…¥å›žé€€æ ˆæ—¶ observers å¤±æ´»ï¼ŒçŽ°åœ¨å†æ¬¡æ¿€æ´» ä»Ž ViewModel ä¸­è°ƒç”¨ navigation ä¸”ç«‹å³å°†å…¶è®¾ä¸º false 1234fun userClicksOnButton() &#123; _navigateToDetails.value = true _navigateToDetails.value = false&#125; ä½†æ˜¯è¯·æ³¨æ„ï¼š LiveData ä¿å­˜æ•°æ®ä½†ä¸ä¼šä¿è¯åœ¨æŽ¥å—åˆ°äº‹ä»¶æ—¶å‘é€ä»»ä½•æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“æ²¡æœ‰è§‚å¯Ÿè€…æ´»è·ƒæ—¶æ›´æ–°å€¼ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°å€¼å°†æ›¿æ¢åŽŸæ¥çš„å€¼ã€‚åŒæ—¶ï¼Œä»Žä¸åŒçº¿ç¨‹è®¾ç½®å±žæ€§å°†ä¼šå¯¼è‡´ç«žäº‰çŠ¶æ€ï¼Œæ­¤æ—¶ä»…èƒ½ä¿è¯ä¸€ä¸ªè§‚å¯Ÿè€…è¢«è°ƒç”¨ã€‚ æœ€ä¸»è¦çš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªæ–¹æ¡ˆå¾ˆéš¾ç†è§£è€Œä¸”ä»£ç åžƒåœ¾ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•ä¿è¯åœ¨ navigation äº‹ä»¶å‘ç”Ÿæ—¶å€¼é‡ç½®ï¼Ÿ âŒBetter: 2.ä½¿ç”¨ LiveData wrapper äº‹ä»¶ï¼Œåœ¨è§‚å¯Ÿè€…ä¸­é‡ç½®å±žæ€§.123456listViewModel.navigateToDetails.observe(this,Observer &#123; if (it) &#123; myViewModel.navigateToDetailsHandled() startActivity(DetailsActivity...) &#125;&#125;) 1234567891011121314class ListViewModel: ViewModel &#123; private val _navigateToDetails = MutableLiveData&lt;Boolean&gt;() val navigateToDetails: LiveData&lt;Boolean&gt; get() = _navigateToDetails fun userClicksOnButton() &#123; _navigateToDetails.value = true &#125; fun navigateToDetailsHandled() &#123; _navigateToDetails.value = false &#125;&#125; æ­¤æ–¹æ¡ˆçš„ä¸è¶³ä¹‹å¤„åœ¨äºŽæœ‰äº›å†—ä½™ä»£ç  âœ… okï¼šä½¿ç”¨ SingleLiveEventSingleLiveEvent åªé€‚ç”¨äºŽéƒ¨åˆ†åœºæ™¯ã€‚åªå‘é€å’Œæ›´æ–°ä¸€æ¬¡çŠ¶æ€çš„ LiveData 12345678910class ListViewModel: ViewModel &#123; private val _navigateToDetails = SingleLiveEvent&lt;Any&gt;() val navigateToDetails: LiveData&lt;Any&gt; get() = _navigateToDetails fun userClicksOnButton() &#123; _navigateToDetails.call() &#125;&#125; 123myViewModel.navigateToDetails.observe(this, Observer &#123; startActivity(DetailsActivity...)&#125;) 123456789101112131415161718192021222324252627282930313233343536373839// SingleLiveEventpublic class SingleLiveEvent&lt;T&gt; extends MutableLiveData&lt;T&gt; &#123; private static final String TAG = "SingleLiveEvent"; private final AtomicBoolean mPending = new AtomicBoolean(false); @MainThread public void observe(LifecycleOwner owner, final Observer&lt;T&gt; observer) &#123; if (hasActiveObservers()) &#123; Log.w(TAG, "Multiple observers registered but only one will be notified of changes."); &#125; // Observe the internal MutableLiveData super.observe(owner, new Observer&lt;T&gt;() &#123; @Override public void onChanged(@Nullable T t) &#123; if (mPending.compareAndSet(true, false)) &#123; observer.onChanged(t); &#125; &#125; &#125;); &#125; @MainThread public void setValue(@Nullable T t) &#123; mPending.set(true); super.setValue(t); &#125; /** * Used for cases where T is Void, to make calls cleaner. */ @MainThread public void call() &#123; setValue(null); &#125;&#125; æ­¤æ–¹æ¡ˆçš„ä¸è¶³ä¹‹å¤„åœ¨äºŽåªæœ‰ä¸€ä¸ªè®¢é˜…è€…ã€‚å¦‚æžœä½ æœ‰å¤šä¸ªè§‚å¯Ÿè€…ï¼Œé‚£ä¹ˆåªæœ‰ä¸€ä¸ªè¢«è°ƒç”¨ä¸”ä¸ä¿è¯é¡ºåºã€‚ âœ… æŽ¨èï¼šä½¿ç”¨ Event Wrapper1234567891011121314151617open class Event&lt;out T&gt;(private val content: T) &#123; val hasBeenHandled = false private set // åªè¯»å±žæ€§ /** * è¿”å›ž content, é˜»æ­¢å…¶å†æ¬¡è°ƒç”¨ fun getContentIfNotHandled(): T? &#123; return if (hasBeenHandled) &#123; null &#125; else &#123; hasBeenHandled = true content &#125; &#125; fun peekContent(): T = content&#125; 1234567891011class ListViewModel : ViewModel &#123; private val _navigateToDetails = MutableLiveData&lt;Event&lt;String&gt;&gt;() val navigateToDetails : LiveData&lt;Event&lt;String&gt;&gt; get() = _navigateToDetails fun userClicksOnButton(itemId: String) &#123; _navigateToDetails.value = Event(itemId) // Trigger the event by setting a new Event as a new value &#125;&#125; 1234567891011class ListViewModel : ViewModel &#123; private val _navigateToDetails = MutableLiveData&lt;Event&lt;String&gt;&gt;() val navigateToDetails : LiveData&lt;Event&lt;String&gt;&gt; get() = _navigateToDetails fun userClicksOnButton(itemId: String) &#123; _navigateToDetails.value = Event(itemId) // Trigger the event by setting a new Event as a new value &#125;&#125; æ­¤æ–¹æ¡ˆçš„ä¼˜åŠ¿æ˜¯ç”¨æˆ·éœ€è¦ä½¿ç”¨ getContentIfNotHandled() æˆ– peekContent()æŒ‡å®šæ„å›¾ã€‚æ­¤æ–¹æ³•æŠŠäº‹ä»¶æŠ½è±¡ä¸º state çš„ä¸€éƒ¨åˆ†ï¼šå˜æˆä»…è¡¨ç¤ºæ˜¯å¦è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚ ç»“è®ºæ€»ä¹‹ï¼ŒæŠŠäº‹ä»¶ä½œä¸ºçŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨è¿™ä¸ª EventObserver åœ¨å¤§é‡äº‹ä»¶ç»“æŸåŽç§»é™¤å®ƒ 1234567class EventObserver&lt;T&gt;(private val onEventUnhandledContent: (T) -&gt; Unit) : Observer&lt;Event&lt;T&gt;&gt; &#123; override fun onChanged(event: Event&lt;T&gt;?) &#123; event?.getContentIfNotHandled()?.let &#123; value -&gt; onEventUnhandledContent(value) &#125; &#125;&#125; 123inline fun &lt;T&gt; LiveData&lt;Event&lt;T&gt;&gt;.observeEvent(owner: LifecycleOwner, crossinline onEventUnhandledContent: (T) -&gt; Unit) &#123; observe(owner, Observer &#123; it?.getContentIfNotHandled()?.let(onEventUnhandledContent) &#125;)&#125;]]></content>
      <tags>
        <tag>ç¿»è¯‘</tag>
        <tag>LiveData</tag>
        <tag>Navigation</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LiveData]]></title>
    <url>%2F2019%2F02%2F28%2FLiveData%2F</url>
    <content type="text"><![CDATA[LiveData çš„ä¼˜åŠ¿ ç¡®ä¿ UI å’Œæ•°æ®çŠ¶æ€åŒ¹é… LiveData éµå¾ªè§‚å¯Ÿè€…æ¨¡å¼ã€‚ æ— å†…å­˜æ³„æ¼ ä¸ä¼šå› ä¸º Activity è¢«ç»ˆæ­¢è€Œå´©æºƒ å¦‚æžœè§‚å¯Ÿè€…å¤„äºŽ inactive çŠ¶æ€ï¼Œä¾‹å¦‚ activity å¤„äºŽå›žé€€æ ˆä¸­ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šæŽ¥æ”¶åˆ°ä»»ä½• LiveData äº‹ä»¶. ä¸ç”¨æ‰‹åŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ æ—¶åˆ»æ›´æ–°æ•°æ®çŠ¶æ€ å¦‚æžœä¸€ä¸ªè§‚å¯Ÿè€…çš„å˜ä¸º inactiveï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨é‡æ–° active æ—¶èŽ·å–æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª activiy å¦‚æžœå¤„äºŽåŽå°ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨é‡æ–°è¿”å›žå‰å°æ—¶èŽ·å–åˆ°æœ€æ–°çš„æ•°æ®ã€‚ åº”å¯¹ configuration change å¦‚æžœä¸€ä¸ª activity æˆ– fragment ç”±äºŽ configuration change(è®¾å¤‡æ—‹è½¬) å¯¼è‡´é‡æ–°åˆ›å»ºï¼Œå®ƒä¼šç«‹å³èŽ·å–æœ€æ–°å¯ç”¨çš„æ•°æ®. å…±äº«èµ„æº å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ‰©å±• LiveDataï¼Œå°è£…ç³»ç»ŸæœåŠ¡åœ¨ app å†…å…±äº«ã€‚ åœ¨ ViewModel å¯¹è±¡ä¸­ä¿å­˜å¯ä»¥æ›´æ–° UI çš„ LiveData å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨ activity æˆ– fragment çš„åŽŸå› æ˜¯ï¼š é¿å… activty æˆ– framgent è¿‡åº¦è†¨èƒ€ã€‚UI controller ä»…è´Ÿè´£å±•ç¤ºæ•°æ®è€Œä¸æ˜¯ä¿å­˜æ•°æ®çŠ¶æ€ ä»Žç‰¹æ€§çš„ activity æˆ– fragment ä¸­å‰¥ç¦» LiveData å®žä¾‹ï¼Œä½¿å¾— LiveData å¯¹è±¡å¯ä»¥åœ¨ configuration change ä¸­å­˜æ´»ã€‚ è¯·åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ setValue(T) æ›´æ–° LiveData å¯¹è±¡.å¦‚æžœæ˜¯åœ¨å·¥ä½œçº¿ç¨‹ï¼Œè¯·è°ƒç”¨ postValue(T).]]></content>
      <tags>
        <tag>Architecture Components</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxé«˜çº§-6-å…ƒæ¨¡åž‹,IDs,UIDs]]></title>
    <url>%2F2019%2F02%2F26%2FObjectBox%E9%AB%98%E7%BA%A7-6-%E5%85%83%E6%A8%A1%E5%9E%8B-IDs-UIDs%2F</url>
    <content type="text"><![CDATA[ä¸åƒ SQLite è¿™æ ·çš„æ•°æ®åº“ï¼ŒObjectBox ä¸éœ€è¦ä½ åˆ›å»º database schema.è¿™ä¸æ„å‘³ç€ ObjectBox æ˜¯æ—  schema çš„ã€‚ä¸ºé«˜æ•ˆèµ·è§ï¼ŒObjectBox å¯¹å­˜å‚¨çš„æ•°æ®ç»´æŠ¤äº†ä¸€ä¸ªå…ƒæ¨¡åž‹(meta model)ã€‚æ­¤å…ƒæ¨¡åž‹å®žé™…ä¸Šç­‰ä»·äºŽ ObjectBox çš„ schema.å®ƒåŒ…å«äº†æ‰€æœ‰å±žæ€§çš„ç±»åž‹ã€indexes ç­‰.ä¸åŒä¹‹å¤„åœ¨äºŽ ObjectBox è¯•å›¾è‡ªåŠ¨ç®¡ç†è¯¥å…ƒæ¨¡åž‹.æŸäº›æƒ…å†µä¸‹ï¼Œè¿™éœ€è¦ä½ å¸®å¿™. Object çš„ IDs æ˜¯ @Id å®šä¹‰çš„ï¼Œè€Œ æ‰€æœ‰ entity ç±»åž‹çš„å®žä¾‹éƒ½ç»‘å®šä¸€ä¸ª meta model ID. JSON for consistent IDsObjectBox æŠŠä¸€éƒ¨åˆ†å…ƒæ¨¡åž‹ä¿å­˜åœ¨ JSON æ–‡ä»¶ä¸­.æ­¤æ–‡ä»¶åº”è¯¥é€šè¿‡ç‰ˆæœ¬æŽ§åˆ¶è½¯ä»¶ç®¡ç†,ä¸»è¦åŽŸå› æ˜¯ï¼šå®ƒå¯ä»¥ä¿è¯ å…ƒæ¨¡åž‹é‡Œçš„ IDs å’Œ UIDs è·¨è®¾å¤‡ä¸€è‡´.]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxé«˜çº§-5-æ›´æ–°æ•°æ®æ¨¡åž‹]]></title>
    <url>%2F2019%2F02%2F26%2FObjectBox%E9%AB%98%E7%BA%A7-5-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[ObjectBox å¤§å¤šæ•°æƒ…å†µä¸‹è‡ªåŠ¨ç®¡ç†æ•°æ®æ¨¡åž‹.å½“æ·»åŠ /åˆ é™¤ entities æˆ–å±žæ€§æ—¶ï¼ŒObjectBox è‡ªåŠ¨ä½œå‡ºå“åº”ã€‚å¯¹äºŽå…¶ä»–æ”¹å˜å¦‚ ä¿ç•™æˆ–æ”¹å˜ç±»åž‹ï¼ŒObjectBox éœ€è¦é¢å¤–ä¿¡æ¯ã€‚ UIDsObjectBox é€šè¿‡ unique IDs(UIDs) æ¥è¿½è¸ª entities å’Œå±žæ€§çš„å˜åŒ–ã€‚æ‰€æœ‰çš„ UIDs éƒ½å­˜å‚¨åœ¨ module-name/objectbox-models/default.json ä¸­,å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬æŽ§åˆ¶è½¯ä»¶(git)è¿›è¡Œç®¡ç†ã€‚ ç®€å•æ¥è¯´: ä¸ºäº†ä½¿ UID ç›¸å…³çš„æ”¹å˜ç”Ÿæ•ˆï¼Œåœ¨è¿™äº› entity æˆ– å±žæ€§ä¸Šæ”¾ç½® @Uid ç„¶åŽç¼–è¯‘ï¼Œåœ¨èŽ·å–è¿›ä¸€æ­¥æç¤ºã€‚ é‡å‘½å entities å’Œ å±žæ€§éœ€è¦ UID æ³¨è§£çš„åŽŸå› æ˜¯: å¦‚æžœä»…ä»…æ”¹å˜ entities å’Œå±žæ€§çš„åå­—ï¼ŒObjectBox åªä¼šæ„è¯†åˆ° old entity ä¸è§äº†ï¼Œè€Œåˆ›å»ºäº†æ–°çš„ entity.æ‰€ä»¥å‘Šè¯‰ ObjectBox é‡å‘½å entity å’Œæ•°æ®ï¼Œè€Œä¸æ˜¯ä¸¢å¼ƒå®ƒä»¬.å®ƒä»¬æ˜¯ç›¸åŒçš„ä¸€ä¸ª entityã€‚å®žé™…ä¸Šæ˜¯åœ¨å†…éƒ¨ç»™ entity ç»‘å®šä¸€ä¸ª UID.å±žæ€§ä¹Ÿä¸€æ ·. å®žè·µç¬¬ä¸€æ­¥: ä¸ºæƒ³è¦é‡å‘½åçš„ entity/å±žæ€§æ·»åŠ ç©ºçš„ @Uid æ³¨è§£ 123@Entity@Uidpublic class MyName &#123; ... &#125; ç¬¬äºŒæ­¥: ç¼–è¯‘é¡¹ç›®ï¼Œç„¶åŽä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼šç»™å‡ºå½“å‰ entity/å±žæ€§çš„ UID 123error: [ObjectBox] UID operations for entity "MyName": [Rename] apply the current UID using @Uid(6645479796472661392L) - [Change/reset] apply a new UID using @Uid(4385203238808477712L) ç¬¬ä¸‰éƒ¨: æŠŠä¸Šé¢çš„ UID å¤åˆ¶åˆ° @Uid() é‡Œ 123@Entity@Uid(6645479796472661392L)public class MyName &#123; ... &#125; ç¬¬å››æ­¥: é‡å‘½åå§ 123@Entity@Uid(6645479796472661392L)public class MyNewName &#123; ... &#125; æˆ–è€…å¯ä»¥åœ¨ default.json ä¸­æ‰¾åˆ° UID,ç„¶åŽç›´æŽ¥ä½¿ç”¨åˆ° @Uid() ä¸Šï¼Œé‡å‘½åå³å¯ ä¿®æ”¹å±žæ€§ç±»åž‹æƒ³è¦ä¿®æ”¹å±žæ€§ç±»åž‹ï¼Œé‚£ä¹ˆ ObjectBox å†…éƒ¨å¾—åˆ›å»ºä¸€ä¸ªæ–°ç±»åž‹ã€‚å› ä¸º ObjectBox ä¸ä¼šè¿ç§»æ•°æ®ã€‚ é‡å‘½åå±žæ€§ç±»åž‹ï¼šè¿™æ ·è¯¥å±žæ€§å°±ä¼šè¢«è®¤ä¸ºæ˜¯æ–°å±žæ€§(å¦‚æžœè¯¥å±žæ€§å·²ç»æœ‰ @Uid æ³¨è§£äº†ï¼Œåˆ™è¡Œä¸é€š) 1234// old:String year;// new:int yearInt; å‘Šè¯‰ ObjectBox å¯¹æ–°å±žæ€§ä½¿ç”¨æ–° UID. å®žè·µä¸€ä¸‹ç¬¬ä¸€æ­¥ï¼šå¯¹æƒ³ä¿®æ”¹ç±»åž‹çš„å±žæ€§æ·»åŠ  @Uid æ³¨è§£ 12@UidString year; ç¬¬äºŒæ­¥: ç¼–è¯‘èŽ·å–é”™è¯¯ä¿¡æ¯ 123error: [ObjectBox] UID operations for property "MyEntity.year": [Rename] apply the current UID using @Uid(6707341922395832766L) - [Change/reset] apply a new UID using @Uid(9204131405652381067L) ç¬¬ä¸‰æ­¥ï¼šä¸ºè¯¥å±žæ€§åº”ç”¨æ–° @Uid,å¹¶ä¿®æ”¹ç±»åž‹. 12@Uid(9204131405652381067L)int year;]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxé«˜çº§-4-entityç»§æ‰¿]]></title>
    <url>%2F2019%2F02%2F26%2FObjectBox%E9%AB%98%E7%BA%A7-4-entity%E7%BB%A7%E6%89%BF%2F</url>
    <content type="text"><![CDATA[ObjectBox å…è®¸å­ç±»ç»§æ‰¿ entity çˆ¶ç±»æŒä¹…åŒ–çš„å±žæ€§ã€‚åŒæ ·ä¹Ÿæ”¯æŒç»§æ‰¿éž entity ç±»ã€‚1.4+ ä¹Ÿæ”¯æŒå¤šç»§æ‰¿.å¯¹äºŽçˆ¶ç±»æ¥è¯´å¯ä»¥ä½¿ç”¨ @BaseEntity. æ— æ³¨è§£: ç±»æœ¬èº«åŠå…¶å±žæ€§ä¸éœ€è¦æŒä¹…åŒ– @BaseEntity: å±žæ€§åœ¨å­ç±»ä¸­æŒä¹…åŒ–ï¼Œç±»æœ¬èº«ä¸æŒä¹…åŒ– @Entity: å±žæ€§åœ¨å­ç±»ä¸­æŒä¹…åŒ–ï¼Œç±»æœ¬èº«ä¹ŸæŒä¹…åŒ– 123456789101112131415161718192021222324252627282930// base class:@BaseEntitypublic abstract class Base &#123; @Id long id; String baseString; public Base() &#123; &#125; public Base(long id, String baseString) &#123; this.id = id; this.baseString = baseString; &#125;&#125;// sub class:@Entitypublic class Sub extends Base &#123; String subString; public Sub() &#123; &#125; public Sub(long id, String baseString, String subString) &#123; super(id, baseString); this.subString = subString; &#125;&#125; 1234567891011121314// entities inherit properties from entities@Entitypublic class SubSub extends Sub &#123; String subSubString; public SubSub() &#123; &#125; public SubSub(long id, String baseString, String subString, String subSubString) &#123; super(id, baseString, subString); this.subSubString = subSubString; &#125;&#125; ä½¿ç”¨å‰æ³¨æ„ åœ¨ç»§æ‰¿é“¾ä¸­å¯èƒ½å­˜åœ¨ç”± @BaseEntity æ³¨è§£çš„ç±»ï¼Œå®ƒä»¬çš„å±žæ€§å°†è¢«å¿½ç•¥ï¼Œä¸ä¼šæˆä¸º entity model çš„ä¸€éƒ¨åˆ† ä¸æŽ¨èç»§æ‰¿ä¸€ä¸ªä»…å«æœ‰ ID å±žæ€§çš„ base entity ç±». æŸäº›æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ interface æ›´ç®€å•æ˜Žäº† é™åˆ¶ @BaseEntity æ³¨è§£çš„çˆ¶ç±»ä¸èƒ½æˆä¸º library çš„ä¸€éƒ¨åˆ†ã€‚ æ²¡æœ‰å¤šæ€æŸ¥è¯¢(ä¾‹å¦‚æŸ¥è¯¢çˆ¶ç±»å´å¸Œæœ›å¾—åˆ°å­ç±») å½“å‰æ— è®ºæ˜¯ @Entity è¿˜æ˜¯ @BaseEntity æ³¨è§£çš„çˆ¶ç±»ï¼Œéƒ½ä¸èƒ½ä½¿ç”¨ ToOne ToMany å…³è”]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxé«˜çº§-3-è‡ªå®šä¹‰ç±»åž‹]]></title>
    <url>%2F2019%2F02%2F26%2FObjectBox%E9%AB%98%E7%BA%A7-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[ObjectBox æ”¯æŒä»¥ä¸‹ç±»åž‹ï¼ˆJavaï¼‰: 1234567891011boolean, Booleanint, Integershort, Shortlong, Longfloat, Floatdouble, Doublebyte, Bytechar, Characterbyte[]StringDate è½¬æ¢å™¨æ³¨è§£å’Œå±žæ€§è½¬æ¢ä½¿ç”¨ @Convert æ³¨è§£å°†å…¶ä»–ç±»åž‹å±žæ€§è½¬ä¸ºå†…ç½®å±žæ€§ã€‚æ­¤å¤„éœ€è¦æä¾› PropertyConverter å®žçŽ°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839// enum è½¬ä¸º Integer@Entitypublic class User &#123; @Id private Long id; @Convert(converter = RoleConverter.class, dbType = Integer.class) private Role role; public enum Role &#123; DEFAULT(0), AUTHOR(1), ADMIN(2); final int id; Role(int id) &#123; this.id = id; &#125; &#125; public static class RoleConverter implements PropertyConverter&lt;Role, Integer&gt;; &#123; @Override public Role convertToEntityProperty(Integer databaseValue) &#123; if (databaseValue == null) &#123; return null; &#125; for (Role role : Role.values()) &#123; if (role.id == databaseValue) &#123; return role; &#125; &#125; return Role.DEFAULT; &#125; @Override public Integer convertToDatabaseValue(Role entityProperty) &#123; return entityProperty == null ? null : entityProperty.id; &#125; &#125;&#125; more å¦‚æžœæ˜¯åœ¨ entity ç±»ä¸­å®šä¹‰è‡ªå®šä¹‰è½¬æ¢å™¨ï¼Œé‚£ä¹ˆè¯¥è½¬æ¢å™¨åº”è¯¥ä¸º static. åˆ«å¿˜è®°æ­£ç¡®å¤„ç† null,é€šå¸¸å¦‚æžœ input æ˜¯ nullï¼Œä¹Ÿåº”è¿”å›ž null. æŽ¨èä½¿ç”¨åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œæ›´æ˜“è½¬æ¢. ç»å¯¹ä¸èƒ½åœ¨è½¬æ¢å™¨ä¸­è°ƒç”¨æ•°æ®åº“(Box,BoxStore),è½¬æ¢å™¨æ–¹æ³•åœ¨äº‹åŠ¡ä¸­è°ƒç”¨ï¼Œä¾‹å¦‚è¯»å–æˆ–å†™å…¥å¯¹è±¡åˆ° box ä¸­å°†ä¼šå¤±è´¥ã€‚ ä¸ºæé«˜æ€§èƒ½ï¼ŒObjectBox ä½¿ç”¨äº†å¯¹æ‰€æœ‰çš„è½¬æ¢å™¨ä½¿ç”¨äº†å”¯ä¸€ä¸€ä¸ªå®žä¾‹ã€‚è¯·ä¿è¯é™¤é»˜è®¤æ— å‚æž„é€ æ–¹æ³•å¤–æ²¡æœ‰è‡ªå®šä¹‰å…¶ä»–æž„é€ æ–¹æ³•ã€‚åŒæ—¶è¯·ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåº”ä¸ºåœ¨ multiple entities ä¸­å¯èƒ½æ¶‰åŠåˆ°å¹¶å‘. List/Array ç±»åž‹å¯ä»¥ä½¿ç”¨è½¬æ¢å™¨è½¬æ¢ List ç±»åž‹ã€‚ä¾‹å¦‚æŠŠ List è½¬ä¸ºä¸€æ¡ String çš„ JSON æ•°ç»„.å½“å‰ä¸æ”¯æŒ Array è½¬æ¢å™¨.æŸ¥çœ‹ç‰¹æ€§å®žçŽ°è¿›åº¦Array Enumsæœ€ä½³å®žè·µ: ä¸è¦æŒä¹…åŒ– enum çš„ ordinal æˆ– name: äºŒè€…éƒ½ä¸ç¨³å®šï¼Œä¸”åœ¨ä¸‹æ¬¡ä½ ä¿®æ”¹ enum å®šä¹‰æ—¶ä¼šæ”¹å˜ ä½¿ç”¨ç¨³å®šçš„ ids: åœ¨ enum ä¸­å®šä¹‰è‡ªå®šä¹‰å±žæ€§(integer,string) éƒ½å¯ä»¥ä¿è¯ç¨³å®šã€‚ä½¿ç”¨è¯¥ç‰¹æ€§ä½œä¸ºä½ çš„æŒä¹…åŒ–æ˜ å°„. å‡†å¤‡å¥½åº”å¯¹æœªçŸ¥: å®šä¹‰ä¸€ä¸ª UNKNOWN çš„ enmu å€¼ã€‚å¯ä»¥åº”å¯¹ null æˆ– unknown å€¼çš„æƒ…å†µã€‚ä¾‹å¦‚å¯ä»¥ç¡®ä¿å·²ç»è¢«ç§»é™¤çš„ enum å€¼ä¸ä¼šå¯¼è‡´ App å´©æºƒ. æŸ¥è¯¢æ—¶çš„è‡ªå®šä¹‰ç±»åž‹QueryBuilder æ˜¯ä¸å…³å¿ƒè‡ªå®šç±»åž‹çš„ã€‚è¯·ä½¿ç”¨å†…ç½®ç±»åž‹æŸ¥è¯¢ã€‚]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxé«˜çº§-2-Object IDs]]></title>
    <url>%2F2019%2F02%2F26%2FObjectBox%E9%AB%98%E7%BA%A7-2-Object-IDs%2F</url>
    <content type="text"><![CDATA[Object å¿…é¡»å…·æœ‰ä¸€ä¸ªç±»åž‹ä¸º long çš„å±žæ€§.å½“ç„¶å¯ä»¥ä½¿ç”¨å®ƒçš„åŒ…è£…ç±» java.lang.Long,ä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨åŒ…è£…ç±».å…¶ä»–ç±»åž‹çš„ ID ( UID ç­‰)å¯ä»¥è‡ªç”±å®šä¹‰ï¼ŒæŸ¥è¯¢ç­‰æ“ä½œã€‚ news vs. persisted entitieså½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¿˜æ²¡æœ‰å­˜å…¥ï¼Œå®ƒä»¬çš„ ID æ˜¯ 0.ä¸€æ—¦è¯¥å¯¹è±¡å­˜å…¥ï¼ŒObjectBox å°†ä¸ºè¯¥å¯¹è±¡æŒ‡å®š ID.å¯ä»¥é€šè¿‡ put()è¿”å›žå€¼æ‹¿åˆ°è¯¥ ID. æ‰€ä»¥åœ¨ ObjectBox å†…éƒ¨é€šå¸¸æŠŠ ID ä½œä¸ºä¸€ä¸ªçŠ¶æ€æŒ‡ç¤ºå™¨,å¦‚æžœä¸º 0 è¡¨ç¤ºæ–°åˆ›å»ºï¼Œä¸ä¸º 0 è¡¨ç¤ºå·²ç»å­˜å‚¨ã€‚å…³è”ç‰¹åˆ«ä¾èµ–è¿™ä¸ªç‰¹æ€§. ç‰¹æ®Šçš„ Object IDsObject IDs å¯èƒ½æ˜¯ä»»æ„ long å€¼ï¼Œé™¤äº†ä»¥ä¸‹ä¸¤ç§: 0: æˆ–è€…å½“ç±»åž‹ä¸º Long æ—¶ä¸º null,è¢«è®¤ä¸ºæ˜¯æ–°åˆ›å»ºï¼Œè¿˜æœªå­˜å‚¨ã€‚putè¿™ä¸ªå¯¹è±¡æ€»æ˜¯ä¼šæ’å…¥ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªæœªä½¿ç”¨è¿‡çš„ ID. 0xFFFFFFFFFFFFFFFF (-1 in Java): ObjectBox ä¿ç•™ã€‚ ObjectBox æŒ‡å®š IDå¯¹äºŽæ¯ä¸€ä¸ªæ–°å¯¹è±¡ï¼ŒObjectBox æŠŠæ¯”å½“å‰ box ä¸­æœ€å¤§çš„ ID å€¼å¤§çš„æœªä½¿ç”¨çš„å€¼æŒ‡å®šç»™æ–°å¯¹è±¡çš„ ID.æ¯”å¦‚ box ä¸­æœ‰ä¸€ä¸ª ID ä¸º 1 å’Œ ID ä¸º 100 çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ–°åˆ›å»ºå¯¹è±¡çš„ ID å°†ä¸º 101. é»˜è®¤åªæœ‰ ObjectBox å¯ä»¥æŒ‡å®š ID(ðŸ‘‡ ä»‹ç»).å¦‚æžœè¯•å›¾è‡ªå·±å­˜å…¥ä¸€ä¸ª ID æ¯”å½“å‰ ID å€¼æœ€å¤§çš„è¿˜å¤§çš„å¯¹è±¡ï¼ŒObjectBox å°†æŠ›å‡ºé”™è¯¯ã€‚ æ‰‹åŠ¨æŒ‡å®š IDså¦‚æžœéœ€è¦æ‰‹åŠ¨æŒ‡å®š ID,é‚£ä¹ˆè¯·æ·»åŠ å¦‚ä¸‹æ³¨è§£: 12@Id(assignable = true)long id; è¿™å°†ä¼šå…è®¸å­˜å…¥ä»»æ„å€¼ ID çš„å¯¹è±¡ã€‚å½“ç„¶è®¾ç½® ID ä¸º 0 æ—¶ï¼ŒObjectBox å°†åˆ¶å®šæ–° ID è‡ªå®šä¹‰ ID ä¼šæ‰“ç ´è‡ªåŠ¨çŠ¶æ€æŒ‡ç¤ºç›‘è§†(new vs. persisted). æ‰€ä»¥åº”è¯¥ç«‹å³å­˜å…¥è¯¥è‡ªå®šä¹‰ ID å¯¹è±¡ï¼Œå¯èƒ½è¿˜å¾—æ‰‹åŠ¨ç»‘å®š boxï¼Œç‰¹åˆ«åœ¨å…³è”çŠ¶å†µä¸‹. ID çš„ String åˆ«å (è¿˜åœ¨è·¯ä¸Šâ€¦)æŸ¥çœ‹ç‰¹æ€§å®žçŽ°è¿›åº¦String ID alias]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxé«˜çº§-1-é…ç½®]]></title>
    <url>%2F2019%2F02%2F26%2FObjectBox%E9%AB%98%E7%BA%A7-1-%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[æ‰‹åŠ¨æ·»åŠ ä¾èµ–åº“å¦‚æžœ ObjectBox æ’ä»¶æ²¡æœ‰è‡ªåŠ¨æ·»åŠ ä¾èµ–åº“å’Œæ³¨è§£å¤„ç†å™¨ï¼Œé‚£ä¹ˆæ‰‹åŠ¨æ·»åŠ ã€‚ 12345dependencies &#123; // all below should be added automatically by the plugin compile "io.objectbox:objectbox-android:$objectboxVersion" annotationProcessor "io.objectbox:objectbox-processor:$objectboxVersion"&#125; 1234567dependencies &#123; // all below should be added automatically by the plugin compile "io.objectbox:objectbox-android:$objectboxVersion" kapt "io.objectbox:objectbox-processor:$objectboxVersion" // some useful Kotlin extension functions compile "io.objectbox:objectbox-kotlin:$objectboxVersion"&#125; æ”¹å˜ model æ–‡ä»¶ä½ç½®é»˜è®¤ model æ–‡ä»¶ä½äºŽ module-name/objectbox-models/default.json. 123456789android &#123; defaultConfig &#123; javaCompileOptions &#123; annotationProcessorOptions &#123; arguments = [ "objectbox.modelPath" : "$projectDir/schemas/objectbox.json".toString() ] &#125; &#125; &#125;&#125; 12345kapt &#123; arguments &#123; arg("objectbox.modelPath", "$projectDir/schemas/objectbox.json") &#125;&#125; æ”¹å˜ MyObjectBox çš„åŒ…åé»˜è®¤ MyObjectBox ç±»åŒ…åå’Œ entity ç±»æˆ–å…¶çˆ¶ç±»çš„åŒ…åç›¸åŒ. 123456789android &#123; defaultConfig &#123; javaCompileOptions &#123; annotationProcessorOptions &#123; arguments = [ "objectbox.myObjectBoxPackage" : "com.example.custom" ] &#125; &#125; &#125;&#125; 12345kapt &#123; arguments &#123; arg("objectbox.myObjectBoxPackage", "com.example.custom") &#125;&#125; å¼€å¯ debug æ¨¡å¼123456789android &#123; defaultConfig &#123; javaCompileOptions &#123; annotationProcessorOptions &#123; arguments = [ 'objectbox.debug' : 'true' ] &#125; &#125; &#125;&#125; 12345kapt &#123; arguments &#123; arg("objectbox.debug", true) &#125;&#125; greenDAO å…¼å®¹æŸ¥çœ‹greenDAO å…¼å®¹é…ç½®]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-12-äº‹åŠ¡]]></title>
    <url>%2F2019%2F02%2F26%2FObjectBox%E5%85%A5%E9%97%A8-12-%E4%BA%8B%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[ObjectBox æ˜¯ä¸€ä¸ªæ»¡è¶³ ACID ç‰¹æ€§çš„äº¤æ˜“åž‹æ•°æ®åº“.ä¸€ä¸ªäº‹åŠ¡å¯ä»¥åŒ…å«ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆæ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚å‡ ä¹Žæ‰€æœ‰çš„ ObjectBox çš„æ“ä½œéƒ½åŒ…å«äº†äº‹åŠ¡ã€‚æ¯”å¦‚ put(),read()ã€‚æ™®é€šæƒ…å†µä¸‹ï¼Œä¸ç”¨å…³å¿ƒè¿™äº›åº•å±‚çš„äº‹åŠ¡ã€‚ä½†æŸäº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨å¤„ç†äº‹åŠ¡æ“ä½œå¯ä»¥ä½¿ä½ çš„ app æ›´åŠ é«˜æ•ˆä¸€è‡´ã€‚ æ‰‹åŠ¨äº‹åŠ¡ObjectBox æä¾›äº†å¦‚ä¸‹æ–¹æ³•å®žçŽ°æ‰‹åŠ¨äº‹åŠ¡ï¼š runInTx: åœ¨äº‹åŠ¡ä¸­è¿è¡ŒæŒ‡å®šçš„ runnable runInReadTx: åœ¨ä¸€ä¸ªåªè¯»çš„äº‹åŠ¡ä¸­è¿è¡ŒæŒ‡å®šçš„ runnable.ä¸åŒäºŽå†™å…¥äº‹åŠ¡ï¼Œå¤šä¸ªåªè¯»äº‹åŠ¡å¯ä»¥åŒæ—¶è¿è¡Œã€‚ runInTxAsync: åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡ŒæŒ‡å®šçš„ runnable.ä¸€æ—¦äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œcallback(å¯ä¸º null) å°†è¢«è°ƒç”¨. callInTx: ç±»ä¼¼ runInTx(Runnable),ä½†æ˜¯æœ‰è¿”å›žå€¼æˆ–æŠ›å‡ºå¼‚å¸¸. å¯¹æ‰¹é‡å­˜å…¥æ“ä½œè¿›è¡Œæ‰‹åŠ¨äº‹åŠ¡çš„ä¼˜åŠ¿æ˜¯ä½ å¯ä»¥å®žçŽ°ä»»æ„æ•°é‡çš„æ“ä½œï¼Œä½¿ç”¨å¤šä¸ª box å¯¹è±¡ã€‚åŒæ—¶ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å¯¹æ•°æ®æœ‰ä¸€ä¸ªç›´è§‚çš„è®¤çŸ¥ã€‚ 1234567// å†™å…¥äº‹åŠ¡boxStore.runInTx(() -&gt; &#123; for (User user: allUsers) &#123; if (modify(user)) box.put(user); else box.remove(user); &#125;&#125;) äº‹åŠ¡ä»£ä»·ç†è§£äº‹åŠ¡å¯ä»¥å¾ˆå¥½çš„å¸®åŠ©æŽŒæ¡æ•°æ®åº“æ€§èƒ½ã€‚è¯·æ³¨æ„: å†™å…¥äº‹åŠ¡ä»£ä»·å¤§.æäº¤äº‹åŠ¡åŒ…å«äº†å°†æ•°æ®åŒæ­¥åˆ°ç‰©ç†å­˜å‚¨ä¸­çš„æ“ä½œï¼Œè¿™å¯¹æ•°æ®åº“æ˜¯ä¸€ä¸ªç›¸å¯¹æ˜‚è´µçš„æ“ä½œã€‚åªæœ‰æ–‡ä»¶ç³»ç»Ÿç¡®è®¤æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨ï¼Œäº‹åŠ¡æ“ä½œæ‰ä¼šè¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚äº‹åŠ¡åŒæ­¥è¯¥æ–‡ä»¶å¯èƒ½éœ€è¦å‡ æ¯«ç§’ã€‚è¯·è®°ä½ï¼šå°½é‡æŠŠå¤šä¸ªæ“ä½œ(put ç­‰)æ”¾å…¥åŒä¸€ä¸ªäº‹åŠ¡ä¸­. 12345678910// ä¸æŽ¨èfor(User user: allUsers) &#123; modify(user); // modifies properties of given user box.put(user);&#125;// æŽ¨èfor(User user: allUsers) &#123; modify(user); // modifies properties of given user&#125;box.put(allUsers); è¯»å–äº‹åŠ¡ObjectBox çš„è¯»å–äº‹åŠ¡å¾ˆå¿«ã€‚ç›¸å¯¹äºŽå†™å…¥äº‹åŠ¡ï¼Œæ²¡æœ‰ commit æ“ä½œï¼Œæ‰€ä»¥æ²¡æœ‰æ˜‚è´µçš„åŒæ­¥æ–‡ä»¶ç³»ç»Ÿã€‚è¯·æ³¨æ„ï¼šåœ¨ä¸€ä¸ªè¯»å–äº‹åŠ¡ä¸­ put æ“ä½œæ˜¯éžæ³•çš„ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚get,count,queries ç­‰æ“ä½œæ²¡æœ‰æ‰‹åŠ¨å£°æ˜Žäº‹åŠ¡(è¯»å†™),é»˜è®¤ä¼šè¿è¡Œåœ¨ä¸€ä¸ªè¯»å–äº‹åŠ¡.è™½ç„¶è¯»å–äº‹åŠ¡æ¯”å†™å…¥äº‹åŠ¡ä»£ä»·å°ï¼Œä½†æ˜¯è¿˜æ˜¯æœ€å¥½æŠŠå®ƒæ”¾å…¥è¯»å–äº‹åŠ¡ä¸­ã€‚ å¤šç‰ˆæœ¬çš„å¹¶å‘ObjectBox æä¾›äº†è¯­ä¹‰åŒ–çš„å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶(Multiversion concurrency control MVCC).å¤šä¸ªå¹¶å‘è¯»å–(è¯»å–äº‹åŠ¡)å¯ä»¥ç«‹å³æ‰§è¡Œï¼Œæ— éœ€é˜»å¡žæˆ–ç­‰å¾…ã€‚è¿™æ˜¯é€šè¿‡å­˜å‚¨å¤šä¸ªç‰ˆæœ¬çš„ï¼ˆæäº¤ï¼‰æ•°æ®æ¥å®žçŽ°çš„ã€‚å³ä¾¿ä¸€ä¸ªå†™å…¥äº‹åŠ¡æ­£åœ¨è¿è¡Œï¼Œè¯»å–äº‹åŠ¡ä¹Ÿå¯ä»¥ç«‹å³èŽ·å–åˆ°æœ€æ–°çš„åŒæ­¥çŠ¶æ€ã€‚å†™å…¥äº‹åŠ¡æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¾¿çŠ¶æ€ä¸€è‡´ã€‚æ‰€ä»¥ä¿è¯å†™å…¥äº‹åŠ¡çŸ­å°å¯ä»¥é¿å…é˜»å¡žå…¶ä»–å†™å…¥äº‹åŠ¡ã€‚å› æ­¤åœ¨ä¸€ä¸ªå†™å…¥äº‹åŠ¡ä¸­æ‰§è¡Œç½‘ç»œæ“ä½œæˆ–å¤æ‚è®¡ç®—ä¸æŽ¨èã€‚å°½é‡åœ¨å†™å…¥äº‹åŠ¡å‰å®Œæˆè¿™äº›æ“ä½œã€‚ æ³¨æ„ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨ç»´æŒå†™å…¥äº‹åŠ¡åºåˆ—ã€‚å¦‚æžœå¤šçº¿ç¨‹æƒ³åŒæ—¶æ‰§è¡Œå†™å…¥äº‹åŠ¡(put,runInTx),åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œï¼Œå…¶ä»–å¿…é¡»ç­‰å¾…ã€‚ç±»ä¼¼ Java ä¸­çš„ lock æˆ– synchronizedã€‚ æ·±å…¥å†™å…¥äº‹åŠ¡å°½é‡é¿å…åœ¨å†™å…¥äº‹åŠ¡ä¸­ä½¿ç”¨é”(synchronized æˆ– java.util.concurrent.locks).å› ä¸ºå†™å…¥äº‹åŠ¡è¿è¡Œè´¹æ—¶ï¼Œæ‰€ä»¥ ObjectBox å†…éƒ¨ä¼šèŽ·å–ä¸€ä¸ªå†™å…¥é”ã€‚å½“è®¾è®¡å¤šä¸ªé”æ—¶ï¼Œè¯·æé«˜è­¦æƒ•ã€‚å§‹ç»ˆä»¥ç›¸åŒçš„é¡ºåºèŽ·å–é”å¯ä»¥é¿å…æ­»é”ã€‚å¦‚æžœåœ¨ä¸€ä¸ªäº‹åŠ¡èŽ·å–äº† X é”ï¼Œè¯·ä¿è¯ä½ çš„ä»£ç åœ¨æŒæœ‰ X é”æ—¶æ²¡æœ‰åœ¨å¦å¤–ä¸€ä¸ªå†™å…¥äº‹åŠ¡ä¸­æ‰§è¡Œ.]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-11-Data Browser]]></title>
    <url>%2F2019%2F02%2F26%2FObjectBox%E5%85%A5%E9%97%A8-11-Data-Browser%2F</url>
    <content type="text"><![CDATA[Data Browser å…·æœ‰å¦‚ä¸‹åŠŸèƒ½: æŸ¥çœ‹æ•°æ®åº“çš„ entities å’Œ schema ä¸‹è½½ JSON æ ¼å¼çš„ entities é…ç½®1234567dependencies &#123; debugImplementation "io.objectbox:objectbox-android-objectbrowser:$objectboxVersion" releaseImplementation "io.objectbox:objectbox-android:$objectboxVersion"&#125;// apply the plugin after the dependencies blockapply plugin: 'io.objectbox' ä¸è¿™æ ·è®¾ç½®å¯èƒ½å‡ºçŽ° Duplicate files copied in APK lib/armeabi-v7a/libobjectbox.so è¿™æ ·çš„é”™è¯¯.å› ä¸º ObjectBox æ’ä»¶åˆæ·»åŠ äº†ä¸€æ¬¡ objectbox-android åº“ åœ¨ AndroidManifest.xml æ·»åŠ å¦‚ä¸‹æƒé™(2.2.0 åŽéœ€è¦) 1234&lt;!-- Required to provide the web interface --&gt;&lt;uses-permission android:name="android.permission.INTERNET" /&gt;&lt;!-- Required to run keep-alive service when targeting API 28 or higher --&gt;&lt;uses-permission android:name="android.permission.FOREGROUND_SERVICE"/&gt; å»ºè®®åœ¨ Application ç±»ä¸­æ·»åŠ  12345boxStore = MyObjectBox.builder().androidContext(this).build();if (BuildConfig.DEBUG) &#123; boolean started = new AndroidObjectBrowser(boxStore).start(this); Log.i("ObjectBrowser", "Started: " + started);&#125;]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-10-å…³è”]]></title>
    <url>%2F2019%2F02%2F25%2FObjectBox%E5%85%A5%E9%97%A8-10-%E5%85%B3%E8%81%94%2F</url>
    <content type="text"><![CDATA[Object ä¹‹é—´çš„å…³è”å…·æœ‰æ–¹å‘æ€§.å…³è”æ˜¯å»¶è¿Ÿåˆå§‹åŒ–çš„ï¼šå®žé™…çš„å¼•ç”¨å¯¹è±¡åªæœ‰åœ¨è°ƒç”¨æ—¶æ‰ä¼šä»Žæ•°æ®åº“ä¸­åŠ è½½ã€‚ä¸€æ—¦åŠ è½½è¿‡ï¼Œå°±ä¼šç¼“å­˜èµ·æ¥. To-One å…³è”ä½¿ç”¨ ToOne ä¼šæ™ºèƒ½çš„å¯¹ç›®æ ‡å¯¹è±¡åˆ›å»ºå…³è”ã€‚åŒæ—¶èŽ·å–ç›®æ ‡å¯¹è±¡ç¼“å­˜ã€‚ 12345678910111213141516// Customer.java@Entitypublic class Customer &#123; @Id public long id;&#125;// Order.java@Entitypublic class Order &#123; @Id public long id; public ToOne&lt;Customer&gt; customer;&#125;// ä¸ºäº†ç»‘å®š customer å¯¹è±¡ï¼Œå¯¹ ToOne å®žä¾‹è°ƒç”¨ setTarget() ç„¶åŽå°±å­˜å…¥ order å¯¹è±¡Customer customer = new Customer();Order order = new Order();order.customer.setTarget(customer);long orderId = boxStore.boxFor(Order.class).put(order); å¦‚æžœ customer åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼ŒToOne å°†ä¼šå­˜å‚¨ã€‚å¦‚æžœå·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆ ToOne åªä¼šåˆ›å»ºå…³è”,ä¸ä¼šå­˜å‚¨.å¦‚æžœå…³è” Entity ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰ IDs(@Id(assignable = true)),åˆ™è¯¥ Entity ä¸ä¼šè¢«å­˜å‚¨. åœ¨ ToOne å®žä¾‹ä¸­ï¼Œå¯é€šè¿‡ Order å¯¹è±¡çš„ getTarget() èŽ·å– customer 12Order order = boxStore.boxFor(Order.class).get(orderId);Customer customer = order.customer.getTarget(customer); å¦‚æžœåªæ˜¯æƒ³è¦èŽ·å– ID è€Œä¸æ˜¯æ•´ä¸ªç›®æ ‡å¯¹è±¡ï¼ŒgetTargetId() å€¼å¾—æ‹¥æœ‰ï¼Œæ­¤æ–¹æ³•æ ¹æœ¬ä¸ä¼šæŽ¥è§¦æ•°æ®åº“ï¼Œæ‰€ä»¥é«˜æ•ˆã€‚ ç§»é™¤å…³è”: ä»…ç§»é™¤å…³è”å…³ç³»ï¼Œè€Œä¸ä¼šä»Žæ•°æ®åº“ä¸­ç§»é™¤ç›®æ ‡å¯¹è±¡ã€‚ 12order.customer.setTarget(null);boxStore.boxFor(Order.class).put(order); æŸ¥çœ‹ objectbox-models/default.json ä¼šå‘çŽ°ï¼ŒToOne å±žæ€§æ ¹æœ¬æ²¡æœ‰ä¿å­˜ã€‚ä»…ä»…åªæ˜¯ç›®æ ‡å¯¹è±¡çš„ ID ä¿å­˜åœ¨ä¸€ä¸ªåç§°å’Œ ToOne å±žæ€§åŽæ‹¼æŽ¥ Id çš„è™šæ‹Ÿå±žæ€§. åˆå§‹åŒ–é­”æœ¯æ³¨æ„åˆ° ToOne å±žæ€§ customer ä»Žæ²¡åˆå§‹åŒ–ï¼Œç„¶è€Œè°ƒç”¨æ—¶å´ä¸ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å› ä¸ºè¯¥åˆå§‹åŒ–å·²ç»æ‰§è¡Œè¿‡äº†ã€‚ObjectBox æ’ä»¶ä¼šå¯¹ entity ç±»(ä»…æ”¯æŒçº¯ Java é¡¹ç›®å’Œ Android é¡¹ç›®) åœ¨è°ƒç”¨å‰æ­£ç¡®çš„åˆå§‹åŒ–ã€‚æ‰€ä»¥åœ¨è‡ªå®šä¹‰æž„é€ æ–¹æ³•æ—¶ï¼Œä½ å¯ä»¥å‡è®¾ ToOne/ToMany/List å±žæ€§å·²ç»åˆå§‹åŒ–è¿‡äº†ã€‚ 1234567891011121314@Entitypublic class Example &#123; ToOne&lt;Order&gt; order; ToMany&lt;Order&gt; orders; transient BoxStore __boxStore; public Example() &#123; // this.order = new ToOne&lt;&gt;(this, Example_.order); this.orders = new ToMany&lt;&gt;(this, Example_.orders); &#125; public Example(String value) &#123; this(); &#125;&#125; æå‡æ€§èƒ½ä¸ºäº†æé«˜æ€§èƒ½ï¼Œè¯·æä¾›å…¨å‚æ•°æž„é€ æ–¹æ³•ã€‚å¯¹äºŽ ToOne å±žæ€§ï¼Œè¯·æ·»åŠ ä¸€ä¸ªåä¸º ToOne å±žæ€§ååŠ  Id çš„ id å‚æ•°ã€‚å¯ä»¥å‚è€ƒ objectbox-models/default.json é‡Œçš„å‘½å. 12345678910@Entitypublic class Order &#123; @Id public long id; public ToOne&lt;Customer&gt; customer; public Order() &#123; /* default constructor */ &#125; public Order(long id, long customerId /* virtual ToOne id property */) &#123; this.id = id; this.customer.setTargetId(customerId); &#125;&#125; ToMany å…³è”å¯ä»¥ä½¿ç”¨ List æˆ– ToMany ç±»åž‹å®žçŽ° ToMany å…³è”.ç›¸å¯¹ ToOne æ¥è¯´ï¼ŒToMany å¯ä»¥å®žçŽ°è¿½è¸ªæ•°æ®å˜åŒ–å¹¶å°†å…¶å†™å…¥æ“ä½œä¸­ï¼Œè€Œ List å¿…é¡»è‡ªå·±å®žçŽ°. 1:N ä½¿ç”¨ @Backlink æ³¨è§£ 1:N å…³è”å±žæ€§ã€‚ 123456789101112131415161718192021222324252627282930313233343536// Customer.java@Entitypublic class Customer &#123; @Id public long id; // 'to' is optional if only one relation matches @Backlink(to = "customer") public ToMany&lt;Order&gt; orders;&#125;// Order.java@Entitypublic class Order &#123; @Id public long id; public ToOne&lt;Customer&gt; customer;&#125;Customer customer = new Customer();customer.orders.add(new Order());customer.orders.add(new Order());long customerId = boxStore.boxFor(Customer.class).put(customer); // puts customer and ordersCustomer customer = boxStore.boxFor(Customer.class).get(customerId);for (Order order : customer.orders) &#123; // TODO&#125;Order order = customer.orders.remove(0);boxStore.boxFor(Customer.class).put(customer);// optional: also remove the order from its box// boxStore.boxFor(Order.class).remove(order); N:N 12345678910111213141516171819202122232425262728293031323334353637383940// Teacher.java@Entitypublic class Teacher&#123; @Id public long id;&#125;// Student.java@Entitypublic class Student&#123; @Id public long id; public ToMany&lt;Teacher&gt; teachers;&#125;Teacher teacher1 = new Teacher();Teacher teacher2 = new Teacher();Student student1 = new Student();student1.teachers.add(teacher1);student1.teachers.add(teacher2);Student student2 = new Student();student2.teachers.add(teacher2);// puts students and teachersboxStore.boxFor(Student.class).put(student1, student2);Student student1 = boxStore.boxFor(Student.class).get(student1.id);for (Teacher teacher : student1.teachers) &#123; // TODO&#125;student1.teachers.remove(0);// boxStore.boxFor(Student.class).put(student1);// more efficient than using put:student1.teachers.applyChangesToDb(); ä¸Šé¢å¯ä»¥é€šè¿‡ student çŸ¥é“ teacher çš„ä¿¡æ¯ï¼Œå½“ç„¶å¯ä»¥åè¿‡æ¥ 1234567891011121314151617181920// Teacher.java@Entitypublic class Teacher&#123; @Id public long id; @Backlink(to = "teachers") // backed by the to-many relation in Student public ToMany&lt;Student&gt; students;&#125;// Student.java@Entitypublic class Student&#123; @Id public long id; public ToMany&lt;Teacher&gt; teachers;&#125; æ›´æ–°å…³è”ToOne å’Œ ToMany å¯ä»¥è¿½è¸ªå˜åŒ–ï¼ˆåªè¦å­˜å…¥æ‹¥æœ‰å…³è”å±žæ€§çš„ entityï¼‰å¹¶å°†å…¶å­˜å…¥æ•°æ®åº“ä¸­ï¼Œå¦‚æžœ ID != 0 æˆ–è€… @Id(assignable = true) é‚£ä¹ˆå¯ä»¥é€šè¿‡ Box æ¥æ›´æ–°å…³è” 1234567// update a related entity using its boxOrder orderToUpdate = customer.orders.get(0);orderToUpdate.text = "Revised description";// DOES NOT WORK// boxStore.boxFor(Customer.class).put(customer);// WORKSboxStore.boxFor(Order.class).put(orderToUpdate); æ›´æ–° ToOneToOne ç±»æä¾›äº†å¦‚ä¸‹æ–¹æ³•æ›´æ–°å…³è”: setTarget(entity): åˆ›å»ºå…³è”ï¼›ä¼ å…¥ null æ¸…é™¤å…³è” setTargetId(entityId): å¯¹å­˜åœ¨çš„ç›®æ ‡ entity åˆ›å»ºå…³è”ï¼›ä¼ å…¥ 0 æ¸…é™¤å…³è”. setAndPutTarget(entity): 12order.customer.setTarget(customer); // or order.customer.setCustomerId(customer.getId());orderBox.put(order); å¦‚æžœ entity åœ¨è°ƒç”¨ setAndPutTarget() ä¹‹å‰è¿˜æ²¡å­˜å‚¨,é‚£ä¹ˆéœ€è¦å…ˆç»‘å®šå®ƒçš„ box 123Order order = new Order(); // new entityorderBox.attach(order); // need to attach box firstorder.customer.setAndPutTarget(customer); å¦‚æžœç›®æ ‡ entity ä½¿ç”¨è‡ªå®šä¹‰ IDs,å¿…é¡»åœ¨æ›´æ–° ToOne å…³è”æ—¶å­˜å‚¨å®ƒ 1234customer.id = 12; // self-assigned idcustomerBox.put(customer); // need to put customer firstorder.customer.setTarget(customer); // or order.customer.setCustomerId(customer.getId());orderBox.put(order); è¿™æ˜¯å› ä¸º ObjectBox åªä¿å­˜ id ä¸º 0 çš„å…³è”å¯¹è±¡. æ›´æ–° ToManyToMany å®žçŽ°äº† java.lang.List æŽ¥å£ã€‚å¦‚æžœå‘ ToMany å®žä¾‹æ·»åŠ å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°±ä¼šè¢«å­˜å‚¨è¿›æ•°æ®åº“ã€‚ç§»é™¤ä¹Ÿä¸€æ ·ã€‚ï¼ˆä»…ä»…æ˜¯å…³è”è¢«ç§»é™¤è€Œå·²ï¼‰.ä¸è¦å¿˜è®°æŠŠè¿½è¸ª ToMany æ”¹å˜çš„ own entity å¯¹è±¡å­˜å‚¨. 123customer.orders.add(order1);customer.orders.remove(order2);customerBox.put(customer); å¦‚æžœä½¿ç”¨è‡ªå®šä¹‰ IDs(@Id(assignable = true)) è¯·åœ¨ä¿®æ”¹ ToMany å‰ç»‘å®šå®ƒçš„ box 1234customer.id = 12; // self-assigned idcustomerBox.attach(customer); // need to attach box firstcustomer.orders.add(order);customerBox.put(customer); å¦‚æžœ entity æ˜¯è‡ªå®šä¹‰ IDs,é‚£ä¹ˆéœ€è¦å…ˆå­˜å…¥è¯¥ entity,ç„¶åŽå†æ›´æ–°å…³è”å¹¶å­˜å‚¨ own entity. 1234order.id = 42; // self-assigned idorderBox.put(order); // need to put order firstcustomer.orders.add(order);customerBox.put(customer); // put customer, add relation to order æ ‘å½¢å…³è”å¯ä»¥ä½¿ç”¨ ToOne,ToMany å¤„ç†æŒ‡å‘è‡ªèº«çš„æ ‘å½¢å…³è” 123456789@Entitypublic class TreeNode &#123; @Id long id; ToOne&lt;TreeNode&gt; parent; @BackLink ToMany&lt;TreeNode&gt; children;&#125; ç”Ÿæˆçš„ entity å¯ä»¥èŽ·å–å®ƒçš„ parent å’Œ children 12TreeNode parent = entity.parent.getTarget();List&lt;TreeNode&gt; children = entity.children;]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-9-è®¢é˜…è§‚å¯Ÿ]]></title>
    <url>%2F2019%2F02%2F25%2FObjectBox%E5%85%A5%E9%97%A8-9-%E8%AE%A2%E9%98%85%E8%A7%82%E5%AF%9F%2F</url>
    <content type="text"><![CDATA[Data Observers, Reactive Extensionsè®¢é˜…è§‚å¯Ÿæ¨¡å¼ï¼ŒRx æ”¯æŒ 1234Query&lt;Task&gt; query = taskBox.query().equal(Task_.complete,false).build();query.subscribe(subscriptions) .on(AndroidScheduler.mainThread()) .observer(data -&gt; updateUi(data)); Data Observerså½“æ•°æ®æ”¹å˜æ—¶ï¼ŒObjectBox ä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€….ä»–ä»¬å¯ä»¥è®¢é˜…ç¡®å®šçš„æ•°æ®ç±»åž‹(é€šè¿‡ BoxStore)æˆ–æŸ¥è¯¢ç»“æžœé›†ã€‚å®žçŽ° io.objectbox.reactive.DataObserver å³å¯åˆ›å»ºè§‚å¯Ÿè€… 1234interface DataObserver&lt;T&gt; &#123; void onData(T data);&#125;| onData() å¼‚æ­¥è°ƒç”¨ï¼Œä¸ç”¨å…³å¿ƒçº¿ç¨‹ è®¢é˜…æ™®é€šæ”¹å˜123456DataObserver&lt;Class&lt;Task&gt;&gt; taskObserver = new DataObserver&lt;Class&lt;Task&gt;&gt;() &#123; @Override public void onData(Class&lt;Note&gt; data)&#123;&#125;&#125;;boxStore.subscribe(Task.class).observer(taskObserver);| subscribe() ä¼šæŽ¥å—æ‰€æœ‰å¯ç”¨çš„å¯¹è±¡ç±»åž‹æ”¹å˜é€šçŸ¥ã€‚ è®¢é˜…æŸ¥è¯¢12Query&lt;Task&gt; query = taskBox.query().equal(Task_.completed, false).build();subscription = query.subscribe().observer(data -&gt; updateUi(data)); å–æ¶ˆè®¢é˜…å½“è°ƒç”¨ observer() æ—¶ï¼Œè¿”å›ž io.objectbox.reactive.DataSubscription 1234interface DataSubscription &#123; void cancel(); boolean isCanceled();&#125; 1234DataSubscription subscription = boxStore.subscribe().observer(myObserver);// At some later point:subscription.cancel(); é€šå¸¸æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨ DataSubscriptionList 123456789101112private DataSubscriptionList subscriptions = new DataSubscriptionList();protected void onStart() &#123; super.onStart(); Query&lt;X&gt; query = box.query()... .build(); query.subscribe(subscriptions)... .observe(...);&#125;protected void onStop() &#123; super.onStop(); subscriptions.cancel();&#125; è®¢é˜…ï¼Œäº‹åŠ¡å½“äº‹åŠ¡æäº¤æ—¶å‘å‡ºè®¢é˜…é€šçŸ¥ã€‚å•ç‹¬è°ƒç”¨box.put(),remove() ï¼Œé»˜è®¤çš„äº‹åŠ¡ä¼šå¼€å¯æäº¤ã€‚ä¾‹å¦‚å¦‚ä¸‹å°†è§¦å‘ä¸¤æ¬¡ User.class é€šçŸ¥ï¼› 12box.put(firendUser);box.put(myUser); ä½¿ç”¨ runInTx(),callInTx() å¯ä»¥å°†å¤šä¸ªæ“ä½œåœ¨åŒä¸€ä¸ªåäº”ä¸­æäº¤.å¦‚ä¸Šå¯ä»¥ä¿®æ”¹ä¸º: 1box.put(friendUser,myUser); å“åº”å¼æ‰©å±•çº¿ç¨‹åˆ‡æ¢12Query&lt;Task&gt; query = taskBox.query().equal(Task_.complete, false).build();query.subscribe().on(AndroidScheduler.mainThread()).observer(data -&gt; updateUi(data)); å½“ç„¶å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ Looper åˆ›å»º AndroidScheduler,æˆ–è€…å®žçŽ° io.objectbox.reactive.Scheduler æŸ¥è¯¢åœ¨åŽå°çº¿ç¨‹æ‰§è¡Œ DataTransformer è¿è¡Œåœ¨åŽå°çº¿ç¨‹ DataObserver å’Œ ErrorObserver è¿è¡Œåœ¨åŽå°çº¿ç¨‹ï¼Œé™¤éžé€šè¿‡ on() æŒ‡å®š æ•°æ®è½¬æ¢å¦‚ä½•è®¢é˜…å®žé™…çš„å¯¹è±¡æ•°é‡: 123boxStore.subscribe() .transform(clazz -&gt; return boxStore.boxFor(clazz).count()) .observer(count -&gt; updateCount(count)); å¼‚å¸¸è®¢é˜…transformer å¯èƒ½æŠ›å‡ºå„ç§å¼‚å¸¸ï¼ŒDataObserver å¯èƒ½æŠ›å‡º RuntimeException. 123public interface ErrorObserver &#123; void onError(Throwable th);&#125; åœ¨ subscribe() åŽè°ƒç”¨ onError() å³å¯. ä¸€æ¬¡é€šçŸ¥ vs. æ”¹å˜å³é€šçŸ¥å½“è®¢é˜… query åŽï¼ŒDataObserver å…·æœ‰å¦‚ä¸‹è¡Œä¸ºï¼š åˆå§‹åŒ–æŸ¥è¯¢ç»“æžœ(å°±åœ¨è®¢é˜…åŽ) æ›´æ–°æŸ¥è¯¢ç»“æžœ(åœ¨æ•°æ®æ”¹å˜åŽ) æœ‰æ—¶å€™ä»…å¯¹å…¶ä¸­ä¸€ç§è¡Œä¸ºæ„Ÿå…´è¶£.single() å’Œ onlyChange() åº”è¿è€Œç”Ÿ(åœ¨ subscribe() åŽè°ƒç”¨)single() åªå“åº”ä¸€æ¬¡é€šçŸ¥å³è‡ªåŠ¨å–æ¶ˆã€‚ å¼±å¼•ç”¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†é¿å…å†…å­˜æ³„éœ²ï¼Œé€šå¸¸å°½å¯èƒ½åœ¨ä¸éœ€è¦çš„æ—¶å€™å–æ¶ˆè®¢é˜…ã€‚å½“ç„¶ï¼Œä½ ä¸åœ¨ä¹Žçš„è¯ï¼Œåœ¨ subscribe() åŽè°ƒç”¨ weak() ä¹Ÿå¯ä»¥. ObjectBox RxJava æ‰©å±•åº“1implementation "io.objectbox:objectbox-rxjava:$objectboxVersion"]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-8-æŸ¥è¯¢]]></title>
    <url>%2F2019%2F02%2F24%2FObjectBox%E5%85%A5%E9%97%A8-8-%E6%9F%A5%E8%AF%A2%2F</url>
    <content type="text"><![CDATA[Queries ä½¿ç”¨ QueryBuilder å®šä¹‰æŸ¥è¯¢æ ‡å‡†ï¼ŒQuery ç±»è¿è¡ŒæŸ¥è¯¢å¹¶è¿”å›žåŒ¹é…ç»“æžœ QueryBuilder QueryBuilder ä½¿ç”¨ç¼–è¯‘ç”Ÿæˆçš„å…ƒä¿¡æ¯ç±»æ¥æŒ‡å®šè¦åŒ¹é…çš„å±žæ€§å€¼ã€‚ 1234567List&lt;user&gt; joes = userBox.query().equal(User_.firstName,"Joe").build().find();QueryBuilder&lt;User&gt; builder = userBox.query();builder.equal(User_.firstName,"Joe") .greater(User_.yearOfBirth,1970) .startsWith(User_.lastName,"O");List&lt;User&gt; youngJoes = builder.build().find(); è¾¹ç•Œæ¡ä»¶ equal(),notEqual(),greater(),less() isNull(),notNull() between() in(),notIn() startsWith(),endsWith(),contains() and(),or() æŽ’åº1234567userBox.query().equal(User_.firstName,"Joe") .order(User_.lastName) // å‡åºæŽ’åˆ—,å¿½ç•¥å¤§å°å†™ .find();userBox.query().equal(User_.firstName,"Joe") .order(User_.lastName,QueryBuilder.DESCENDING | QueryBuilder.CASE_SENSITIVE) .find(); Query1234567Query&lt;User&gt; query = builder. build();// è¿”å›žæ‰€æœ‰åŒ¹é…çš„å¯¹è±¡List&lt;User&gt; joes = query.find();// è¿”å›žç¬¬ä¸€ä¸ªåŒ¹é…çš„å¯¹è±¡ï¼Œå¦‚æžœä¸å­˜åœ¨è¿”å›ž nullUser joe = query.findFirst();// è¿”å›žå”¯ä¸€ä¸€ä¸ªåŒ¹é…çš„å¯¹è±¡ï¼Œå¦‚æžœä¸å­˜åœ¨è¿”å›ž null,å¦‚æžœæœ‰å¤šä¸ªå€¼æŠ›å‡ºå¼‚å¸¸User joe = query.findUnique(); å¦‚æžœæ˜¯ä¸æ–­çš„æ‰§è¡Œ Query,é‚£ä¹ˆåº”è¯¥ç¼“å­˜ Query å¯¹è±¡ï¼Œé‡å¤ä½¿ç”¨ã€‚ä¸ºäº†å¤ç”¨ Query å¯¹è±¡ï¼Œå¯ä»¥æ”¹å˜å®ƒçš„å±žæ€§å€¼ï¼Œæˆ–æŸ¥è¯¢å‚æ•°ï¼Œæˆ–æ·»åŠ çš„å„ç§è¾¹ç•Œæ¡ä»¶ã€‚ 12345// å‡è®¾å·²ç»æž„å»ºäº†ä¸€ä¸ª Query å¯¹è±¡ï¼Œä½†æ˜¯ä¸ºäº†åŽé¢å¤ç”¨ï¼Œæ­¤å¤„ equal è¾¹ç•Œæ¡ä»¶çš„å€¼è®¾ç½®ä¸º ""Query&lt;User&gt; query = userBox.query().equal(User_.firstName,"").build();// æŽ¥ä¸‹æ¥å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µæ”¹å˜å‚æ•°å€¼List&lt;User&gt; joes = query.setParameter(User_.firstName,"Joe").find();List&lt;User&gt; jakes = query.setParameter(User_.firstName,"Jake").find(); å¦‚æžœæ˜¯å¤šä¸ªè¾¹ç•Œæ¡ä»¶ï¼Œå¯ä»¥åœ¨è¾¹ç•Œæ¡ä»¶åŽç»™æ¯ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸€ä¸ªåˆ«å 1234// ç»™ equal() æŸ¥è¯¢å‚æ•°è®¾ç½® name åˆ«åQuery&lt;User&gt; query = userBox.query().equal(User_.firstName,"").parameterAlias("name");// ç„¶åŽå¯ä»¥ä¼ å…¥é”®å€¼å¯¹æ¥ä»£æ›¿å±žæ€§List&lt;User&gt; joes = query.setParameter("name","Joe").find(); Limit,Offset,Pagination12Query&lt;User&gt; query = userBox.query().equal(User_.firstName,"Joe").build();List&lt;User&gt; joes = query.find(/*offset*/10,/*limit*/5,/*results*/); å»¶è¿ŸåŠ è½½ findLazy(),findLazyCached() è¿”å›ž LazyList æŸ¥è¯¢ç»“æžœã€‚ LazyList æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸å¯ä¿®æ”¹çš„åªè¯» list,åªæœ‰åœ¨è®¿é—®æ—¶æ‰ä¼šåŠ è½½æ•°æ®ã€‚ç¼“å­˜ LazyList å¯ä»¥ä¿ç•™ä¹‹å‰è®¿é—®è¿‡çš„æ•°æ®ä»¥é¿å…é‡å¤åŠ è½½ã€‚ åˆ é™¤query.remove() åˆ é™¤æ‰€æœ‰åŒ¹é…çš„ç»“æžœ å±žæ€§æŸ¥è¯¢å¦‚æžœåªæƒ³è¿”å›žæŸä¸ªæŒ‡å®šå±žæ€§çš„å€¼è€Œä¸æ˜¯åŒ¹é…çš„å…¨éƒ¨å¯¹è±¡åˆ—è¡¨ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨ PropertyQuery.åœ¨æž„å»º query åŽè°ƒç”¨ property(Property) å³å¯ 123String[] emails = userBox.query().build() .property(User_.mail) .findStrings(); findString() è¿”å›žç¬¬ä¸€æ¡ç»“æžœï¼ŒfindStrings() è¿”å›žæ‰€æœ‰ç»“æžœ è¿”å›žçš„æ˜¯æ²¡æœ‰æŽ’åºçš„ç»“æžœï¼Œå³ä½¿åœ¨æž„å»º query æ—¶æŒ‡å®šäº†æŽ’åºè§„åˆ™. å¤„ç† null å€¼é»˜è®¤ä¸è¿”å›ž null å€¼ã€‚å¦‚æžœå±žæ€§ä¸º nullï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæ›¿ä»£è¿”å›žå€¼ 12345// å¦‚æžœ email ä¸º null,è¿”å›ž unknownString[] emails = userBox.query() .property(UserBox_.mail) .nullValue("unknown") .findStrings(); distinctï¼Œunique12345// è¿”å›ž â€˜joe'String[] names = userBox.query() .property(User_.firstName) .distinct() .findStrings(); é»˜è®¤ strings å¿½ç•¥å¤§å°å†™ã€‚å½“ç„¶å¯ä»¥å®šåˆ¶ 12345// è¿”å›ž 'joe' 'Joe' 'JOE'String[] names = userBox.query() .property(User_.firstName) .distinct(StringOrder.CASE_SENSITIVE) .findStrings(); åªæŸ¥è¯¢ä¸€ä¸ªå€¼ï¼Œæ²¡æœ‰åˆ™æŠ›å‡ºå¼‚å¸¸ 1234String[] names = userBox.query().build().equal(User_.isAdmin, true) .property(User_.firstName) .unique() .findStrings(); distinct å’Œ unique å¯ä»¥ç»„åˆ ç»Ÿè®¡å±žæ€§æŸ¥è¯¢åŒæ—¶æä¾›äº†ç»Ÿè®¡å‡½æ•°ã€‚ min(),minDouble() max(),maxDouble() sum,sumDouble(): sum() å¯èƒ½æº¢å‡ºå¹¶æŠ›å‡ºå¼‚å¸¸ avg(): è¿”å›ž double count(): æ¯”æŸ¥è¯¢åˆ°å¯¹è±¡åˆ—è¡¨ç„¶åŽæ±‚åˆ—è¡¨é•¿åº¦è¦å¿«ã€‚å¯ä»¥å’Œ distinct() ç»„åˆ ä¸ºå…³è”å±žæ€§æ·»åŠ æŸ¥è¯¢æ¡ä»¶åˆ›å»ºå…³è”å±žæ€§åŽï¼Œå¯èƒ½æƒ³ä¸ºåªå­˜åœ¨äºŽå…³è” entity çš„å±žæ€§æ·»åŠ æŸ¥è¯¢æ¡ä»¶ã€‚SQL ä¸­ä½¿ç”¨ JOIN. 12345678910111213@Entityclass Person &#123; @Id var id: Long = 0 var name: String? = null lateinit var address: ToManay&lt;Address&gt;&#125;@Entityclass Address &#123; @Id var id: Long = 0 var street: String? = null var zip: String? = null&#125; æŸ¥è¯¢ä½åœ¨æŒ‡å®šè¡—é“(Address)çš„ xxx(Person)ã€‚å¯ä»¥ä½¿ç”¨link(RelationInfo 12345// èŽ·å–æ‰€æœ‰åä¸º elmo çš„å¯¹è±¡val builder = box.query().equal(Person_.name,"Elmo");// ä½åœ¨ Sesame è¡—é“builder.link(Person_.address).equal(Address_.street,"Sesame Street");val elmosOnSesameStreet = builder.build().find() å¦‚æžœæƒ³èŽ·å–åˆ° Address åˆ—è¡¨å‘¢ï¼Ÿé‚£ä¹ˆå¯ä»¥åœ¨ Address ä¸­æ·»åŠ  @Backlint æ³¨è§£ 1234567891011@Entityclass Address &#123; // ... @Backlint(to = "addresses") lateinit var persons: ToMany&lt;Person&gt;&#125;// èŽ·å–æ‰€æœ‰ Sesame è¡—é“å¯¹è±¡val builder = box.query().equal(Address_.street,"Sesame Street");// åä¸º elmobuilder.link(Address_.persons).equal(Person_.name,"Elmo");val sesameStreetsWithElmo = builder.build().find(); å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ä¿®æ”¹ Address,ä½¿ç”¨ backlink(RelationInfo) å³å¯å®žçŽ°æŸ¥è¯¢ 123val builder = box.query().equal(Address_.street,"Sesame Street");builder.backlink(Person_.address).equal(Person_.name,"Elmo");val sesameStreetWithElmos = builder.build().find(); å…³ç³»å±žæ€§çš„æ¿€è¿›åŠ è½½é»˜è®¤å…³ç³»å±žæ€§æ˜¯æ‡’åŠ è½½çš„ã€‚ç¬¬ä¸€æ¬¡è®¿é—® ToOne ,ToMany å±žæ€§æ—¶ä¼šåˆ°æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼Œç„¶åŽéƒ½ä¼šä½¿ç”¨ç¼“å­˜è¿‡çš„æ•°æ®ã€‚ 12val customers = customerBox.query().build().find()customers[0].orders[0]; // ç¬¬ä¸€æ¬¡è®¿é—®è§¦å‘æ•°æ®åº“æŸ¥è¯¢ å¦‚æžœæƒ³åœ¨æŸ¥è¯¢ç»“æžœè¿”å›žæ—¶å®žçŽ°é¢„è¯»å– ToOne,ToMany æ•°æ®,è¯·ä½¿ç”¨ QueryBuilder.eager 1234val customers = customerBox.query() .eager(Customer_.orders) .build() .find(); eager åŠ è½½ä»…æ”¯æŒä¸€å±‚æ·±åº¦ã€‚å¦‚æžœæœ‰åµŒå¥—çš„å…³è”å±‚çº§ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ query filter å®žçŽ°ã€‚ query filtersåº”ç”¨äºŽå¤æ‚çš„è¾¹ç•Œæ¡ä»¶ï¼ŒQueryBuilder ç±»ä¸èƒ½å®žçŽ°ã€‚ä½¿ç”¨å¦‚ä¸‹è§„åˆ™å°†ä¼šéžå¸¸é«˜æ•ˆï¼š ä½¿ç”¨æ ‡å‡†çš„æ•°æ®åº“è¾¹ç•Œæ¡ä»¶ç¼©å°ç›®æ ‡èŒƒå›´ã€‚(ä½¿ç”¨ QueryBuilder èŽ·å–ç›®æ ‡) ç„¶åŽä½¿ç”¨ QueryFilter è¿‡æ»¤QueryFilter ä¸€æ¬¡æ£€æŸ¥ä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œç¬¦åˆè¿”å›ž true 12345// ç¼©å°èŒƒå›´songBox.query().equal(Song_.bandId,bandId) .filter((song) -&gt; &#123; return song.starCount * 2 &gt; song.downloads; &#125;); å…³æ³¨ä¸€ä¸‹æ€§èƒ½: ObjectBox åˆ›å»ºå¯¹è±¡éžå¸¸å¿« è™šæ‹Ÿæœºä¼šå›žæ”¶çŸ­æœŸå¯¹è±¡ã€‚æ­¤å¤„å›žæ”¶å°†æ¯”åˆ›å»ºå¿«ï¼Œæ‰€ä»¥æ€§èƒ½ä¸æ˜¯é—®é¢˜ã€‚ query filters å’Œ ToManyToMany æä¾›äº†å¾ˆå¤šå‡½æ•°å¯ä»¥æ–¹ä¾¿çš„è½¬ä¸º query filters: hasA hasAll getById]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-7-kotlinæ”¯æŒ]]></title>
    <url>%2F2019%2F02%2F24%2FObjectBox%E5%85%A5%E9%97%A8-7-kotlin%E6%94%AF%E6%8C%81%2F</url>
    <content type="text"><![CDATA[Kotlin æ”¯æŒkotlin Entity åœ¨ kotlin ä¸­ï¼ŒID å±žæ€§åº”è¯¥è¿™æ ·å®šä¹‰ @Id var id: Long = 0.ID å¿…é¡»æ˜¯ var. æž„é€ å™¨ ObjectBox ä¼˜å…ˆè°ƒç”¨å…¨å‚çš„æž„é€ æ–¹æ³•ã€‚å¦‚æžœè‡ªå®šä¹‰å±žæ€§æˆ– transient å±žæ€§ æˆ–å…³è”å±žæ€§æ˜¯æž„é€ æ–¹æ³•çš„ä¸€éƒ¨åˆ†å‚æ•°ï¼ŒObjectBox å°†ä¸ä¼šè°ƒç”¨æ­¤æž„é€ æ–¹æ³•.æ‰€ä»¥åº”è¯¥æä¾›ä¸ºè¿™äº›å‚æ•°æä¾›é»˜è®¤å€¼ä»¥ç¡®ä¿æ— å‚æž„é€ æ–¹æ³•å­˜åœ¨ã€‚ 1234567@Entitydata class Note( @Id var id: Long = 0, val text: String = "", @Convert( converter = StringsConverter::class, dbType = String::class) val strings: List&lt;String&gt; = listOf()) kotlin Entity ä¸­å®šä¹‰å…³è”å±žæ€§åœ¨ kotlin ä¸­å®šä¹‰å…³è”å±žæ€§å¯èƒ½æ¯”è¾ƒéº»çƒ¦ã€‚ä½†è¯·æ³¨æ„ï¼šå…³è”å±žæ€§å¿…é¡»ä¸º var. å¦åˆ™ initialization magic å°†ä¸èµ·ä½œç”¨.é€šå¸¸å¯ä»¥ä½¿ç”¨ lateinit ä¿®é¥°å…³è”å±žæ€§ 123456789101112@Entityclass Order &#123; @Id var id: Long = 0 lateinit var customer: ToOne&lt;Customer&gt;&#125;@Entityclass Customer &#123; @Id var id: Long = 0 @Backlink( to = "customer") latelinit var orders: List&lt;Order&gt;&#125; kotlin æ‰©å±•å‡½æ•°123dependencies &#123; implementation "io.objectbox:objectbox-kotlin:$objectboxVersion"&#125; kotlin 12345678910111213val box: Box&lt;DataClassEntity&gt; = store.boxFor()val query = box.query &#123; equal(property,value) order(property)&#125;val query = box.query().inValues(property,array).build()toMany.applyChangesToDb(resetFirst = true) &#123; // é»˜è®¤ false add(entity) removeById(id)&#125;]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-6-Javaæ¡Œé¢åº”ç”¨.md]]></title>
    <url>%2F2019%2F02%2F24%2FObjectBox%E5%85%A5%E9%97%A8-6-Java%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Java æ¡Œé¢åº”ç”¨åµŒå…¥å¼æ•°æ®åº“ObjectBox ä¸ä»…ä»…é€‚ç”¨äºŽ Android é¡¹ç›®ï¼ŒåŒæ—¶ä¹Ÿé€‚ç”¨äºŽè¿è¡Œåœ¨ Windows Linux macOS ä¸Šçš„çº¯ Java(JVM) æ¡Œé¢åº”ç”¨. é…ç½®è¯·ä½¿ç”¨ Gradle ä½œä¸ºæž„å»ºå·¥å…·ï¼Œå› ä¸º ObjectBox ä½¿ç”¨äº† Gradle æ’ä»¶. 1234567891011121314151617buildscript &#123; ext.objectboxVersion = '2.3.3' repositories &#123; jcenter() maven&#123; url "https://plugins.gradle.org/m2/"&#125; &#125; dependencies &#123; classpath "net.ltgt.gradle:gradle-apt-plugin:0.20" classpath "io.objectbox:objectbox-gradle-plugin:$objectboxVersion" &#125;&#125;repositories &#123; jcenter()&#125;apply plugin: 'java'apply plugin: 'net.ltgt.apt-idea' // æ³¨è§£å¤„ç†å™¨æ’ä»¶apply plugin: 'io.objectbox' Native åº“ObjectBox æ˜¯ç”± C/C++å†™æˆçš„å¯ä»¥è¿è¡Œå¤§å¤šæ•° native code çš„å¯¹è±¡æ•°æ®åº“ã€‚ æ”¹å˜ Model æ–‡ä»¶ä½ç½®é»˜è®¤ model æ–‡ä»¶å­˜å‚¨åœ¨ module-name/objectbox-models/default.json.å¯ä»¥é€šè¿‡ä¿®æ”¹ objectbox.modelPath æ¥æ”¹å˜ 1234// åœ¨é¡¹ç›® build.gradle æ–‡ä»¶ï¼Œ apply plugin: 'java' ä¹‹åŽæ·»åŠ tasks.withType(JavaCompile) &#123; options.compilerArgs += ["-Aobjectbox.modelPath=$projectDir/schemas/object.json]&#125; æ”¹å˜ MyObjectBox åŒ…å123tasks.withType(JavaCompile) &#123; options.compilerArgs += [ "-Aobjectbox.modelPath=$projectDir/schemas/objectbox.json" ]&#125; å¼€å¯ debug æ¨¡å¼12345678// enable debug output for pluginobjectbox &#123; debug true&#125;// enable debug output for annotation processortasks.withType(JavaCompile) &#123; options.compilerArgs += [ "-Aobjectbox.debug=true" ]&#125; å¯ä»¥ä½¿ç”¨ BoxStore builder çš„ name(String) æ¥æ”¹å˜æ•°æ®åº“å­˜å‚¨çš„ä½ç½®ã€‚å•å…ƒæµ‹è¯•æ·»åŠ  junit 4 åº“]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-5-LiveData]]></title>
    <url>%2F2019%2F02%2F24%2FObjectBox%E5%85%A5%E9%97%A8-5-LiveData%2F</url>
    <content type="text"><![CDATA[LiveData (Arch.Comp.)ä»Ž 1.2.0 å¼€å§‹æ”¯æŒ Android Architecture ComponentsObjectBox æä¾› ObjectBoxLiveData å¯ä»¥åœ¨ ViewModel ä¸­ä½¿ç”¨ 1234567891011public class NoteViewModel extends ViewModel &#123; private ObjectBoxLiveData&lt;Note&gt; noteLiveData; public ObjectBoxLiveData&lt;Note&gt; getNoteLiveData(Box&lt;Note&gt; notesBox) &#123; if (noteLiveData == null) &#123; // æŸ¥è¯¢æ‰€æœ‰çš„ notes, text æŒ‰ a-z çš„é¡ºåºæŽ’åˆ— noteLiveData = new ObjectBoxLiveData(notesBox.query().order(Note_.text).build()); &#125; return noteLiveData; &#125;&#125; ä¸Šä¸€ç§æ–¹æ³•éœ€è¦ä¼ å…¥ Box.å¯ä»¥ä½¿ç”¨ AndroidViewModel ä»£æ›¿ï¼Œå®ƒå¯ä»¥è®¿é—® Application context,ç„¶åŽä¼šåœ¨ ViewModel ä¸­è°ƒç”¨ ((App)getApplication()).getBoxStore().boxFor().ç¬¬ä¸€ç§çš„ä¼˜åŠ¿åœ¨äºŽæ²¡æœ‰å¼•ç”¨ Android ç±»ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚ 1234567NoteViewModel model = ViewModelProviders.of(this).get(NoteViewModel.class);model.getNoteLiveData(notesBox).observe(this,new Observer&lt;List&lt;Note&gt;&gt;&#123; @Override public void onChanged(@Nullable List&lt;Node&gt; notes) &#123; notesAdapter.setNotes(notes); &#125;&#125;) Paging (Arch.Comp.)ä»Ž 2.0.0 å¼€å§‹æ”¯æŒ.ObjectBox æä¾›äº† ObjectBoxDataSource ç±».å®ƒç»§æ‰¿äº† paging åº“çš„ PositionalDataSourceåœ¨ ViewModel ä¸­ï¼Œç±»ä¼¼åˆ›å»º LiveData,å…ˆåˆ›å»º ObjectBox query.ç„¶åŽæž„é€ å¹¶ä½¿ç”¨ ObjectBoxDataSource å·¥åŽ‚ä»£æ›¿ LiveData. 1234567891011121314public class NotePageViewModel extends ViewModel &#123; private LiveData&lt;PagedList&lt;Note&gt;&gt; noteLiveDataPaged; public LiveData&lt;PagedList&lt;Note&gt;&gt; getNoteLiveDataPaged(Box&lt;Note&gt; notesBox) &#123; if(noteLiveDataPaged == null) &#123; Query&lt;Note&gt; query = notesBox.query().order(Note_.text).build(); noteLiveDataPaged = new LivePagedListBuilder( new ObjectBoxDataSource.Factory(query), 20 // é¡µæ•° ).build(); &#125; return noteLiveDataPaged; &#125;&#125;]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-4-æœ¬åœ°å•å…ƒæµ‹è¯•]]></title>
    <url>%2F2019%2F02%2F24%2FObjectBox%E5%85%A5%E9%97%A8-4-%E6%9C%AC%E5%9C%B0%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%2F</url>
    <content type="text"><![CDATA[å®‰å“æœ¬åœ°å•å…ƒæµ‹è¯•è®¾ç½®æµ‹è¯•çŽ¯å¢ƒ| æ­¤é…ç½®ä»…é’ˆå¯¹ ObjectBox 1.4 åŠä¹‹å‰ç‰ˆæœ¬.æ–°ç‰ˆæœ¬å·²ç»è‡ªåŠ¨æ·»åŠ äº† native ObjectBox ä¾èµ–åº“ã€‚ 123456789// /app/build.gradledepdendencies &#123; // å¿…å¤‡ JUnit 4 testImplementation 'junit:unit:4.12' // æ‰‹åŠ¨æ·»åŠ å¹³å°ç‹¬ç«‹çš„ native Objectbox ä¾èµ–åº“.(å¯é€‰) testImplementation "io.objectbox:objectbox-linux:$objectboxVersion" testImplementation "io.objectbox:objectbox-macos:$objectboxVersion" testImplementation "io.objectbox:objectbox-windows:$objectboxVersion"&#125; | æœ¬åœ°å•å…ƒæµ‹è¯•ä»…æ”¯æŒ 64 ä½ç³»ç»Ÿ.| windows å¯èƒ½éœ€è¦å®‰è£… Microsoft Visual C++ 2015 Redistributable(x64) åˆ›å»ºæœ¬åœ°å•å…ƒæµ‹è¯•ç±» å¯ä»¥ä½¿ç”¨ BoxStore builder çš„directory(File) æŒ‡å®šæ•°æ®åº“ä¿å­˜åœ¨æœ¬åœ°è®¾å¤‡ä¸Šã€‚ ä¸ºä¿è¯æ•°æ®ä¸äº¤å‰æ±¡æŸ“ï¼Œå¯ä»¥ä½¿ç”¨ BoxStore.deleteAllFiles(File) åˆ é™¤å·²ç»å­˜åœ¨çš„æ•°æ®åº“ 12345678910111213141516171819202122232425262728293031public class NoteTest &#123; private static final File TEST_DIR = new File("objectbox-example/test-db"); private BoxStore store; @Before public void setUp() throws Exception &#123; // åˆ é™¤ä¹‹å‰çš„æ•°æ®åº“ BoxStore.deleteAllFiles(TEST_DIR); store = MyObjectBox.builder() // æŒ‡å®šæ•°æ®åº“å­˜æ”¾è·¯å¾„ .directory(TEST_DIR) // æ·»åŠ  debug æ ‡è®°æ‰“å°æ—¥å¿— .debugFlags(DebugFlags.LOG_QUERIES | DebugFlags.LOG_QUERY_PARAMETERS) .build(); &#125; @After public void tearDown() throws Exception &#123; if (store != null) &#123; store.close(); store = null &#125; BoxStore.deleteAllFiles(TEST_DIR); &#125; @Test public void exampleTest() &#123; Box&lt;Note&gt; noteBox = store.boxFor(Note.class); assertEquals(...); &#125;&#125; å…³ç³»æµ‹è¯• ObjectBox 1.4.4 åŠä¹‹åŽ ä¸ºäº†æµ‹è¯•å…·æœ‰ ToOne,ToMany å±žæ€§çš„ entity,å¿…é¡»åœ¨æœ¬åœ° JVM åˆå§‹åŒ– entity å¹¶ä¸”æ·»åŠ ä¸€ä¸ª transient çš„ BoxStore å±žæ€§.]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-3-æ³¨è§£]]></title>
    <url>%2F2019%2F02%2F24%2FObjectBox%E5%85%A5%E9%97%A8-3-%E6%B3%A8%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[Entity æ³¨è§£entity æ•°æ®å¯è®¿é—® ObjectBox éœ€è¦è®¿é—® entity çš„å±žæ€§(ç”Ÿæˆ Cursor ç±»). å±žæ€§åŒ…å†…å¯è§ã€‚kotlin ä¸­ä½¿ç”¨ JvmField æä¾›æ ‡å‡† getters ä¸ºäº†æå‡æ€§èƒ½ï¼Œè¯·æä¾›å…·æœ‰å…¨éƒ¨å±žæ€§çš„æž„é€ æ–¹æ³• 123456789101112@Entitypublic class User &#123; @Id private long id; private String name; @Transient private int tempUsageCount; public User()&#123;/* é»˜è®¤æž„é€ æ–¹æ³• */&#125; public User(id,name)&#123; this.id = id; this.name = name; &#125; // getters and setters for properties...&#125; entity å±žæ€§çš„æ³¨è§£ @NameInDb å¯ä»¥åœ¨æ•°æ®åº“ä¸­ä¸ºå±žæ€§å‘½åã€‚ åº”è¯¥ä½¿ç”¨ @Uid æ³¨è§£æ¥ä»£æ›¿é‡å‘½åå±žæ€§å’Œ entity @NameInDb ä»…æ”¯æŒå†…è”å¸¸é‡æ¥æŒ‡å®šåˆ—åã€‚ @Transient ä¿è¯å±žæ€§ä¸è¢«æŒä¹…åŒ–ï¼Œtransientï¼Œstatic ä¿®é¥°ç¬¦ä¹Ÿä¸€æ ·. å±žæ€§ç´¢å¼• @Index @Index å½“å‰ä¸æ”¯æŒ byte[] float double Index typs(String). ObjectBox 2.0 å¼•å…¥äº† index types.ä¹‹å‰å¯¹æ¯ä¸€ä¸ªç´¢å¼•ï¼Œä½¿ç”¨å±žæ€§çš„å€¼æ¥å®ŒæˆæŸ¥è¯¢ã€‚çŽ°åœ¨ ObjectBox å¯ä»¥ä½¿ç”¨ hash æ¥ç”Ÿæˆ index.ç”±äºŽ String å±žæ€§æ˜Žæ˜¾æ¯”æ ‡é‡å€¼æ›´å ç©ºé—´ï¼ŒObjectBox å¯¹ strings ä½¿ç”¨é»˜è®¤çš„ index type å®Œæˆ hash.å¯ä»¥é’ˆå¯¹ String ç±»åž‹çš„å±žæ€§æ˜Žç¡®æŒ‡å®š index type ä¸ºåŸºäºŽå€¼æž„å»ºç´¢å¼•ã€‚ 12@Index( type = IndexType.VALUE)private String name; è¯·æ³¨æ„ï¼šå¯¹äºŽ String ç±»åž‹çš„å±žæ€§ï¼ŒåŸºäºŽå€¼çš„ç´¢å¼•å¯èƒ½æ¯”é»˜è®¤åŸºäºŽ hash çš„ç´¢å¼•æ›´å ç©ºé—´,è¿™ç§ç»“è®ºå–å†³äºŽè¯¥å€¼çš„é•¿åº¦ã€‚ ObjectBox æ”¯æŒä»¥ä¸‹ç´¢å¼•å±žæ€§: æœªæŒ‡å®šæˆ–é»˜è®¤: æ ¹æ®å±žæ€§çš„ç±»åž‹å†³å®š(HASH for String,VALUE for others) VALUE: ä½¿ç”¨å±žæ€§å€¼ç”Ÿæˆç´¢å¼•ã€‚ä¾‹å¦‚ String,å¯èƒ½æ›´å ç©ºé—´ HASH: ä½¿ç”¨å±žæ€§å€¼çš„ 32 ä½ hash ç”Ÿæˆç´¢å¼•ã€‚å¶å°”å¯èƒ½å‘ç”Ÿ hash ç¢°æ’žï¼Œä½†å®žé™…æ¦‚çŽ‡å¾ˆå°ã€‚é€šå¸¸æ¯” HASH64 æ›´ä½³ï¼Œå› ä¸ºå ç©ºé—´å° HASH64: ä½¿ç”¨å±žæ€§å€¼çš„é•¿ hash ç”Ÿæˆç´¢å¼•ã€‚æ¯” HASH å ç©ºé—´å¤§ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ä¸æ˜¯é¦–é€‰. Unique çº¦æŸå¦‚æžœ unique çº¦æŸçš„å±žæ€§å€¼å†²çªï¼Œput() æ“ä½œå°†è¢«ç»ˆæ­¢ä¸”æŠ›å‡º UniqueViolationException çš„å¼‚å¸¸.Unique åŸºäºŽ Index,æ‰€ä»¥å¯ä»¥åŒæ—¶ç»™å±žæ€§æ·»åŠ  @Index æ³¨è§£ã€‚ å…³ç³»]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-2-åŸºæœ¬æ“ä½œ]]></title>
    <url>%2F2019%2F02%2F24%2FObjectBox%E5%85%A5%E9%97%A8-2-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[Entityåœ¨ä¸€ä¸ªç±»ä¸­è‡³å°‘éœ€è¦ @Entity å’Œ @Id ä¸¤ä¸ªæ³¨è§£æ‰èƒ½å®šä¹‰ä¸€ä¸ª ObjectBox model.ä¾‹å¦‚: 123456// User.java@Entitypublic class User &#123; @Id public long id; public String name;&#125; ç„¶åŽ make å°±å¯ç”Ÿæˆ model. | @Id çš„ç±»åž‹å¿…é¡»ä¸º long.| å¦‚æžœ entity å‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŠ¨ï¼ˆå¦‚ç§»åŠ¨ç±»æˆ–ä¿®æ”¹æ³¨è§£ï¼‰,å¿…é¡» rebuild é¡¹ç›®ä»¥ä¾¿ ObjectBox ç”Ÿæˆçš„ä»£ç å¾—åˆ°æ›´æ–°. æ ¸å¿ƒç±» MyObjectBox: åŸºäºŽ entity ç±»ç”Ÿæˆã€‚æä¾› builder é…ç½® BoxStore. BoxStore: ObjectBox çš„å…¥å£ã€‚æ“ä½œæ•°æ®åº“ï¼Œç®¡ç† Boxes çš„å·¥å…·. Box: å¯¹ entity ä¿å­˜å’ŒæŸ¥è¯¢ã€‚æ¯ä¸€ä¸ª entity éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Boxï¼ˆç”± BoxStore æä¾›). æ ¸å¿ƒåˆå§‹åŒ–å®žä¾‹åŒ– BoxStore çš„æœ€å¥½æ—¶æœºæ˜¯åœ¨ app å¯åŠ¨æ—¶ã€‚æŽ¨èåœ¨ Application ç±»çš„ onCreate æ–¹æ³•ä¸­è¿›è¡Œ. 12345678910111213public class App extends Application &#123; private BoxStore boxStore; @Override public void onCreate() &#123; super.onCreate(); boxStore = MyObjectBox.builder().androidContext(this).build(); &#125; public BoxStore getBoxStore() &#123; return boxStore; &#125;&#125;// ç„¶åŽåœ¨ app ç”Ÿå‘½å‘¨æœŸå†…å°±å¯ä»¥ä½¿ç”¨äº†notesBox = ((App) getApplicationi()).getBoxStore().boxFor(User.class); Box åŸºæœ¬æ“ä½œ put: å­˜å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œå¯èƒ½ä¼šè¦†ç›–å…·æœ‰ç›¸åŒ ID çš„å¯¹è±¡ã€‚å³ä½¿ç”¨ put æ’å…¥æˆ–æ›´æ–°å¯¹è±¡ã€‚è¿”å›ž IDã€‚ get,getAll: æä¾›ä¸€ä¸ªå¯¹è±¡çš„ IDï¼Œå¯å¿«é€Ÿçš„é€šè¿‡ getèŽ·å–å®ƒã€‚getAll èŽ·å–æŒ‡å®šçš„æ‰€æœ‰çš„å¯¹è±¡ã€‚ remove,removeAll: ä»Ž box ä¸­åˆ é™¤ä¸€ä¸ªå¯¹è±¡ã€‚removeAll åˆ é™¤æŒ‡å®šçš„æ‰€æœ‰å¯¹è±¡. count: è¿”å›žè¯¥ box å­˜å‚¨çš„å¯¹è±¡æ•°é‡. query: è¿”å›žä¸€ä¸ª query builder. Object IDs Entity å¿…é¡»å…·æœ‰ä¸€ä¸ªç±»åž‹ä¸º long,ç”± @Id æ³¨è§£å±žæ€§ã€‚å½“ç„¶å¯ä»¥ä½¿ç”¨å¯ç©ºçš„ java.lang.Longç±»åž‹ï¼Œä½†ä¸æŽ¨èã€‚å¦‚æžœéœ€è¦ä½¿ç”¨å¦å¤–ä¸€ç§ç±»åž‹çš„ ID(æœåŠ¡å™¨è¿”å›žçš„ String ç±»åž‹çš„ UID),æŠŠå®ƒä½œä¸ºæ™®é€šå±žæ€§å³å¯ï¼Œç„¶åŽå¯ä»¥é€šè¿‡æ­¤ ID æŸ¥è¯¢. 123456@Entity class StringIdEntity &#123; @Id priavte long id; private String uid;&#125;StringIdEntity entity = box.query().equal(StringIdEntity_.uid,uid).findUnique(); æŒ‡å®š IDObjectBox é»˜è®¤ä¼šä¸ºæ–°å¯¹è±¡æŒ‡å®š IDs.ID è‡ªå¢ž. 12345User user = new User();// user.id == 0box.put(user);// user.id != 0long id = user.id å¦‚æžœæ’å…¥çš„å¯¹è±¡çš„ ID æ¯” box é‡Œçš„ ID æœ€å¤§å€¼è¿˜å¤§ï¼ŒObjectBox å°†æŠ›å‡ºé”™è¯¯. ä¿ç•™ Object IDsObject IDs ä¸èƒ½ï¼šâ€“ 0,null(ä½¿ç”¨ java.lang.Long)ã€‚â€“ 0xFFFFFFFFFFFFFFFFï¼ˆjava ä¸­çš„ -1ï¼‰:å†…éƒ¨ä¿ç•™ äº‹åŠ¡ put è¿è¡Œåœ¨éšå¼äº‹åŠ¡ä¸­ ä¼˜å…ˆä½¿ç”¨ put æ‰¹é‡æ“ä½œåˆ—è¡¨ ï¼ˆput(entities)ï¼‰ å¦‚æžœåœ¨å¾ªçŽ¯ä¸­æ“ä½œå¤§é‡æ•°æ®ï¼Œè€ƒè™‘æ˜Žç¡®ä½¿ç”¨äº‹åŠ¡ï¼Œå¦‚runInTx()]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ObjectBoxå…¥é—¨-1-ç®€ä»‹]]></title>
    <url>%2F2019%2F02%2F24%2FObjectBox%E5%85%A5%E9%97%A8-1-%E7%AE%80%E4%BB%8B%2F</url>
    <content type="text"><![CDATA[å…³äºŽObjectBox å®šä½æ˜¯: é’ˆå¯¹ç§»åŠ¨ç«¯å’Œ IoT è¶…å¿«çš„ (superfast edge database) é¢å‘å¯¹è±¡çš„æ•°æ®åº“ .ä¸ºå°åž‹è®¾å¤‡æä¾›äº†è¾¹ç¼˜è®¡ç®—èƒ½åŠ›ï¼Œä½¿å¾—æ•°æ®å¯ä»¥å¿«é€Ÿé«˜æ•ˆåœ°åœ¨æœ¬åœ°å­˜å‚¨ã€å¤„ç†ã€å®‰å…¨ç®¡ç†.ObjectBox å°äºŽ 1MB,æœ€é€‚åˆç§»åŠ¨ APPã€å°åž‹ IoT è®¾å¤‡åŠè·¯ç”±ã€‚å¹¶ä¸” ObjectBox ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªåœ¨è¾¹ç¼˜è®¾å¤‡ä¸Šå…¼å®¹ ACID çš„é«˜æ€§èƒ½çš„ NoSQL æ•°æ®åº“.æ‰€æœ‰çš„äº§å“éƒ½æ˜¯åŸºäºŽå·¥ç¨‹å¸ˆæ€ç»´å¼€å‘çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æœ€å°‘çš„ä»£ç åŽ»å®žçŽ°æƒ³è¦çš„åŠŸèƒ½ã€‚ ä¼˜ç‚¹ æ¯”åŒç±»ç«Ÿå“å¿« 10 å€ä»¥ä¸Šã€‚BenchMark è·¨å¹³å°ã€‚æ”¯æŒ Linuxã€Windowsã€Mac/iOSã€Androidã€Raspberry Piã€ARM ç­‰åµŒå…¥å¼è®¾å¤‡å’Œå®¹å™¨ã€‚ å°äºŽ 1MB,ç‰¹åˆ«é’ˆå¯¹å°åž‹è®¾å¤‡è®¾è®¡å’Œä¼˜åŒ–ã€‚ æ˜“ä½¿ç”¨ã€‚ æ”¯æŒ reactive. æ— ç¼ç»“åˆ greenDAO.(åŒä¸€å®¶å…¬å¸å‡ºå“) æ›´å¥½åœ°æ”¯æŒå…³ç³»åž‹æ•°æ®. æä¾›äº†æ”¹å˜è¿½è¸ª(change tracking)ï¼Œçº§è”æ·»åŠ (cascading puts)ï¼Œçµæ´»çš„åŠ è½½ç­–ç•¥(eager,lazy) æ— éœ€æŽŒæ¡ SQL:ObjectBox è®¾è®¡ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œä¸éœ€è¦æŽŒæ¡ SQL å³å¯ä¸Šæ‰‹. æ”¯æŒ kotlin: åŒ…æ‹¬ data class. ä½¿ç”¨Android(Java)123456789101112// root ç›®å½• build.gradlebuildscript &#123; ext.objectboxVersion = '2.3.3' repositories &#123; jcenter() &#125; dependencies &#123; // Android Gradle plugin æœ€ä½Žç‰ˆæœ¬ä¸º 3.0.0 classpath 'com.android.tools.build:gradle:3.3.1' classpath "io.objectbox:objectbox-gradle-plugin:$objectboxVersion" &#125;&#125; 123// app æˆ–å…¶ä»– module build.gradleapply plugin: 'com.android.application'apply plugin: 'io.objectbox' æ”¾åœ¨æœ€ä¸‹é¢ Android(Kotlin)12345// app æˆ–å…¶ä»– module build.gradleapply plugin: 'com.android.application'apply plugin: 'kotlin-android'apply plugin: 'kotlin-kapt' å¦‚æžœä½¿ç”¨ kotlin-android æ’ä»¶ï¼Œå¿…é¡»åŠ  kotlin -kapt æ’ä»¶apply plugin: 'io.objectbox' æ”¾åœ¨æœ€ä¸‹é¢ Sync gradle å³å¯è‡ªåŠ¨æ·»åŠ  ObjectBox ä¾èµ–. é…ç½®1ã€é¦–å…ˆæ·»åŠ  ObjectBox æ’ä»¶.2ã€å¦‚æžœ ObjectBox æ’ä»¶æ²¡æœ‰è‡ªåŠ¨æ·»åŠ ä¾èµ–åº“å’Œæ³¨è§£å¤„ç†å™¨ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ ä¾èµ–ã€‚ 123456// Android(Java)// /app/build.gradledependencies &#123; compile "io.objectbox:objectbox-androoid:$objectboxVersion" annotationProcessor "io.objectbox:objectbox-processor:$objectboxVersion"&#125; 12345678// Android(kotlin)// /app/build.gradledependencies &#123; compile "io.objectbox:objectbox-android:$objectboxVersion" kapt "io.objectbox:objectbox-processor:$objectboxVersioni" // é’ˆå¯¹ kotlin çš„æ‰©å±•å‡½æ•°(å¯é€‰) compile "io.objectbox:objectbox-kotlin:$objectboxVersion"&#125; 3ã€æ”¹å˜ Model æ–‡ä»¶çš„è·¯å¾„ ObjectBox Model æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ module-name/objectbox-models/default.jsonã€‚ 1234567891011// Android(Java)// /app/build.gradleandroid &#123; defaultConfig &#123; javaCompileOptions &#123; annotationProcessorOptions &#123; arguments = ["objectbox.modelPath":"$projectDir/schemas/objectbox.json".toString()] &#125; &#125; &#125;&#125; 1234567// Android(Kotlin)// /app/build.gradlekapt &#123; arguments &#123; arg("objectbox.modelPath":"$projectDir/schemas/objectbox.json") &#125;&#125; 4ã€æ”¹å˜ MyObjectBox çš„åŒ…å MyObjectBox ç±»çš„åŒ…åé»˜è®¤å’Œ entitiy ç±»çš„åŒ…åæˆ–å…¶ä¸Šä¸€çº§æŠ¥åä¸€è‡´ã€‚ 1234567891011// Android(Java)// /app/build.gradleandroid &#123; defaultConfig &#123; javaCompileOptions &#123; annotationProcessorOptions &#123; arguments = ["objectbox.myObjectBoxPackage":"com.example.custom"] &#125; &#125; &#125;&#125; 1234567// Android(Kotlin)// /app/build.gradlekapt &#123; arguments &#123; arg("objectbox.myObjectBoxPackage", "com.example.custom") &#125;&#125; 5ã€å¼€å¯ Debug æ¨¡å¼ åœ¨ /app/build.gradle ä¸­æ·»åŠ å¿…è¦çš„é€‰é¡¹åŽï¼Œè¿è¡Œ ./gradlew --info å³å¯æŸ¥çœ‹ debug è¾“å‡º 1234567891011// Android(Java)// /app/build.gradleandroid &#123; defaultConfig &#123; javaCompileOptions &#123; annotationProcessorOptions &#123; arguments = ['objectbox.debug' : 'true'] &#125; &#125; &#125;&#125; 1234567// Android(Kotlin)// /app/build.gradlekapt &#123; arguments &#123; arg("objectbox.debug", true) &#125;&#125; 6ã€å¼€å¯ DaoCompat å…¼å®¹æ¨¡å¼ ä»Ž greenDAO è¿ç§»è¿‡æ¥ï¼Œç”Ÿæˆå’Œ greenDAO ç›¸ä¼¼çš„ API,ä½¿ ObjectBox çœ‹èµ·æ¥å°±åƒ SQLite ä¸€æ ·ã€‚ 1234// /app[module]/build.gradledepdendencies &#123; compile "org.greenrobot:objectbox-daocompat:1.10"&#125; ç„¶åŽå¼€å¯ DaoCompat æ¨¡å¼ 1234567891011// Android(Java)// /app[module]/build.gradleandroid &#123; defaultConfig &#123; javaCOmpileOptions &#123; annotationProcessorOptions &#123; arguments = ['objectbox.daoCompat':'true'] &#125; &#125; &#125;&#125; 1234567// Android(Kotlin)// /app[module]/build.gradlekapt &#123; arguments &#123; arg("objectbox.daoCompat":true) &#125;&#125; å¦‚æžœä½ è®¡åˆ’ä»Ž greenDAO è¿ç§»åˆ° ObjectBox,é‚£ä¹ˆä½ å¯èƒ½ä¼šä¿ç•™åŽŸæ¥çš„ greenDAO entity ç±»ï¼ˆå¤åˆ¶è¿™äº›ç±»åˆ°å¦å¤–çš„åŒ…ä¸­ï¼‰ç„¶åŽæŒ‰å¦‚ä¸‹ä¿®æ”¹ã€‚ é¦–å…ˆæ”¹å˜æ³¨è§£ã€‚è¯·æ³¨æ„ï¼šä¸æ˜¯æ‰€æœ‰çš„ greenDAO æ³¨è§£éƒ½æ”¯æŒæ— ç¼è¿ç§»åˆ° ObjectBox,æ”¯æŒçš„å¦‚ä¸‹ï¼š 1234567// greenDAOimport org.greenrobot.greendao.annotation.Entity;import org.greenrobot.greendao.annotation...// ObjectBoximport io.objectbox.annotation.Entity;import io.objectbox.annotation... ObjectBox å½“å‰ä¸æ”¯æŒ unique indexes,naming indexes,æˆ–è€…åœ¨å¤šä¸ªå±žæ€§é—´ indexes. 1234567// greenDAO@Entity(indexes = ...)@Index(name = "idx1", unique = true) private String name;@Unqiue private String name;// ObjectBox@Index private String name; è‡ªå®šä¹‰ç±»åž‹ã€‚ä¿®æ”¹çˆ¶ç±»,å½“ç„¶ä¹Ÿå¯åŒæ—¶ç»§æ‰¿ï¼Œè¿™æ ·è¯¥è‡ªå®šä¹‰ç±»åž‹å°±å¯åŒæ—¶åœ¨ greenDAO å’Œ ObjectBox é—´ä½¿ç”¨ 12345// greenDAOimport org.greenrobot.greendao.converter.PropertyConverter;// ObjectBoximport io.objectbox.converter.PropertyConverter; ä¿®æ”¹ @Convert æ³¨è§£é‡Œçš„ columnType æ”¹ä¸º dbType 12345// greenDAO@Convert(converter = NoteTypeConverter.class, columnType = String.class)// ObjectBox@Convert(converter = NoteTypeConverter.class, dbType = String.class) å…³ç³»ã€‚ObjectBox ä½¿ç”¨ ToOne å’Œ ToManyç±»åž‹æ›¿ä»£ greenDAO çš„ @ToOne å’Œ @ToMany æ³¨è§£ã€‚ ä½¿ç”¨ BoxStore.ä¿®æ”¹å®Œ entity åŽï¼Œè®¾ç½® BoxStore åˆ›å»º DaoSession. 123456789// é€šå¸¸åœ¨ Application ç±»ä¸­boxStore = MyObjectBox.builder().androidContext(this).build();daoCompatSession = new DaoSession(boxStore);// åœ¨è¿ç§»å®ŒæˆåŽï¼Œä½ å¯èƒ½æƒ³ç§»é™¤è¿™äº›è¿ç§»æ“ä½œã€‚// é‚£ä¹ˆé€šè¿‡ greenDAO session èŽ·å– entities,æŠŠä»–ä»¬è½¬ä¸º ObjectBox entities,// ç„¶åŽä½¿ç”¨ DaoCompat session æ’å…¥ã€‚List&lt;com.example.app.daos.greendao.Note&gt; notes = daoSession.getNoteDao().loadAll();List&lt;Note&gt; convertedNotes = convertToObjectBoxNotes(notes);daoCompatSession.getNoteDao().insertInTx(convertedNotes); é»˜è®¤æ²¡æœ‰è®¾ç½® ID (å³ id == 0),ObjectBox ä¼šä¸ºæ’å…¥çš„æ•°æ®ç”Ÿæˆä¸€ä¸ªæ–°çš„ ID.å¦‚æžœæƒ³ä¿ç•™åŽŸæ¥çš„ ID,è¯·ä¿®æ”¹ @Id(assignable = true) ä½¿ç”¨ DaoCompat DaoSessionåœ¨ä½¿ç”¨æ–° compat session æ›¿æ¢åŽŸæ¥çš„ API åŽï¼Œå¯ä»¥é€šè¿‡åœ¨ Application ç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•è¿”å›ž DaoSession 123456public DaoSession getDaoSession() &#123; // greenDAO // return daoSession; // ObjectBox return daoCompatSession;&#125; è¡¨é¢ä¸Š compat DaoSession æ˜¯ greenDAO DaoSession çš„æ›¿ä»£å“ï¼Œå…¶å®žå®ƒå†…éƒ¨æ˜¯ä½¿ç”¨ BoxStore ä»£æ›¿äº† greenDAO æ•°æ®åº“.å¦‚æžœè¿˜ä½¿ç”¨äº† greenDAO çš„é¢å¤–ç‰¹æ€§ï¼Œæ¯”å¦‚ queries,é‚£ä¹ˆè¿˜éœ€å¦‚ä¸‹ä¿®æ”¹: 123456// greenDAOimport org.greenrobot.greendao.query.Query;import org.greenrobot.greendao...// ObjectBoximport org.greenrobot.daocompat.query.Query;import org.greenrobot.daocompat... QueriesDaoCompat æ”¯æŒä»¥ä¸‹çš„ Query åŠŸèƒ½:â€“ remove() æ›¿ä»£ DeleteQueryâ€“ count() æ›¿ä»£ CountQueryâ€“ ä¸æ”¯æŒ CursorQuery DaoCompat å’Œ greenDAO çš„ä¸åŒâ€“ ä¸æ”¯æŒ NotNullâ€“ ä¸æ”¯æŒ Joins å’Œ åŽŸç”Ÿ SQL æŸ¥è¯¢.â€“ ä¸æ”¯æŒå¼‚æ­¥ sessions: startAsyncSession()â€“ ä¸æ”¯æŒåŠ å¯†â€“ ä»…æ”¯æŒç®€å•çš„ AbstractDaoTest å’Œ AbstractDaoBasicTest]]></content>
      <tags>
        <tag>ObjectBox</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
</search>
